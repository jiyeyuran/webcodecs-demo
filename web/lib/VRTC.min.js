/*!
 * @byted/byte-rtc v3.21.0
 * (c) 2020-2021 luoshaohua@bytedance.com
 * Released under the ISC License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VRTC=t()}(this,(function(){"use strict";var e=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e){var t={exports:{}};return e(t,t.exports),t.exports}function n(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets option of @rollup/plugin-commonjs appropriately for this require call to behave properly.')}var i=r((function(e){function t(r){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(r)}e.exports=t})),a=!0;function o(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function s(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var a=function(e){var t=r(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,a),i.apply(this,[e,a])};var a=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(r))return a.apply(this,arguments);var n=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function c(e){return"boolean"!=typeof e?new Error("Argument type: "+i(e)+". Please use a boolean."):(a=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function d(e){return"boolean"!=typeof e?new Error("Argument type: "+i(e)+". Please use a boolean."):(!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function u(){if("object"===("undefined"==typeof window?"undefined":i(window))){if(a)return;"undefined"!=typeof console&&console.log}}function l(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var r=e.navigator;if(r.mozGetUserMedia)t.browser="firefox",t.version=o(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=o(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(r.mediaDevices&&r.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=o(r.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=o(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function p(e){return"[object Object]"===Object.prototype.toString.call(e)}function f(t){return p(t)?Object.keys(t).reduce((function(r,n){var i=p(t[n]),a=i?f(t[n]):t[n],o=i&&!Object.keys(a).length;return void 0===a||o?r:Object.assign(r,e({},n,a))}),{}):t}function h(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((function(n){n.endsWith("Id")?h(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach((function(t){h(e,e.get(t),r)}))})))}function m(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var a=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)})),a.forEach((function(t){e.forEach((function(r){r.type===n&&r.trackId===t.id&&h(e,r,i)}))})),i}var v=u;function g(e,t){var r=e&&e.navigator;if(r.mediaDevices){var n=function(e){if("object"!==i(e)||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n="object"===i(e[r])?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var a=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var o={};"number"==typeof n.ideal?(o[a("min",r)]=n.ideal,t.optional.push(o),(o={})[a("max",r)]=n.ideal,t.optional.push(o)):(o[a("",r)]=n.ideal,t.optional.push(o))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[a("",r)]=n.exact):["min","max"].forEach((function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[a(e,r)]=n[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,a){if(t.version>=61)return a(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===i(e.audio)){var o=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};o((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),o(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"===i(e.video)){var s=e.video.facingMode;s=s&&("object"===i(s)?s:{ideal:s});var c,d=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||d))if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?c=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(c=["front"]),c)return r.mediaDevices.enumerateDevices().then((function(t){var r=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return c.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!r&&t.length&&c.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=s.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=n(e.video),v("chrome: "+JSON.stringify(e)),a(e)}));e.video=n(e.video)}return v("chrome: "+JSON.stringify(e)),a(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(e,t,n){a(e,(function(e){r.webkitGetUserMedia(e,t,(function(e){n&&n(o(e))}))}))}.bind(r),r.mediaDevices.getUserMedia){var s=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return a(e,(function(e){return s(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(o(e))}))}))}}}}function y(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function b(e){if("object"===i(e)&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===n.track.id})):{track:n.track};var a=new Event("track");a.track=n.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],r.dispatchEvent(a)})),t.stream.getTracks().forEach((function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===n.id})):{track:n};var a=new Event("track");a.track=n,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],r.dispatchEvent(a)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else s(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))}function _(e){if("object"===i(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],a.apply(this,[e]),e.getTracks().forEach((function(e){r._senders.push(t(r,e))}))};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach((function(e){var r=t._senders.find((function(t){return t.track===e}));r&&t._senders.splice(t._senders.indexOf(r),1)}))}}else if("object"===i(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function S(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,r=Array.prototype.slice.call(arguments),n=r[0],i=r[1],a=r[2];if(arguments.length>0&&"function"==typeof n)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof n))return t.apply(this,[]);var o=function(e){var t={};return e.result().forEach((function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){r[t]=e.stat(t)})),t[r.id]=r})),t},s=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var c=function(e){i(s(o(e)))};return t.apply(this,[c,n])}return new Promise((function(r,n){t.apply(e,[function(e){r(s(o(e)))},n])})).then(i,a)}}}function w(e){if("object"===i(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return m(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=n.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),s(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return m(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,r,n,i=arguments[0];return this.getSenders().forEach((function(e){e.track===i&&(t?n=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===i&&(r?n=!0:r=e),e.track===i})),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return a.apply(this,arguments)}}}}function k(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var n=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter((function(e){return-1===n.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]})),i.apply(this,arguments)}}function C(t,r){if(t.RTCPeerConnection){if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return k(t);var n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(e){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.getTracks().forEach((function(e){if(r.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[e.id]){var n=new t.MediaStream(e.getTracks());this._streams[e.id]=n,this._reverseStreams[n.id]=e,e=n}i.apply(this,[e])};var a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},t.RTCPeerConnection.prototype.addTrack=function(e,r){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(t){return t===e})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var a=this.getSenders().find((function(t){return t.track===e}));if(a)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var o=this._streams[r.id];if(o)o.addTrack(e),Promise.resolve().then((function(){n.dispatchEvent(new Event("negotiationneeded"))}));else{var s=new t.MediaStream([e]);this._streams[r.id]=s,this._reverseStreams[s.id]=r,this.addStream(s)}return this.getSenders().find((function(t){return t.track===e}))},["createOffer","createAnswer"].forEach((function(r){var n=t.RTCPeerConnection.prototype[r],i=e({},r,(function(){var e=this,t=arguments,r=arguments.length&&"function"==typeof arguments[0];return r?n.apply(this,[function(r){var n=c(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then((function(t){return c(e,t)}))}));t.RTCPeerConnection.prototype[r]=i[r]}));var o=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=d(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};var s=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=s.get.apply(this);return""===e.type?e:c(this,e)}}),t.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach((function(n){r._streams[n].getTracks().find((function(t){return e.track===t}))&&(t=r._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function c(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}function d(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:r})}}function A(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(r){var n=t.RTCPeerConnection.prototype[r],i=e({},r,(function(){return arguments[0]=new("addIceCandidate"===r?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));t.RTCPeerConnection.prototype[r]=i[r]}))}function E(e,t){s(e,"negotiationneeded",(function(e){var r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e}))}var R=Object.freeze({__proto__:null,shimMediaStream:y,shimOnTrack:b,shimGetSendersWithDtmf:_,shimGetStats:S,shimSenderReceiverGetStats:w,shimAddTrackRemoveTrackWithNative:k,shimAddTrackRemoveTrack:C,shimPeerConnection:A,fixNegotiationNeeded:E,shimGetUserMedia:g,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&"function"==typeof t&&(e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((function(t){var n=r.video&&r.video.width,i=r.video&&r.video.height,a=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:a||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)}))})}});var T=r((function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},t.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},t.getDescription=function(e){var r=t.splitSections(e);return r&&r[0]},t.getMediaSections=function(e){var r=t.splitSections(e);return r.shift(),r},t.matchPrefix=function(e,r){return t.splitLines(e).filter((function(e){return 0===e.indexOf(r)}))},t.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},t.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},t.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},t.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},t.getMid=function(e){var r=t.matchPrefix(e,"a=mid:")[0];if(r)return r.substr(6)},t.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},t.getDtlsParameters=function(e,r){return{role:"auto",fingerprints:t.matchPrefix(e+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},t.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===i(e.keyParams)?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,r){return t.matchPrefix(e+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,r){var n=t.matchPrefix(e+r,"a=ice-ufrag:")[0],i=t.matchPrefix(e+r,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},t.parseRtpParameters=function(e){for(var r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var a=n[i],o=t.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(o){var s=t.parseRtpMap(o),c=t.matchPrefix(e,"a=fmtp:"+a+" ");switch(s.parameters=c.length?t.parseFmtp(c[0]):{},s.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(t.parseRtcpFb),r.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(s.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((function(e){r.headerExtensions.push(t.parseExtmap(e))})),r},t.writeRtpDescription=function(e,r){var n="";n+="m="+e+" ",n+=r.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=r.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach((function(e){n+=t.writeRtpMap(e),n+=t.writeFmtp(e),n+=t.writeRtcpFb(e)}));var i=0;return r.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",r.headerExtensions&&r.headerExtensions.forEach((function(e){n+=t.writeExtmap(e)})),n},t.parseRtpEncodingParameters=function(e){var r,n=[],i=t.parseRtpParameters(e),a=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,d=t.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));d.length>0&&d[0].length>1&&d[0][0]===c&&(r=d[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&r&&(t.rtx={ssrc:r}),n.push(t),a&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&c&&n.push({ssrc:c});var u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach((function(e){e.maxBitrate=u}))),n},t.parseRtcpParameters=function(e){var r={},n=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);var i=t.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=0===i.length;var a=t.matchPrefix(e,"a=rtcp-mux");return r.mux=a.length>0,r},t.parseMsid=function(e){var r,n=t.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(r=n[0].substr(7).split(" "))[0],track:r[1]};var i=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(r=i[0].value.split(" "))[0],track:r[1]}:void 0},t.parseSctpDescription=function(e){var r,n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");i.length>0&&(r=parseInt(i[0].substr(19),10)),isNaN(r)&&(r=65536);var a=t.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substr(12),10),protocol:n.fmt,maxMessageSize:r};if(t.matchPrefix(e,"a=sctpmap:").length>0){var o=t.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,r,n){var i=void 0!==r?r:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.writeMediaSection=function(e,r,n,i){var a=t.writeRtpDescription(e.kind,r);if(a+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),a+="a=mid:"+e.mid+"\r\n",e.direction?a+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var o="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";a+="a="+o,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+"\r\n"),a},t.getDirection=function(e,r){for(var n=t.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var r=t.splitLines(e)[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(e){var r=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var r=t.splitLines(e),n=0;n<r.length;n++)if(r[n].length<2||"="!==r[n].charAt(1))return!1;return!0},e.exports=t}));function I(e,t,r,n,i){var a=T.writeRtpDescription(e.kind,t);if(a+=T.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=T.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":i||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var o=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=o;var s="msid:"+(n?n.id:"-")+" "+o+"\r\n";a+="a="+s,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+T.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+T.localCName+"\r\n"),a}function x(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var a=n(e.parameters.apt,r),o=n(t.parameters.apt,i);return a&&o&&a.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach((function(n){for(var a=0;a<t.codecs.length;a++){var o=t.codecs[a];if(n.name.toLowerCase()===o.name.toLowerCase()&&n.clockRate===o.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&o.parameters.apt&&!i(n,o,e.codecs,t.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(n.numChannels,o.numChannels),r.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter((function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}})),r}function P(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function O(e,t){var r=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return r||e.addRemoteCandidate(t),!r}function D(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}var M=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function n(t,r,n,i){var a=new Event("track");a.track=r,a.receiver=n,a.transceiver={receiver:n},a.streams=i,e.setTimeout((function(){t._dispatchEvent("track",a)}))}var i=function(r){var n=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){n[e]=i[e].bind(i)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw D("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&e.urls;var i="string"==typeof n;return i&&(n=[n]),n=n.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)})),delete e.url,e.urls=i?n[0]:n,!!n.length}}))}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var a=r.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=T.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(i.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(i.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),i.prototype.onicecandidate=null,i.prototype.onaddstream=null,i.prototype.ontrack=null,i.prototype.onremovestream=null,i.prototype.onsignalingstatechange=null,i.prototype.oniceconnectionstatechange=null,i.prototype.onconnectionstatechange=null,i.prototype.onicegatheringstatechange=null,i.prototype.onnegotiationneeded=null,i.prototype.ondatachannel=null,i.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},i.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},i.prototype.getConfiguration=function(){return this._config},i.prototype.getLocalStreams=function(){return this.localStreams},i.prototype.getRemoteStreams=function(){return this.remoteStreams},i.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},i.prototype.addTrack=function(t,r){if(this._isClosed)throw D("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find((function(e){return e.track===t})))throw D("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(n=this.transceivers[i]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},i.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach((function(t){r.addTrack(t,e)}));else{var n=e.clone();e.getTracks().forEach((function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",(function(e){r.enabled=e.enabled}))})),n.getTracks().forEach((function(e){r.addTrack(e,n)}))}},i.prototype.removeTrack=function(t){if(this._isClosed)throw D("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find((function(e){return e.rtpSender===t}));if(!r)throw D("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},i.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var r=t.getSenders().find((function(t){return t.track===e}));r&&t.removeTrack(r)}))},i.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},i.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},i.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},i.prototype._gather=function(t,r){var n=this,i=this.transceivers[r].iceGatherer;if(!i.onlocalcandidate){var a=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),i.onlocalcandidate=function(e){if(!(n.usingBundle&&r>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:r};var o=e.candidate,s=!o||0===Object.keys(o).length;if(s)"new"!==i.state&&"gathering"!==i.state||(i.state="completed");else{"new"===i.state&&(i.state="gathering"),o.component=1,o.ufrag=i.getLocalParameters().usernameFragment;var c=T.writeCandidate(o);a.candidate=Object.assign(a.candidate,T.parseCandidate(c)),a.candidate.candidate=c,a.candidate.toJSON=function(){return{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,usernameFragment:a.candidate.usernameFragment}}}var d=T.getMediaSections(n._localDescription.sdp);d[a.candidate.sdpMLineIndex]+=s?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",n._localDescription.sdp=T.getDescription(n._localDescription.sdp)+d.join("");var u=n.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),s||n._dispatchEvent("icecandidate",a),u&&(n._dispatchEvent("icecandidate",new Event("icecandidate")),n.iceGatheringState="complete",n._emitGatheringStateChange())}},e.setTimeout((function(){a.forEach((function(e){i.onlocalcandidate(e)}))}),0)}},i.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},i.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},i.prototype._transceive=function(e,r,n){var i=x(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:T.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),n&&e.rtpReceiver&&i.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?i.encodings=e.recvEncodingParameters:i.encodings=[{}],i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},i.prototype.setLocalDescription=function(e){var t,r,n=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(D("TypeError",'Unsupported type "'+e.type+'"'));if(!P("setLocalDescription",e.type,n.signalingState)||n._isClosed)return Promise.reject(D("InvalidStateError","Can not set local "+e.type+" in state "+n.signalingState));if("offer"===e.type)t=T.splitSections(e.sdp),r=t.shift(),t.forEach((function(e,t){var r=T.parseRtpParameters(e);n.transceivers[t].localCapabilities=r})),n.transceivers.forEach((function(e,t){n._gather(e.mid,t)}));else if("answer"===e.type){t=T.splitSections(n._remoteDescription.sdp),r=t.shift();var i=T.matchPrefix(r,"a=ice-lite").length>0;t.forEach((function(e,t){var a=n.transceivers[t],o=a.iceGatherer,s=a.iceTransport,c=a.dtlsTransport,d=a.localCapabilities,u=a.remoteCapabilities;if(!(T.isRejected(e)&&0===T.matchPrefix(e,"a=bundle-only").length)&&!a.rejected){var l=T.getIceParameters(e,r),p=T.getDtlsParameters(e,r);i&&(p.role="server"),n.usingBundle&&0!==t||(n._gather(a.mid,t),"new"===s.state&&s.start(o,l,i?"controlling":"controlled"),"new"===c.state&&c.start(p));var f=x(d,u);n._transceive(a,f.codecs.length>0,!1)}}))}return n._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?n._updateSignalingState("have-local-offer"):n._updateSignalingState("stable"),Promise.resolve()},i.prototype.setRemoteDescription=function(i){var a=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(D("TypeError",'Unsupported type "'+i.type+'"'));if(!P("setRemoteDescription",i.type,a.signalingState)||a._isClosed)return Promise.reject(D("InvalidStateError","Can not set remote "+i.type+" in state "+a.signalingState));var o={};a.remoteStreams.forEach((function(e){o[e.id]=e}));var s=[],c=T.splitSections(i.sdp),d=c.shift(),u=T.matchPrefix(d,"a=ice-lite").length>0,l=T.matchPrefix(d,"a=group:BUNDLE ").length>0;a.usingBundle=l;var p=T.matchPrefix(d,"a=ice-options:")[0];return a.canTrickleIceCandidates=!!p&&p.substr(14).split(" ").indexOf("trickle")>=0,c.forEach((function(n,c){var p=T.splitLines(n),f=T.getKind(n),h=T.isRejected(n)&&0===T.matchPrefix(n,"a=bundle-only").length,m=p[0].substr(2).split(" ")[2],v=T.getDirection(n,d),g=T.parseMsid(n),y=T.getMid(n)||T.generateIdentifier();if(h||"application"===f&&("DTLS/SCTP"===m||"UDP/DTLS/SCTP"===m))a.transceivers[c]={mid:y,kind:f,protocol:m,rejected:!0};else{var b,_,S,w,k,C,A,E,R;!h&&a.transceivers[c]&&a.transceivers[c].rejected&&(a.transceivers[c]=a._createTransceiver(f,!0));var I,P,D=T.parseRtpParameters(n);h||(I=T.getIceParameters(n,d),(P=T.getDtlsParameters(n,d)).role="client"),A=T.parseRtpEncodingParameters(n);var M=T.parseRtcpParameters(n),B=T.matchPrefix(n,"a=end-of-candidates",d).length>0,L=T.matchPrefix(n,"a=candidate:").map((function(e){return T.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===i.type||"answer"===i.type)&&!h&&l&&c>0&&a.transceivers[c]&&(a._disposeIceAndDtlsTransports(c),a.transceivers[c].iceGatherer=a.transceivers[0].iceGatherer,a.transceivers[c].iceTransport=a.transceivers[0].iceTransport,a.transceivers[c].dtlsTransport=a.transceivers[0].dtlsTransport,a.transceivers[c].rtpSender&&a.transceivers[c].rtpSender.setTransport(a.transceivers[0].dtlsTransport),a.transceivers[c].rtpReceiver&&a.transceivers[c].rtpReceiver.setTransport(a.transceivers[0].dtlsTransport)),"offer"!==i.type||h){if("answer"===i.type&&!h){_=(b=a.transceivers[c]).iceGatherer,S=b.iceTransport,w=b.dtlsTransport,k=b.rtpReceiver,C=b.sendEncodingParameters,E=b.localCapabilities,a.transceivers[c].recvEncodingParameters=A,a.transceivers[c].remoteCapabilities=D,a.transceivers[c].rtcpParameters=M,L.length&&"new"===S.state&&(!u&&!B||l&&0!==c?L.forEach((function(e){O(b.iceTransport,e)})):S.setRemoteCandidates(L)),l&&0!==c||("new"===S.state&&S.start(_,I,"controlling"),"new"===w.state&&w.start(P)),!x(b.localCapabilities,b.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&b.sendEncodingParameters[0].rtx&&delete b.sendEncodingParameters[0].rtx,a._transceive(b,"sendrecv"===v||"recvonly"===v,"sendrecv"===v||"sendonly"===v),!k||"sendrecv"!==v&&"sendonly"!==v?delete b.rtpReceiver:(R=k.track,g?(o[g.stream]||(o[g.stream]=new e.MediaStream),r(R,o[g.stream]),s.push([R,k,o[g.stream]])):(o.default||(o.default=new e.MediaStream),r(R,o.default),s.push([R,k,o.default])))}}else{(b=a.transceivers[c]||a._createTransceiver(f)).mid=y,b.iceGatherer||(b.iceGatherer=a._createIceGatherer(c,l)),L.length&&"new"===b.iceTransport.state&&(!B||l&&0!==c?L.forEach((function(e){O(b.iceTransport,e)})):b.iceTransport.setRemoteCandidates(L)),E=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(E.codecs=E.codecs.filter((function(e){return"rtx"!==e.name}))),C=b.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var N,j=!1;if("sendrecv"===v||"sendonly"===v){if(j=!b.rtpReceiver,k=b.rtpReceiver||new e.RTCRtpReceiver(b.dtlsTransport,f),j)R=k.track,g&&"-"===g.stream||(g?(o[g.stream]||(o[g.stream]=new e.MediaStream,Object.defineProperty(o[g.stream],"id",{get:function(){return g.stream}})),Object.defineProperty(R,"id",{get:function(){return g.track}}),N=o[g.stream]):(o.default||(o.default=new e.MediaStream),N=o.default)),N&&(r(R,N),b.associatedRemoteMediaStreams.push(N)),s.push([R,k,N])}else b.rtpReceiver&&b.rtpReceiver.track&&(b.associatedRemoteMediaStreams.forEach((function(t){var r=t.getTracks().find((function(e){return e.id===b.rtpReceiver.track.id}));r&&function(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(r,t)})),b.associatedRemoteMediaStreams=[]);b.localCapabilities=E,b.remoteCapabilities=D,b.rtpReceiver=k,b.rtcpParameters=M,b.sendEncodingParameters=C,b.recvEncodingParameters=A,a._transceive(a.transceivers[c],!1,j)}}})),void 0===a._dtlsRole&&(a._dtlsRole="offer"===i.type?"active":"passive"),a._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?a._updateSignalingState("have-remote-offer"):a._updateSignalingState("stable"),Object.keys(o).forEach((function(t){var r=o[t];if(r.getTracks().length){if(-1===a.remoteStreams.indexOf(r)){a.remoteStreams.push(r);var i=new Event("addstream");i.stream=r,e.setTimeout((function(){a._dispatchEvent("addstream",i)}))}s.forEach((function(e){var t=e[0],i=e[1];r.id===e[2].id&&n(a,t,i,[r])}))}})),s.forEach((function(e){e[2]||n(a,e[0],e[1],[])})),e.setTimeout((function(){a&&a.transceivers&&a.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&e.iceTransport.addRemoteCandidate({})}))}),4e3),Promise.resolve()},i.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},i.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},i.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},i.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},i.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},i.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(D("InvalidStateError","Can not call createOffer after close"));var n=r.transceivers.filter((function(e){return"audio"===e.kind})).length,i=r.transceivers.filter((function(e){return"video"===e.kind})).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(n=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(i=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(r.transceivers.forEach((function(e){"audio"===e.kind?--n<0&&(e.wantReceive=!1):"video"===e.kind&&--i<0&&(e.wantReceive=!1)}));n>0||i>0;)n>0&&(r._createTransceiver("audio"),n--),i>0&&(r._createTransceiver("video"),i--);var o=T.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach((function(n,i){var a=n.track,o=n.kind,s=n.mid||T.generateIdentifier();n.mid=s,n.iceGatherer||(n.iceGatherer=r._createIceGatherer(i,r.usingBundle));var c=e.RTCRtpSender.getCapabilities(o);t<15019&&(c.codecs=c.codecs.filter((function(e){return"rtx"!==e.name}))),c.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),c.headerExtensions.forEach((function(e){(n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var d=n.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];a&&t>=15019&&"video"===o&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,o)),n.localCapabilities=c,n.sendEncodingParameters=d})),"max-compat"!==r._config.bundlePolicy&&(o+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n",r.transceivers.forEach((function(e,t){o+=I(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),o+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,o+="a="+T.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(o+="a=end-of-candidates\r\n"))}));var s=new e.RTCSessionDescription({type:"offer",sdp:o});return Promise.resolve(s)},i.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(D("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(D("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var n=T.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(n+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),n+="a=ice-options:trickle\r\n";var i=T.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach((function(e,a){if(!(a+1>i)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?n+="m=application 0 DTLS/SCTP 5000\r\n":n+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?n+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(n+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(n+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var o;if(e.stream)"audio"===e.kind?o=e.stream.getAudioTracks()[0]:"video"===e.kind&&(o=e.stream.getVideoTracks()[0]),o&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var s=x(e.localCapabilities,e.remoteCapabilities);!s.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,n+=I(e,s,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(n+="a=rtcp-rsize\r\n")}}));var a=new e.RTCSessionDescription({type:"answer",sdp:n});return Promise.resolve(a)},i.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(n,i){if(!r._remoteDescription)return i(D("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var o=0;o<r.transceivers.length;o++)if(r.transceivers[o].mid===e.sdpMid){a=o;break}var s=r.transceivers[a];if(!s)return i(D("OperationError","Can not add ICE candidate"));if(s.rejected)return n();var c=Object.keys(e.candidate).length>0?T.parseCandidate(e.candidate):{};if("tcp"===c.protocol&&(0===c.port||9===c.port))return n();if(c.component&&1!==c.component)return n();if((0===a||a>0&&s.iceTransport!==r.transceivers[0].iceTransport)&&!O(s.iceTransport,c))return i(D("OperationError","Can not add ICE candidate"));var d=e.candidate.trim();0===d.indexOf("a=")&&(d=d.substr(2)),(t=T.getMediaSections(r._remoteDescription.sdp))[a]+="a="+(c.type?d:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=T.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var u=0;u<r.transceivers.length&&(r.transceivers[u].rejected||(r.transceivers[u].iceTransport.addRemoteCandidate({}),(t=T.getMediaSections(r._remoteDescription.sdp))[u]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=T.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));u++);n()}))},i.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)})),!r)throw D("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&n.push(e[t].getStats())}))})),Promise.all(n).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(r){var n;e[r].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(n=e[r]).type]||n.type,t.set(r,e[r])})),t}))}}}));var a=["createOffer","createAnswer"];return a.forEach((function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(a=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),i};function B(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}function L(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function N(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var n=M(e,t.version);e.RTCPeerConnection=function(e){var r,i;return e&&e.iceServers&&(e.iceServers=(r=e.iceServers,t.version,i=!1,(r=JSON.parse(JSON.stringify(r))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&e.urls;var r="string"==typeof t;return r&&(t=[t]),t=t.filter((function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!i?(i=!0,!0):t&&!i})),delete e.url,e.urls=r?t[0]:t,!!t.length}}))),u("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function j(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}var F=Object.freeze({__proto__:null,shimPeerConnection:N,shimReplaceTrack:j,shimGetUserMedia:B,shimGetDisplayMedia:L});function U(e,t){var r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===i(e)&&"object"===i(e.audio)&&(e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","mozAutoGainControl"),a(e.audio,"noiseSuppression","mozNoiseSuppression")),o(e)},n&&n.prototype.getSettings){var s=n.prototype.getSettings;n.prototype.getSettings=function(){var e=s.apply(this,arguments);return a(e,"mozAutoGainControl","autoGainControl"),a(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var c=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===i(e)&&(e=JSON.parse(JSON.stringify(e)),a(e,"autoGainControl","mozAutoGainControl"),a(e,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[e])}}}}function V(e){"object"===i(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function z(t,r){if("object"===i(t)&&(t.RTCPeerConnection||t.mozRTCPeerConnection)){!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(r){var n=t.RTCPeerConnection.prototype[r],i=e({},r,(function(){return arguments[0]=new("addIceCandidate"===r?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));t.RTCPeerConnection.prototype[r]=i[r]}));var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),t=e[0],i=e[1],o=e[2];return a.apply(this,[t||null]).then((function(e){if(r.version<53&&!i)try{e.forEach((function(e){e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,r){e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,o)}}}function G(e){if("object"===i(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function W(e){if("object"===i(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r}),s(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function H(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this.getSenders().forEach((function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)}))})}function q(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function J(e){if("object"===i(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],r=e&&"sendEncodings"in e;r&&e.sendEncodings.forEach((function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var n=t.apply(this,arguments);if(r){var i=n.sender,a=i.getParameters();(!("encodings"in a)||1===a.encodings.length&&0===Object.keys(a.encodings[0]).length)&&(a.encodings=e.sendEncodings,i.sendEncodings=e.sendEncodings,this.setParametersPromises.push(i.setParameters(a).then((function(){delete i.sendEncodings})).catch((function(){delete i.sendEncodings}))))}return n})}}function Z(e){if("object"===i(e)&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}}function K(e){if("object"===i(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(r,e)})).finally((function(){r.setParametersPromises=[]})):t.apply(this,arguments)}}}function Q(e){if("object"===i(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(r,e)})).finally((function(){r.setParametersPromises=[]})):t.apply(this,arguments)}}}var Y=Object.freeze({__proto__:null,shimOnTrack:V,shimPeerConnection:z,shimSenderGetStats:G,shimReceiverGetStats:W,shimRemoveStream:H,shimRTCDataChannel:q,shimAddTransceiver:J,shimGetParameters:Z,shimCreateOffer:K,shimCreateAnswer:Q,shimGetUserMedia:U,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}});function X(e){if("object"===i(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(n){return t.call(r,n,e)})),e.getVideoTracks().forEach((function(n){return t.call(r,n,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var r=this,n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return i&&i.forEach((function(e){r._localStreams?r._localStreams.includes(e)||r._localStreams.push(e):r._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var n=e.getTracks();this.getSenders().forEach((function(e){n.includes(e.track)&&t.removeTrack(e)}))}})}}function $(e){if("object"===i(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}}))}),t.apply(e,arguments)}}}function ee(e){if("object"===i(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,a=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var c=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=c,c=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=c,c=function(e,t,r){var n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=c}}function te(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return n(re(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))}function re(e){return e&&void 0!==e.video?Object.assign({},e,{video:f(e.video)}):e}function ne(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var a=e.iceServers[i];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?((a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,n.push(a)):n.push(e.iceServers[i])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function ie(e){"object"===i(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function ae(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}}function oe(e){"object"!==i(e)||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var se=Object.freeze({__proto__:null,shimLocalStreamsAPI:X,shimRemoteStreamsAPI:$,shimCallbacksAPI:ee,shimGetUserMedia:te,shimConstraints:re,shimRTCIceServerUrls:ne,shimTrackEventTransceiver:ie,shimCreateOfferLegacy:ae,shimAudioContext:oe});function ce(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===i(e)&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),n=T.parseCandidate(e.candidate),a=Object.assign(r,n);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,s(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}}function de(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=function(e){if(!e||!e.sdp)return!1;var t=T.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=T.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},n=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r},i=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},a=function(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var i=T.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?n=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),s=e.sdpSemantics;"plan-b"===s&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){var c,d=n(arguments[0]),u=i(d),l=a(arguments[0],d);c=0===u&&0===l?Number.POSITIVE_INFINITY:0===u||0===l?Math.max(u,l):Math.min(u,l);var p={};Object.defineProperty(p,"maxMessageSize",{get:function(){return c}}),this._sctp=p}return o.apply(this,arguments)}}}function ue(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},s(e,"datachannel",(function(e){return r(e.channel,e.target),e}))}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}}function le(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}}function pe(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var n=t.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return r.apply(this,arguments)}}}function fe(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}var he=Object.freeze({__proto__:null,shimRTCIceCandidate:ce,shimMaxMessageSize:de,shimSendThrowTypeError:ue,shimConnectionState:le,removeExtmapAllowMixed:pe,shimAddIceCandidateNullOrEmpty:fe});!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},n=u,i=l(t),a={browserDetails:i,commonShim:he,extractVersion:o,disableLog:c,disableWarnings:d};switch(i.browser){case"chrome":if(!R||!A||!r.shimChrome)return n("Chrome shim is not included in this adapter release."),a;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),a;n("adapter.js shimming chrome."),a.browserShim=R,fe(t,i),g(t,i),y(t),A(t,i),b(t),C(t,i),_(t),S(t),w(t),E(t,i),ce(t),le(t),de(t,i),ue(t),pe(t,i);break;case"firefox":if(!Y||!z||!r.shimFirefox)return n("Firefox shim is not included in this adapter release."),a;n("adapter.js shimming firefox."),a.browserShim=Y,fe(t,i),U(t,i),z(t,i),V(t),H(t),G(t),W(t),q(t),J(t),Z(t),K(t),Q(t),ce(t),le(t),de(t,i),ue(t);break;case"edge":if(!F||!N||!r.shimEdge)return n("MS edge shim is not included in this adapter release."),a;n("adapter.js shimming edge."),a.browserShim=F,B(t),L(t),N(t,i),j(t),de(t,i),ue(t);break;case"safari":if(!se||!r.shimSafari)return n("Safari shim is not included in this adapter release."),a;n("adapter.js shimming safari."),a.browserShim=se,fe(t,i),ne(t),ae(t),ee(t),X(t),$(t),ie(t),te(t),oe(t),ce(t),de(t,i),ue(t),pe(t,i);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});function me(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}var ve=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){me(a,n,i,o,s,"next",e)}function s(e){me(a,n,i,o,s,"throw",e)}o(void 0)}))}},ge=r((function(e){var t=function(e){var t,r=Object.prototype,n=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function d(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof g?t:g,a=Object.create(i.prototype),o=new I(n||[]);return a._invoke=function(e,t,r){var n=p;return function(i,a){if(n===h)throw new Error("Generator is already running");if(n===m){if("throw"===i)throw a;return P()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=E(o,r);if(s){if(s===v)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===p)throw n=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var c=l(e,t,r);if("normal"===c.type){if(n=r.done?m:f,c.arg===v)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=m,r.method="throw",r.arg=c.arg)}}}(e,r,o),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p="suspendedStart",f="suspendedYield",h="executing",m="completed",v={};function g(){}function y(){}function b(){}var _={};_[o]=function(){return this};var S=Object.getPrototypeOf,w=S&&S(S(x([])));w&&w!==r&&n.call(w,o)&&(_=w);var k=b.prototype=g.prototype=Object.create(_);function C(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function r(a,o,s,c){var d=l(e[a],e,o);if("throw"!==d.type){var u=d.arg,p=u.value;return p&&"object"===i(p)&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,c)}))}c(d.arg)}var a;this._invoke=function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return a=a?a.then(i,i):i()}}function E(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,E(e,r),"throw"===r.method))return v;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=l(n,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function x(e){if(e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}return{next:P}}function P(){return{value:t,done:!0}}return y.prototype=k.constructor=b,b.constructor=y,y.displayName=d(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,d(e,c,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},C(A.prototype),A.prototype[s]=function(){return this},e.AsyncIterator=A,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new A(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},C(k),d(k,c,"Generator"),k[o]=function(){return this},k.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=x,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),d=n.call(o,"finallyLoc");if(c&&d){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:x(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));var ye=function(e){if(Array.isArray(e))return e};var be=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}};var _e=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n};var Se=function(e,t){if(e){if("string"==typeof e)return _e(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_e(e,t):void 0}};var we=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var ke=function(e,t){return ye(e)||be(e,t)||Se(e,t)||we()};var Ce=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function Ae(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ee=function(e,t,r){return t&&Ae(e.prototype,t),r&&Ae(e,r),e},Re=r((function(e,r){var n="__lodash_hash_undefined__",a=9007199254740991,o="[object Arguments]",s="[object Boolean]",c="[object Date]",d="[object Function]",u="[object GeneratorFunction]",l="[object Map]",p="[object Number]",f="[object Object]",h="[object Promise]",m="[object RegExp]",v="[object Set]",g="[object String]",y="[object Symbol]",b="[object WeakMap]",_="[object ArrayBuffer]",S="[object DataView]",w="[object Float32Array]",k="[object Float64Array]",C="[object Int8Array]",A="[object Int16Array]",E="[object Int32Array]",R="[object Uint8Array]",T="[object Uint8ClampedArray]",I="[object Uint16Array]",x="[object Uint32Array]",P=/\w*$/,O=/^\[object .+?Constructor\]$/,D=/^(?:0|[1-9]\d*)$/,M={};M[o]=M["[object Array]"]=M[_]=M[S]=M[s]=M[c]=M[w]=M[k]=M[C]=M[A]=M[E]=M[l]=M[p]=M[f]=M[m]=M[v]=M[g]=M[y]=M[R]=M[T]=M[I]=M[x]=!0,M["[object Error]"]=M[d]=M[b]=!1;var B="object"==i(t)&&t&&t.Object===Object&&t,L="object"==("undefined"==typeof self?"undefined":i(self))&&self&&self.Object===Object&&self,N=B||L||Function("return this")(),j=r&&!r.nodeType&&r,F=j&&e&&!e.nodeType&&e,U=F&&F.exports===j;function V(e,t){return e.set(t[0],t[1]),e}function z(e,t){return e.add(t),e}function G(e,t,r,n){var i=-1,a=e?e.length:0;for(n&&a&&(r=e[++i]);++i<a;)r=t(r,e[i],i,e);return r}function W(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function H(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function q(e,t){return function(r){return e(t(r))}}function J(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var Z,K=Array.prototype,Q=Function.prototype,Y=Object.prototype,X=N["__core-js_shared__"],$=(Z=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||""))?"Symbol(src)_1."+Z:"",ee=Q.toString,te=Y.hasOwnProperty,re=Y.toString,ne=RegExp("^"+ee.call(te).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ie=U?N.Buffer:void 0,ae=N.Symbol,oe=N.Uint8Array,se=q(Object.getPrototypeOf,Object),ce=Object.create,de=Y.propertyIsEnumerable,ue=K.splice,le=Object.getOwnPropertySymbols,pe=ie?ie.isBuffer:void 0,fe=q(Object.keys,Object),he=Fe(N,"DataView"),me=Fe(N,"Map"),ve=Fe(N,"Promise"),ge=Fe(N,"Set"),ye=Fe(N,"WeakMap"),be=Fe(Object,"create"),_e=We(he),Se=We(me),we=We(ve),ke=We(ge),Ce=We(ye),Ae=ae?ae.prototype:void 0,Ee=Ae?Ae.valueOf:void 0;function Re(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Te(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ie(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function xe(e){this.__data__=new Te(e)}function Pe(e,t){var r=qe(e)||function(e){return function(e){return function(e){return!!e&&"object"==i(e)}(e)&&Je(e)}(e)&&te.call(e,"callee")&&(!de.call(e,"callee")||re.call(e)==o)}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,a=!!n;for(var s in e)!t&&!te.call(e,s)||a&&("length"==s||ze(s,n))||r.push(s);return r}function Oe(e,t,r){var n=e[t];te.call(e,t)&&He(n,r)&&(void 0!==r||t in e)||(e[t]=r)}function De(e,t){for(var r=e.length;r--;)if(He(e[r][0],t))return r;return-1}function Me(e,t,r,n,i,a,h){var b;if(n&&(b=a?n(e,i,a,h):n(e)),void 0!==b)return b;if(!Qe(e))return e;var O=qe(e);if(O){if(b=function(e){var t=e.length,r=e.constructor(t);t&&"string"==typeof e[0]&&te.call(e,"index")&&(r.index=e.index,r.input=e.input);return r}(e),!t)return function(e,t){var r=-1,n=e.length;t||(t=Array(n));for(;++r<n;)t[r]=e[r];return t}(e,b)}else{var D=Ve(e),B=D==d||D==u;if(Ze(e))return function(e,t){if(t)return e.slice();var r=new e.constructor(e.length);return e.copy(r),r}(e,t);if(D==f||D==o||B&&!a){if(W(e))return a?e:{};if(b=function(e){return"function"!=typeof e.constructor||Ge(e)?{}:(t=se(e),Qe(t)?ce(t):{});var t}(B?{}:e),!t)return function(e,t){return Ne(e,Ue(e),t)}(e,function(e,t){return e&&Ne(t,Ye(t),e)}(b,e))}else{if(!M[D])return a?e:{};b=function(e,t,r,n){var i=e.constructor;switch(t){case _:return Le(e);case s:case c:return new i(+e);case S:return function(e,t){var r=t?Le(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,n);case w:case k:case C:case A:case E:case R:case T:case I:case x:return function(e,t){var r=t?Le(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(e,n);case l:return function(e,t,r){return G(t?r(H(e),!0):H(e),V,new e.constructor)}(e,n,r);case p:case g:return new i(e);case m:return function(e){var t=new e.constructor(e.source,P.exec(e));return t.lastIndex=e.lastIndex,t}(e);case v:return function(e,t,r){return G(t?r(J(e),!0):J(e),z,new e.constructor)}(e,n,r);case y:return a=e,Ee?Object(Ee.call(a)):{}}var a}(e,D,Me,t)}}h||(h=new xe);var L=h.get(e);if(L)return L;if(h.set(e,b),!O)var N=r?function(e){return function(e,t,r){var n=t(e);return qe(e)?n:function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}(n,r(e))}(e,Ye,Ue)}(e):Ye(e);return function(e,t){for(var r=-1,n=e?e.length:0;++r<n&&!1!==t(e[r],r,e););}(N||e,(function(i,a){N&&(i=e[a=i]),Oe(b,a,Me(i,t,r,n,a,e,h))})),b}function Be(e){return!(!Qe(e)||(t=e,$&&$ in t))&&(Ke(e)||W(e)?ne:O).test(We(e));var t}function Le(e){var t=new e.constructor(e.byteLength);return new oe(t).set(new oe(e)),t}function Ne(e,t,r,n){r||(r={});for(var i=-1,a=t.length;++i<a;){var o=t[i],s=n?n(r[o],e[o],o,r,e):void 0;Oe(r,o,void 0===s?e[o]:s)}return r}function je(e,t){var r,n,a=e.__data__;return("string"==(n=i(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?a["string"==typeof t?"string":"hash"]:a.map}function Fe(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return Be(r)?r:void 0}Re.prototype.clear=function(){this.__data__=be?be(null):{}},Re.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Re.prototype.get=function(e){var t=this.__data__;if(be){var r=t[e];return r===n?void 0:r}return te.call(t,e)?t[e]:void 0},Re.prototype.has=function(e){var t=this.__data__;return be?void 0!==t[e]:te.call(t,e)},Re.prototype.set=function(e,t){return this.__data__[e]=be&&void 0===t?n:t,this},Te.prototype.clear=function(){this.__data__=[]},Te.prototype.delete=function(e){var t=this.__data__,r=De(t,e);return!(r<0)&&(r==t.length-1?t.pop():ue.call(t,r,1),!0)},Te.prototype.get=function(e){var t=this.__data__,r=De(t,e);return r<0?void 0:t[r][1]},Te.prototype.has=function(e){return De(this.__data__,e)>-1},Te.prototype.set=function(e,t){var r=this.__data__,n=De(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},Ie.prototype.clear=function(){this.__data__={hash:new Re,map:new(me||Te),string:new Re}},Ie.prototype.delete=function(e){return je(this,e).delete(e)},Ie.prototype.get=function(e){return je(this,e).get(e)},Ie.prototype.has=function(e){return je(this,e).has(e)},Ie.prototype.set=function(e,t){return je(this,e).set(e,t),this},xe.prototype.clear=function(){this.__data__=new Te},xe.prototype.delete=function(e){return this.__data__.delete(e)},xe.prototype.get=function(e){return this.__data__.get(e)},xe.prototype.has=function(e){return this.__data__.has(e)},xe.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Te){var n=r.__data__;if(!me||n.length<199)return n.push([e,t]),this;r=this.__data__=new Ie(n)}return r.set(e,t),this};var Ue=le?q(le,Object):function(){return[]},Ve=function(e){return re.call(e)};function ze(e,t){return!!(t=null==t?a:t)&&("number"==typeof e||D.test(e))&&e>-1&&e%1==0&&e<t}function Ge(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Y)}function We(e){if(null!=e){try{return ee.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function He(e,t){return e===t||e!=e&&t!=t}(he&&Ve(new he(new ArrayBuffer(1)))!=S||me&&Ve(new me)!=l||ve&&Ve(ve.resolve())!=h||ge&&Ve(new ge)!=v||ye&&Ve(new ye)!=b)&&(Ve=function(e){var t=re.call(e),r=t==f?e.constructor:void 0,n=r?We(r):void 0;if(n)switch(n){case _e:return S;case Se:return l;case we:return h;case ke:return v;case Ce:return b}return t});var qe=Array.isArray;function Je(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=a}(e.length)&&!Ke(e)}var Ze=pe||function(){return!1};function Ke(e){var t=Qe(e)?re.call(e):"";return t==d||t==u}function Qe(e){var t=i(e);return!!e&&("object"==t||"function"==t)}function Ye(e){return Je(e)?Pe(e):function(e){if(!Ge(e))return fe(e);var t=[];for(var r in Object(e))te.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}e.exports=function(e){return Me(e,!0,!0)}})),Te=r((function(e){var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach((function(e){t[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))})),Ie=r((function(e,t){var r=function(e){return String(Number(e))===e?Number(e):e},n=function(e,t,n){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:i?t[e.name]:t;!function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var a=0;a<n.length;a+=1)null!=e[a+1]&&(t[n[a]]=r(e[a+1]))}(n.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach((function(e){var t=e[0],i=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),a=r[r.length-1]);for(var o=0;o<(Te[t]||[]).length;o+=1){var s=Te[t][o];if(s.reg.test(i))return n(s,a,i)}})),t.media=r,t};var a=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length?e[n[0]]=r(n[1]):1===n.length&&t.length>1&&(e[n[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}}))}))}})),xe=/%[sdv%]/g,Pe=function(e){var t=1,r=arguments,n=r.length;return e.replace(xe,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},Oe=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var a=t.names[i];t.name?n.push(r[t.name][a]):n.push(r[t.names[i]])}else n.push(r[t.name]);return Pe.apply(null,n)},De=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Me=["i","c","b","a"],Be={write:function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||De,n=t.innerOrder||Me,i=[];return r.forEach((function(t){Te[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(Oe(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(Oe(t,r,e))}))}))})),e.media.forEach((function(e){i.push(Oe("m",Te.m[0],e)),n.forEach((function(t){Te[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(Oe(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(Oe(t,r,e))}))}))}))})),i.join("\r\n")+"\r\n"},parse:Ie.parse,parseParams:Ie.parseParams,parseFmtpConfig:Ie.parseFmtpConfig,parsePayloads:Ie.parsePayloads,parseRemoteCandidates:Ie.parseRemoteCandidates,parseImageAttributes:Ie.parseImageAttributes,parseSimulcastStreamList:Ie.parseSimulcastStreamList},Le=function(e,t){return void 0!==e&&void 0!==e.media&&Array.isArray(e.media)&&e.media.forEach((function(e){e.sources&&e.sources.length&&(e.ssrcs=[],e.sources.forEach((function(t){Object.keys(t).forEach((function(r){"id"!==r&&e.ssrcs.push({id:t.id,attribute:r,value:t[r]})}))})),delete e.sources),e.ssrcGroups&&e.ssrcGroups.length&&e.ssrcGroups.forEach((function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.ssrcs=e.ssrcs.join(" "))}))})),Be.write(e,t)},Ne=function(e){var t=Be.parse(e);return void 0!==t&&void 0!==t.media&&Array.isArray(t.media)&&t.media.forEach((function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.sources=[],e.ssrcs.forEach((function(t){var r=e.sources.findIndex((function(e){return e.id===t.id}));if(r>-1)e.sources[r][t.attribute]=t.value;else{var n={id:t.id};n[t.attribute]=t.value,e.sources.push(n)}})),delete e.ssrcs),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach((function(e){"string"==typeof e.ssrcs&&(e.ssrcs=e.ssrcs.split(" "))}))})),t},je=["audio","video","data"],Fe=function(e){return e.find((function(e){return"SIM"===e.semantics}))},Ue=function(e){return e.find((function(e){return"FID"===e.semantics}))};function Ve(e,t,r,n){if(e&&t){var i=function(e){return n.find((function(t){return t.id.toString()===e}))};t.ssrcs.forEach((function(t){e.sources.push(i(t));var n=r[parseInt(t,10)].find((function(e){return"FID"===e.semantics}));if(n){var a=n.ssrcs.find((function(e){return e!==t}));e.sources.push(i(a)),e.ssrcGroups.push(n)}})),e.ssrcGroups.push(t)}}function ze(e,t,r,n){if(e&&t){if(e.sources=[],e.ssrcGroups=[],!r[t.id])return e.sources.push(t),void(e.msid=t.msid);var i=Fe(r[t.id]),a=Ue(r[t.id]);if(i)Ve(e,i,r,n);else if(a){var o=a.ssrcs.find((function(e){return e!==t})),s=Fe(r[o]);s?Ve(e,s,r,n):(a.ssrcs.forEach((function(t){e.sources.push(function(e){return n.find((function(t){return t.id.toString()===e}))}(t))})),e.ssrcGroups.push(a))}e.msid=e.sources[0].msid}}function Ge(e,t,r){if(!r.find((function(t){return!!t.sources&&t.sources.some((function(t){return t.id===e.id}))}))){if(!t[e.id])return!1;var n=Fe(t[e.id]),i=Ue(t[e.id]);return n?r.some((function(e){return e.sources&&e.sources.some((function(e){return e.id.toString()===n.ssrcs[0]}))})):!(!i||e.id.toString()===i.ssrcs[0])&&Ge({id:i.ssrcs[0]},t,r)}return!0}function We(e){var t={};return e&&Array.isArray(e)?(e.forEach((function(e){e.ssrcs&&Array.isArray(e.ssrcs)&&e.ssrcs.forEach((function(r){void 0===t[r]&&(t[r]=[]),t[r].push(e)}))})),t):t}var He=function(){function e(){Ce(this,e)}return Ee(e,[{key:"toPlanB",value:function(e){if(!e||"string"!=typeof e.sdp)return e;var t=Ne(e.sdp);if(!t.media||!t.media.length)return e;if(t.media.every((function(e){return-1!==je.indexOf(e.mid)})))return e;var r={},n=t.media;t.media=[],n.forEach((function(e){var t=e.type;if("application"===t)return e.mid="data",void(r[e.mid]=e);if(void 0===r[t]){var n=Re(e);n.sources&&Array.isArray(n.sources)&&n.sources.forEach((function(t){e.msid?t.msid=e.msid:delete t.msid})),n.ssrcGroups&&e.msid||(n.ssrcGroups=[]),delete n.msid,n.mid=t,r[t]=n}else e.msid&&(e.sources&&Array.isArray(e.sources)&&(r[t].sources=(r[t].sources||[]).concat(e.sources)),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&(r[t].ssrcGroups=r[t].ssrcGroups.concat(e.ssrcGroups)))})),t.media=Object.values(r);var i=[];Object.values(r).forEach((function(e){"inactive"!==e.direction&&i.push(e.mid)})),t.groups.forEach((function(e){"BUNDLE"===e.type&&(e.mids=i.join(" "))})),t.msidSemantic={semantic:"WMS",token:"*"};var a=Le(t);return new RTCSessionDescription({type:e.type,sdp:a})}},{key:"toUnifiedPlan",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e||"string"!=typeof e.sdp)return e;var r=Ne(e.sdp);if(!r.media||!r.media.length)return e;if(r.media.length>3||r.media.every((function(e){return-1===je.indexOf(e.mid)})))return e;var n=t?Ne(t.sdp):null,i={};r.media.forEach((function(e){var t=e.type;if("application"!==t){var r=We(e.ssrcGroups);if(e.sources)e.sources.forEach((function(t,a){if(t.msid){if(!n||!n.media){if(Ge(t,r,Object.values(i)))return;var o=Re(e);return o.mid=Object.keys(i).length.toString(),o.direction=a||"sendonly"===e.direction?"sendonly":"sendrecv",o.bundleOnly=void 0,ze(o,t,r,e.sources),void(i[o.mid]=o)}if(!Ge(t,r,n.media)){var s=Re(e);s.mid=n.media.length.toString(),s.direction="sendonly",ze(s,t,r,e.sources),n.media.push(s)}}}));else if(!n){var a=Re(e);a.mid=Object.keys(i).length.toString(),i[e.mid]=a}}else{if(!n||!n.media){var o=Re(e);return o.mid=Object.keys(i).length.toString(),void(i[e.mid]=o)}var s=n.media.findIndex((function(e){return e.type===t}));s&&(n.media[s]=e,n.media[s].mid=s)}})),r.media=n?n.media:Object.values(i);var a=[];r.media.forEach((function(e){a.push(e.mid)})),r.groups.forEach((function(e){"BUNDLE"===e.type&&(e.mids=a.join(" "))})),r.msidSemantic={semantic:"WMS",token:"*"},r.origin.sessionVersion++;var o=Le(r);return new RTCSessionDescription({type:e.type,sdp:o})}}]),e}();function qe(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!(this instanceof qe))return new(Function.prototype.bind.apply(qe,[null].concat(Array.prototype.slice.call(r))));Array.from(r).forEach((function(t){e[t]=Symbol.for("LICODE_SEMANTIC_SDP_".concat(t))}))}var Je=qe("ACTIVE","PASSIVE","ACTPASS","INACTIVE");Je.byValue=function(e){return Je[e.toUpperCase()]},Je.toString=function(e){switch(e){case Je.ACTIVE:return"active";case Je.PASSIVE:return"passive";case Je.ACTPASS:return"actpass";case Je.INACTIVE:return"inactive";default:return null}},Je.reverse=function(e){switch(e){case Je.ACTIVE:return Je.PASSIVE;case Je.PASSIVE:return Je.ACTIVE;case Je.ACTPASS:return Je.PASSIVE;case Je.INACTIVE:return Je.INACTIVE;default:return Je.ACTIVE}};var Ze=qe("SEND","RECV");Ze.byValue=function(e){return Ze[e.toUpperCase()]},Ze.toString=function(e){switch(e){case Ze.SEND:return"send";case Ze.RECV:return"recv";default:return"unknown"}},Ze.reverse=function(e){switch(e){case Ze.SEND:return Ze.RECV;case Ze.RECV:default:return Ze.SEND}};var Ke=qe("SENDRECV","SENDONLY","RECVONLY","INACTIVE");Ke.byValue=function(e){return Ke[e.toUpperCase()]},Ke.toString=function(e){switch(e){case Ke.SENDRECV:return"sendrecv";case Ke.SENDONLY:return"sendonly";case Ke.RECVONLY:return"recvonly";case Ke.INACTIVE:return"inactive";default:return"unknown"}},Ke.reverse=function(e){switch(e){case Ke.SENDRECV:return Ke.SENDRECV;case Ke.SENDONLY:return Ke.RECVONLY;case Ke.RECVONLY:return Ke.SENDONLY;case Ke.INACTIVE:return Ke.INACTIVE;default:return Ke.SENDRECV}};var Qe=function(e){if(Array.isArray(e))return _e(e)};var Ye=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)};var Xe=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var $e=function(e){return Qe(e)||Ye(e)||Se(e)||Xe()},et=function(){var e,t="";e=function(e,t){var r;switch(e){case 4:r=console.error;break;case 3:r=console.warn;break;case 2:r=console.info}(r||console.log).apply(void 0,$e(t))};return{VERBOSE:-1,DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,setLogLevel:function(e){var t=e;e>et.NONE?t=et.NONE:e<et.VERBOSE&&(t=et.VERBOSE),et.logLevel=t},setOutputFunction:function(t){e=t},setLogPrefix:function(e){t=e},log:function(r){var n=t;if(!(r<et.logLevel)){r===et.VERBOSE?n="".concat(n,"VERBOSE"):r===et.DEBUG?n="".concat(n,"DEBUG"):r===et.TRACE?n="".concat(n,"TRACE"):r===et.INFO?n="".concat(n,"INFO"):r===et.WARNING?n="".concat(n,"WARNING"):r===et.ERROR&&(n="".concat(n,"ERROR")),n="".concat(n,": ");for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];var s=[n].concat(a);if(void 0!==et.panel){for(var c="",d=0;d<s.length;d+=1)c+=s[d];et.panel.value="".concat(et.panel.value,"\n").concat(c)}else e.apply(et,[r,s])}},verbose:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];et.log.apply(et,[et.VERBOSE].concat(t))},debug:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];et.log.apply(et,[et.DEBUG].concat(t))},trace:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];et.log.apply(et,[et.TRACE].concat(t))},info:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];et.log.apply(et,[et.INFO].concat(t))},warning:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];et.log.apply(et,[et.WARNING].concat(t))},error:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];et.log.apply(et,[et.ERROR].concat(t))}}}();function tt(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return rt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rt(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function rt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}et.setLogLevel(et.WARNING);var nt={addSim:function(e){var t="a=ssrc-group:SIM";return e.forEach((function(e){t+=" ".concat(e)})),"".concat(t,"\r\n")},addGroup:function(e,t){return"a=ssrc-group:FID ".concat(e," ").concat(t,"\r\n")},addSpatialLayer:function(e,t,r,n,i,a){return"a=ssrc:".concat(i," cname:").concat(e,"\r\n")+"a=ssrc:".concat(i," msid:").concat(t,"\r\n")+"a=ssrc:".concat(i," mslabel:").concat(r,"\r\n")+"a=ssrc:".concat(i," label:").concat(n,"\r\n")+"a=ssrc:".concat(a," cname:").concat(e,"\r\n")+"a=ssrc:".concat(a," msid:").concat(t,"\r\n")+"a=ssrc:".concat(a," mslabel:").concat(r,"\r\n")+"a=ssrc:".concat(a," label:").concat(n,"\r\n")},setVideoMaxBW:function(e,t){var r=e.getMedia("video");r&&r.setBitrate(t)},setAudioMaxBW:function(e,t){var r=e.getMedia("audio");r&&r.setBitrate(t)},enableOpusNacks:function(e){var t=e,r=t.match(/a=rtpmap:(.*)opus.*\r\n/);if(null!==r){var n="".concat(r[0],"a=rtcp-fb:").concat(r[1],"nack\r\n");t=t.replace(r[0],n)}return t},setVideoProfileLevelId:function(e,t){var r,n=e.getMedia("video");n&&(n.getCodecs().forEach((function(e){var n=e.getParams()["profile-level-id"];"h264"===e.getCodec().toLowerCase()&&n&&n.toLowerCase()===t&&(r=e)})),(r=r||n.getCodec("H264"))?r.getParams()["profile-level-id"]===t?et.debug("sdp has h264 codes profile-level-id which media server support",t):(et.warning("modify H264 profile-level-id from ".concat(r.getParams()["profile-level-id"]," to ").concat(t,"(media server only support this)")),r.getParams()["profile-level-id"]=t):et.error("sdp no h264 codes found",n))},filterOutMidExtmap:function(e){e.medias.forEach((function(e){var t,r=tt(e.extensions.entries());try{for(r.s();!(t=r.n()).done;){var n=ke(t.value,2),i=n[0],a=n[1];(a.includes("rtp-hdrext:sdes:mid")||a.includes("rtp-hdrext:sdes:rtp-stream-id")||a.includes("rtp-hdrext:sdes:repaired-rtp-stream-id"))&&e.extensions.delete(i)}}catch(e){r.e(e)}finally{r.f()}}))}};nt.remapExtmap=function(e){var t={ExtensionURI:"ID","urn:ietf:params:rtp-hdrext:ssrc-audio-level":1,"urn:ietf:params:rtp-hdrext:toffset":3,"urn:3gpp:video-orientation":4,"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01":5,"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay":6,"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id":7};e.medias.forEach((function(e){var r=Array.from(e.extensions.values()).filter((function(e){var r=void 0!==t[e];return r||et.verbose("Not support extension: ".concat(e)),r}));e.extensions=function(e){var r=new Map;return e.forEach((function(e){r.set(t[e],e)})),r}(r)}))},nt.setParamForCodecs=function(e,t,r,n){e.medias.forEach((function(e){e.type===t&&e.codecs.forEach((function(e){e.setParam(r,n)}))}))},nt.setParamForCodec=function(e,t,r,n,i){e.medias.forEach((function(e){e.type===t&&e.codecs.forEach((function(e){e.codec===r&&e.setParam(n,i)}))}))},nt.setXGoogleFlag=function(e,t,r){e.medias.forEach((function(e){e.type===t&&e.setXGoogleFlag(r)}))},nt.setOpusParams=function(e,t,r,n){void 0!==t&&(nt.setParamForCodec(e,"audio","opus","sprop-maxcapturerate",t),nt.setParamForCodec(e,"audio","opus","maxplaybackrate",t)),void 0!==r&&nt.setParamForCodec(e,"audio","opus","stereo",r),void 0!==n&&nt.setParamForCodec(e,"audio","opus","maxaveragebitrate",n)};var it="[object Symbol]",at=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ot=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,st="\\u2700-\\u27bf",ct="a-z\\xdf-\\xf6\\xf8-\\xff",dt="A-Z\\xc0-\\xd6\\xd8-\\xde",ut="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",lt="['’]",pt="["+ut+"]",ft="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",ht="\\d+",mt="[\\u2700-\\u27bf]",vt="["+ct+"]",gt="[^\\ud800-\\udfff"+ut+ht+st+ct+dt+"]",yt="(?:\\ud83c[\\udde6-\\uddff]){2}",bt="[\\ud800-\\udbff][\\udc00-\\udfff]",_t="["+dt+"]",St="(?:"+vt+"|"+gt+")",wt="(?:"+_t+"|"+gt+")",kt="(?:['’](?:d|ll|m|re|s|t|ve))?",Ct="(?:['’](?:D|LL|M|RE|S|T|VE))?",At="(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?",Et="[\\ufe0e\\ufe0f]?",Rt=Et+At+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",yt,bt].join("|")+")"+Et+At+")*"),Tt="(?:"+[mt,yt,bt].join("|")+")"+Rt,It=RegExp(lt,"g"),xt=RegExp(ft,"g"),Pt=RegExp([_t+"?"+vt+"+"+kt+"(?="+[pt,_t,"$"].join("|")+")",wt+"+"+Ct+"(?="+[pt,_t+St,"$"].join("|")+")",_t+"?"+St+"+"+kt,_t+"+"+Ct,ht,Tt].join("|"),"g"),Ot=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Dt="object"==("undefined"==typeof global?"undefined":i(global))&&global&&global.Object===Object&&global,Mt="object"==("undefined"==typeof self?"undefined":i(self))&&self&&self.Object===Object&&self,Bt=Dt||Mt||Function("return this")();var Lt,Nt=(Lt={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"ss"},function(e){return null==Lt?void 0:Lt[e]});var jt=Object.prototype.toString,Ft=Bt.Symbol,Ut=Ft?Ft.prototype:void 0,Vt=Ut?Ut.toString:void 0;function zt(e){if("string"==typeof e)return e;if(function(e){return"symbol"==i(e)||function(e){return!!e&&"object"==i(e)}(e)&&jt.call(e)==it}(e))return Vt?Vt.call(e):"";var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}function Gt(e){return null==e?"":zt(e)}var Wt,Ht=(Wt=function(e,t,r){return e+(r?"_":"")+t.toLowerCase()},function(e){return function(e,t,r,n){var i=-1,a=e?e.length:0;for(n&&a&&(r=e[++i]);++i<a;)r=t(r,e[i],i,e);return r}(function(e,t,r){return e=Gt(e),void 0===(t=r?void 0:t)?function(e){return Ot.test(e)}(e)?function(e){return e.match(Pt)||[]}(e):function(e){return e.match(at)||[]}(e):e.match(t)||[]}(function(e){return(e=Gt(e))&&e.replace(ot,Nt).replace(xt,"")}(e).replace(It,"")),Wt,"")});var qt=r((function(e){function t(r,n){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(r,n)}e.exports=t}));var Jt=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qt(e,t)};var Zt=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};var Kt=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?Zt(e):t},Qt=r((function(e){function t(r){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(r)}e.exports=t}));var Yt=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")};var Xt=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}},$t=r((function(e){function t(r,n,i){return Xt()?e.exports=t=Reflect.construct:e.exports=t=function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&qt(i,r.prototype),i},t.apply(null,arguments)}e.exports=t}));function er(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Qt(e);if(t){var i=Qt(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Kt(this,r)}}var tr=function(e){Jt(r,e);var t=er(r);function r(e,n,i){var a;return Ce(this,r),e||et.warning("You must specify message to create VError."),n||et.warning("You must specify code to create VError."),(a=t.call(this,e)).code=n,i instanceof Error&&(a.stack=i.stack),a.name=a.constructor.name,et.error("Code: ".concat(n,", Error: ").concat(e,".")),a}return r}(r((function(e){function t(r){var n="function"==typeof Map?new Map:void 0;return e.exports=t=function(e){if(null===e||!Yt(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return $t(e,arguments,Qt(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),qt(t,e)},t(r)}e.exports=t}))(Error)),rr=777e4;tr.createByErr=function(e){if(!e)return new tr("unknow server error",tr.UNKNOW_SERVER_ERROR);var t=e.message||"unknow server error",r=parseInt(e.code)||tr.UNKNOW_SERVER_ERROR;return new tr(t,r=r>0?r+rr:r-rr)},tr.UNKNOW_SERVER_ERROR=-999,tr.UNKNOW_CLIENT_ERROR=-998,tr.ROOM_RECONNECTING=-997,tr.FATAL_FAILED=-996,tr.STREAM_ENDED=-899,tr.TRACK_ENDED=-898,tr.UNKNOW_ERROR=-897,tr.INVALID_TOKEN=-1e3,tr.JOIN_ROOM_ERROR=-1001,tr.NO_PUBLISH_PERMISSION=-1002,tr.NO_SUBSCRIBE_PERMISSION=-1003,tr.DUPLICATE_LOGIN=-1004,tr.GET_ROOM_INVALID_RESPONSE=-1005,tr.NOT_ACCEPTABLE=-1006,tr.INVALID_SDP=-1010,tr.TIMEOUT=-1050,tr.ADM_INIT_FAILE=-1020,tr.START_CALL=-1021,tr.ADM_NO_PERMISSION=-1022,tr.ADM_NO_MODIFY_PERMISSION=-1023,tr.RENDER_FAILED=-1030,tr.VDM_CAMERA_NOT_AUTHORIZED=-1040,tr.START_CAMERA=-1041,tr.INVALID_INVOKE_SEQUENCE=-1101,tr.INVALID_PARAMETERS=-1102,tr.UNKNOW=-1103,tr.AJAX_TIMEOUT=-1104,tr.AJAX_ERROR=-1105,tr.SOCKET_DISCONNECTED=-1106,tr.AI_SERVER_FAILED=-1107,tr.NO_SCREENSHARE_PLUGIN=-1108,tr.NOT_IN_ROOM=-1200,tr.SERVER_DISCONNECT_WEBSOCKET=-1300,tr.WEBSOCKET_RECONNECT_FAILED=-1301;for(var nr=r((function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function(){return t(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}})),ir=[],ar=0;ar<256;++ar)ir[ar]=(ar+256).toString(16).substr(1);var or=function(e,t){var r=t||0,n=ir;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")};var sr=function(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||nr)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var a=0;a<16;++a)t[n+a]=i[a];return t||or(i)};function cr(e){return e instanceof Error?JSON.stringify(e,Object.getOwnPropertyNames(e)):JSON.stringify(e)}function dr(e){return Promise.all(e.map((function(e){return e.then((function(e){return Promise.reject(e)}),(function(e){return Promise.resolve(e)}))}))).then((function(e){return Promise.reject(e)}),(function(e){return Promise.resolve(e)}))}function ur(){return(ur=ve(ge.mark((function e(t){var r,n,i,a,o,s,c,d,u,l,p;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.urls,n=(new Date).getTime(),e.next=4,dr(r.map((function(e){return br(e,{keys:["ntp"]})})));case 4:if(i=e.sent,a=(new Date).getTime(),!i||"success"!==i.message){e.next=16;break}return o=i.data,s=a-n,c=o.ntp,d=c.server_ip,u=c.timestamp,l=u-parseInt(s/2),p=l-n,window.server_client_offset_time=p,e.abrupt("return","getServerClientTimeOffset success : param : ".concat(JSON.stringify(t),",report_data : ").concat(JSON.stringify({clientTime:new Date,rtt:s,serverTimeStamp:u,serverIP:d,offsetTime:p})));case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lr(e){var t=!1;return function(){if(!t)return t=!0,e.apply(null,arguments)}}function pr(e){performance.mark(e+"_mark1")}function fr(e){performance.mark(e+"_mark2")}function hr(e){performance.mark(e+"_mark3")}function mr(e){performance.mark(e+"_mark4")}function vr(e){performance.mark(e+"_mark5")}function gr(e,t,r){performance.measure(e,t,r);var n=performance.getEntriesByName(e)[0];return parseInt(n.duration)}function yr(e){var t={streamId:e};function r(t){return performance.getEntriesByName(e+t).length>0}return r("_mark1")&&r("_mark7")&&(t.total=gr(e+"_total",e+"_mark1",e+"_mark7")),r("_mark1")&&r("_mark2")&&(t.createPC=gr(e+"_createPC",e+"_mark1",e+"_mark2")),r("_mark2")&&r("_mark3")&&(t.setOffer=gr(e+"_setOffer",e+"_mark2",e+"_mark3")),r("_mark3")&&r("_mark4")&&(t.exchangeSDP=gr(e+"_exchangeSDP",e+"_mark3",e+"_mark4")),r("_mark4")&&r("_mark5")&&(t.setAnswer=gr(e+"_setAnswer",e+"_mark4",e+"_mark5")),r("_mark5")&&r("_mark6")&&(t.firstAudioFrame=gr(e+"_firstFrame",e+"_mark5",e+"_mark6")),r("_mark5")&&r("_mark7")&&(t.firstVideoFrame=gr(e+"_firstFrame",e+"_mark5",e+"_mark7")),function(e){[1,2,3,4,5,7].forEach((function(t){performance.clearMarks(e+"_mark"+t)})),["_total"].forEach((function(t){performance.clearMeasures(e+t)}))}(e),t}function br(e,t){return et.debug("http post url:",e,t),function(e,t,r,n,i){return new Promise((function(a,o){var s=new XMLHttpRequest;s.timeout=1e4,s.ontimeout=function(){o(new tr("request to '".concat(t,"' timeout"),tr.AJAX_TIMEOUT))},s.onerror=function(){o(new tr("request to '".concat(t,"' error"),tr.AJAX_ERROR))},s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status||304===s.status){var e;"text"===i?e=s.responseText:(e=JSON.parse(s.responseText)).url=t,a(e)}else{var r=new tr(s.responseText||"req.onreadystatechange",s.status,s);o(r)}},s.open(e,t,!0),n&&s.setRequestHeader("Authorization",n.replace(/[\r\n]/g,"")),s.send(JSON.stringify(r))}))}("POST",e,t)}var _r=null;try{_r=window.localStorage}catch(Tn){var Sr={};_r={getItem:function(e){return Sr[e]||null},setItem:function(e,t){return Sr[e]=t},clear:function(){return Sr={}}}}var wr="RTC_RECORD",kr="RTC_DEVICE_ID_USE_UUID";function Cr(){return _r.getItem(wr)||_r.setItem(wr,JSON.stringify(e({},kr,{data:sr(),timestamp:Number.MAX_SAFE_INTEGER}))),JSON.parse(_r.getItem(wr))}function Ar(e,t){var r=Cr(),n={data:t,timestamp:Date.now()};r[e]=n,_r.setItem(wr,JSON.stringify(r))}function Er(e,t){var r=Cr()[e];return r&&Date.now()-r.timestamp<1e3*t?r.data:null}function Rr(e){return Er(e,604800)}function Tr(){var e=Cr();Object.keys(e).forEach((function(t){Er(t,3600)||delete e[t]})),_r.setItem(wr,JSON.stringify(e))}function Ir(e){return e.split("/")[2]}function xr(){return sr.v4()}function Pr(){var e=+"".concat(Math.random()).slice(-7).padEnd(7,"0");if(e>Math.pow(2,28)||e<0)throw new Error("illegal id ".concat(e,", the range of id is [0, 2^28]"));for(var t=e.toString(2).padEnd(28,"1").split(""),r=[];t.length;)r.push(t.splice(0,7));return r.map((function(e,t){var n=t===r.length-1?"0":"1";return Number.parseInt(n+e.join(""),2)}))}var Or=r((function(e,t){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!==i(r))throw new TypeError(r+"must be non-object");for(var a in r)n(r,a)&&(e[a]=r[a])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){var t,r,n,i,a,o;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(o=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)a=e[t],o.set(a,i),i+=a.length;return o}},o={arraySet:function(e,t,r,n,i){for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(r)}));function Dr(e){for(var t=e.length;--t>=0;)e[t]=0}var Mr=256,Br=286,Lr=30,Nr=15,jr=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Fr=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ur=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Vr=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],zr=new Array(576);Dr(zr);var Gr=new Array(60);Dr(Gr);var Wr=new Array(512);Dr(Wr);var Hr=new Array(256);Dr(Hr);var qr=new Array(29);Dr(qr);var Jr,Zr,Kr,Qr=new Array(Lr);function Yr(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function Xr(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function $r(e){return e<256?Wr[e]:Wr[256+(e>>>7)]}function en(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function tn(e,t,r){e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,en(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function rn(e,t,r){tn(e,r[2*t],r[2*t+1])}function nn(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function an(e,t,r){var n,i,a=new Array(16),o=0;for(n=1;n<=Nr;n++)a[n]=o=o+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=nn(a[s]++,s))}}function on(e){var t;for(t=0;t<Br;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Lr;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function sn(e){e.bi_valid>8?en(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function cn(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function dn(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&cn(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!cn(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function un(e,t,r){var n,i,a,o,s=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===n?rn(e,i,t):(rn(e,(a=Hr[i])+Mr+1,t),0!==(o=jr[a])&&tn(e,i-=qr[a],o),rn(e,a=$r(--n),r),0!==(o=Fr[a])&&tn(e,n-=Qr[a],o))}while(s<e.last_lit);rn(e,256,t)}function ln(e,t){var r,n,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<c;r++)0!==a[2*r]?(e.heap[++e.heap_len]=d=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=d,r=e.heap_len>>1;r>=1;r--)dn(e,a,r);i=c;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],dn(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,dn(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,a,o,s,c=t.dyn_tree,d=t.max_code,u=t.stat_desc.static_tree,l=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,h=t.stat_desc.max_length,m=0;for(a=0;a<=Nr;a++)e.bl_count[a]=0;for(c[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<573;r++)(a=c[2*c[2*(n=e.heap[r])+1]+1]+1)>h&&(a=h,m++),c[2*n+1]=a,n>d||(e.bl_count[a]++,o=0,n>=f&&(o=p[n-f]),s=c[2*n],e.opt_len+=s*(a+o),l&&(e.static_len+=s*(u[2*n+1]+o)));if(0!==m){do{for(a=h-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[h]--,m-=2}while(m>0);for(a=h;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>d||(c[2*i+1]!==a&&(e.opt_len+=(a-c[2*i+1])*c[2*i],c[2*i+1]=a),n--)}}(e,t),an(a,d,e.bl_count)}function pn(e,t,r){var n,i,a=-1,o=t[1],s=0,c=7,d=4;for(0===o&&(c=138,d=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=o,o=t[2*(n+1)+1],++s<c&&i===o||(s<d?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(c=138,d=3):i===o?(c=6,d=3):(c=7,d=4))}function fn(e,t,r){var n,i,a=-1,o=t[1],s=0,c=7,d=4;for(0===o&&(c=138,d=3),n=0;n<=r;n++)if(i=o,o=t[2*(n+1)+1],!(++s<c&&i===o)){if(s<d)do{rn(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(rn(e,i,e.bl_tree),s--),rn(e,16,e.bl_tree),tn(e,s-3,2)):s<=10?(rn(e,17,e.bl_tree),tn(e,s-3,3)):(rn(e,18,e.bl_tree),tn(e,s-11,7));s=0,a=i,0===o?(c=138,d=3):i===o?(c=6,d=3):(c=7,d=4)}}Dr(Qr);var hn=!1;function mn(e,t,r,n){tn(e,0+(n?1:0),3),function(e,t,r,n){sn(e),n&&(en(e,r),en(e,~r)),Or.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}var vn={_tr_init:function(e){hn||(!function(){var e,t,r,n,i,a=new Array(16);for(r=0,n=0;n<28;n++)for(qr[n]=r,e=0;e<1<<jr[n];e++)Hr[r++]=n;for(Hr[r-1]=n,i=0,n=0;n<16;n++)for(Qr[n]=i,e=0;e<1<<Fr[n];e++)Wr[i++]=n;for(i>>=7;n<Lr;n++)for(Qr[n]=i<<7,e=0;e<1<<Fr[n]-7;e++)Wr[256+i++]=n;for(t=0;t<=Nr;t++)a[t]=0;for(e=0;e<=143;)zr[2*e+1]=8,e++,a[8]++;for(;e<=255;)zr[2*e+1]=9,e++,a[9]++;for(;e<=279;)zr[2*e+1]=7,e++,a[7]++;for(;e<=287;)zr[2*e+1]=8,e++,a[8]++;for(an(zr,287,a),e=0;e<Lr;e++)Gr[2*e+1]=5,Gr[2*e]=nn(e,5);Jr=new Yr(zr,jr,257,Br,Nr),Zr=new Yr(Gr,Fr,0,Lr,Nr),Kr=new Yr(new Array(0),Ur,0,19,7)}(),hn=!0),e.l_desc=new Xr(e.dyn_ltree,Jr),e.d_desc=new Xr(e.dyn_dtree,Zr),e.bl_desc=new Xr(e.bl_tree,Kr),e.bi_buf=0,e.bi_valid=0,on(e)},_tr_stored_block:mn,_tr_flush_block:function(e,t,r,n){var i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<Mr;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),ln(e,e.l_desc),ln(e,e.d_desc),o=function(e){var t;for(pn(e,e.dyn_ltree,e.l_desc.max_code),pn(e,e.dyn_dtree,e.d_desc.max_code),ln(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Vr[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=r+5,r+4<=i&&-1!==t?mn(e,t,r,n):4===e.strategy||a===i?(tn(e,2+(n?1:0),3),un(e,zr,Gr)):(tn(e,4+(n?1:0),3),function(e,t,r,n){var i;for(tn(e,t-257,5),tn(e,r-1,5),tn(e,n-4,4),i=0;i<n;i++)tn(e,e.bl_tree[2*Vr[i]+1],3);fn(e,e.dyn_ltree,t-1),fn(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),un(e,e.dyn_ltree,e.dyn_dtree)),on(e),n&&sn(e)},_tr_tally:function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(Hr[r]+Mr+1)]++,e.dyn_dtree[2*$r(t)]++),e.last_lit===e.lit_bufsize-1},_tr_align:function(e){tn(e,2,3),rn(e,256,zr),function(e){16===e.bi_valid?(en(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}};var gn=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{a=a+(i=i+t[n++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0};var yn=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();var bn,_n=function(e,t,r,n){var i=yn,a=n+r;e^=-1;for(var o=n;o<a;o++)e=e>>>8^i[255&(e^t[o])];return-1^e},Sn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},wn=-2,kn=258,Cn=262,An=103,En=113,Rn=666;function Tn(e,t){return e.msg=Sn[t],t}function In(e){return(e<<1)-(e>4?9:0)}function xn(e){for(var t=e.length;--t>=0;)e[t]=0}function Pn(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(Or.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function On(e,t){vn._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Pn(e.strm)}function Dn(e,t){e.pending_buf[e.pending++]=t}function Mn(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function Bn(e,t){var r,n,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-Cn?e.strstart-(e.w_size-Cn):0,d=e.window,u=e.w_mask,l=e.prev,p=e.strstart+kn,f=d[a+o-1],h=d[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(d[(r=t)+o]===h&&d[r+o-1]===f&&d[r]===d[a]&&d[++r]===d[a+1]){a+=2,r++;do{}while(d[++a]===d[++r]&&d[++a]===d[++r]&&d[++a]===d[++r]&&d[++a]===d[++r]&&d[++a]===d[++r]&&d[++a]===d[++r]&&d[++a]===d[++r]&&d[++a]===d[++r]&&a<p);if(n=kn-(p-a),a=p-kn,n>o){if(e.match_start=t,o=n,n>=s)break;f=d[a+o-1],h=d[a+o]}}}while((t=l[t&u])>c&&0!=--i);return o<=e.lookahead?o:e.lookahead}function Ln(e){var t,r,n,i,a,o,s,c,d,u,l=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=l+(l-Cn)){Or.arraySet(e.window,e.window,l,l,0),e.match_start-=l,e.strstart-=l,e.block_start-=l,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=l?n-l:0}while(--r);t=r=l;do{n=e.prev[--t],e.prev[t]=n>=l?n-l:0}while(--r);i+=l}if(0===e.strm.avail_in)break;if(o=e.strm,s=e.window,c=e.strstart+e.lookahead,d=i,u=void 0,(u=o.avail_in)>d&&(u=d),r=0===u?0:(o.avail_in-=u,Or.arraySet(s,o.input,o.next_in,u,c),1===o.state.wrap?o.adler=gn(o.adler,s,u,c):2===o.state.wrap&&(o.adler=_n(o.adler,s,u,c)),o.next_in+=u,o.total_in+=u,u),e.lookahead+=r,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+3-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Cn&&0!==e.strm.avail_in)}function Nn(e,t){for(var r,n;;){if(e.lookahead<Cn){if(Ln(e),e.lookahead<Cn&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-Cn&&(e.match_length=Bn(e,r)),e.match_length>=3)if(n=vn._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=vn._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(On(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(On(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(On(e,!1),0===e.strm.avail_out)?1:2}function jn(e,t){for(var r,n,i;;){if(e.lookahead<Cn){if(Ln(e),e.lookahead<Cn&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Cn&&(e.match_length=Bn(e,r),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=vn._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(On(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((n=vn._tr_tally(e,0,e.window[e.strstart-1]))&&On(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=vn._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(On(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(On(e,!1),0===e.strm.avail_out)?1:2}function Fn(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function Un(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Or.Buf16(1146),this.dyn_dtree=new Or.Buf16(122),this.bl_tree=new Or.Buf16(78),xn(this.dyn_ltree),xn(this.dyn_dtree),xn(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Or.Buf16(16),this.heap=new Or.Buf16(573),xn(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Or.Buf16(573),xn(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Vn(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:En,e.adler=2===t.wrap?0:1,t.last_flush=0,vn._tr_init(t),0):Tn(e,wn)}function zn(e){var t,r=Vn(e);return 0===r&&((t=e.state).window_size=2*t.w_size,xn(t.head),t.max_lazy_match=bn[t.level].max_lazy,t.good_match=bn[t.level].good_length,t.nice_match=bn[t.level].nice_length,t.max_chain_length=bn[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),r}function Gn(e,t,r,n,i,a){if(!e)return wn;var o=1;if(-1===t&&(t=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),i<1||i>9||8!==r||n<8||n>15||t<0||t>9||a<0||a>4)return Tn(e,wn);8===n&&(n=9);var s=new Un;return e.state=s,s.strm=e,s.wrap=o,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Or.Buf8(2*s.w_size),s.head=new Or.Buf16(s.hash_size),s.prev=new Or.Buf16(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Or.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=a,s.method=r,zn(e)}bn=[new Fn(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Ln(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,On(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-Cn&&(On(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(On(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(On(e,!1),e.strm.avail_out),1)})),new Fn(4,4,8,4,Nn),new Fn(4,5,16,8,Nn),new Fn(4,6,32,32,Nn),new Fn(4,4,16,16,jn),new Fn(8,16,32,32,jn),new Fn(8,16,128,128,jn),new Fn(8,32,128,256,jn),new Fn(32,128,258,1024,jn),new Fn(32,258,258,4096,jn)];var Wn={deflateInit:function(e,t){return Gn(e,t,8,15,8,0)},deflateInit2:Gn,deflateReset:zn,deflateResetKeep:Vn,deflateSetHeader:function(e,t){return e&&e.state?2!==e.state.wrap?wn:(e.state.gzhead=t,0):wn},deflate:function(e,t){var r,n,i,a;if(!e||!e.state||t>5||t<0)return e?Tn(e,wn):wn;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||n.status===Rn&&4!==t)return Tn(e,0===e.avail_out?-5:wn);if(n.strm=e,r=n.last_flush,n.last_flush=t,42===n.status)if(2===n.wrap)e.adler=0,Dn(n,31),Dn(n,139),Dn(n,8),n.gzhead?(Dn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Dn(n,255&n.gzhead.time),Dn(n,n.gzhead.time>>8&255),Dn(n,n.gzhead.time>>16&255),Dn(n,n.gzhead.time>>24&255),Dn(n,9===n.level?2:n.strategy>=2||n.level<2?4:0),Dn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Dn(n,255&n.gzhead.extra.length),Dn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=_n(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(Dn(n,0),Dn(n,0),Dn(n,0),Dn(n,0),Dn(n,0),Dn(n,9===n.level?2:n.strategy>=2||n.level<2?4:0),Dn(n,3),n.status=En);else{var o=8+(n.w_bits-8<<4)<<8;o|=(n.strategy>=2||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(o|=32),o+=31-o%31,n.status=En,Mn(n,o),0!==n.strstart&&(Mn(n,e.adler>>>16),Mn(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(e.adler=_n(e.adler,n.pending_buf,n.pending-i,i)),Pn(e),i=n.pending,n.pending!==n.pending_buf_size));)Dn(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(e.adler=_n(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=_n(e.adler,n.pending_buf,n.pending-i,i)),Pn(e),i=n.pending,n.pending===n.pending_buf_size)){a=1;break}a=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Dn(n,a)}while(0!==a);n.gzhead.hcrc&&n.pending>i&&(e.adler=_n(e.adler,n.pending_buf,n.pending-i,i)),0===a&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=_n(e.adler,n.pending_buf,n.pending-i,i)),Pn(e),i=n.pending,n.pending===n.pending_buf_size)){a=1;break}a=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Dn(n,a)}while(0!==a);n.gzhead.hcrc&&n.pending>i&&(e.adler=_n(e.adler,n.pending_buf,n.pending-i,i)),0===a&&(n.status=An)}else n.status=An;if(n.status===An&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&Pn(e),n.pending+2<=n.pending_buf_size&&(Dn(n,255&e.adler),Dn(n,e.adler>>8&255),e.adler=0,n.status=En)):n.status=En),0!==n.pending){if(Pn(e),0===e.avail_out)return n.last_flush=-1,0}else if(0===e.avail_in&&In(t)<=In(r)&&4!==t)return Tn(e,-5);if(n.status===Rn&&0!==e.avail_in)return Tn(e,-5);if(0!==e.avail_in||0!==n.lookahead||0!==t&&n.status!==Rn){var s=2===n.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(Ln(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,r=vn._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(On(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(On(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(On(e,!1),0===e.strm.avail_out)?1:2}(n,t):3===n.strategy?function(e,t){for(var r,n,i,a,o=e.window;;){if(e.lookahead<=kn){if(Ln(e),e.lookahead<=kn&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=o[i=e.strstart-1])===o[++i]&&n===o[++i]&&n===o[++i]){a=e.strstart+kn;do{}while(n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&i<a);e.match_length=kn-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=vn._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=vn._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(On(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(On(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(On(e,!1),0===e.strm.avail_out)?1:2}(n,t):bn[n.level].func(n,t);if(3!==s&&4!==s||(n.status=Rn),1===s||3===s)return 0===e.avail_out&&(n.last_flush=-1),0;if(2===s&&(1===t?vn._tr_align(n):5!==t&&(vn._tr_stored_block(n,0,0,!1),3===t&&(xn(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),Pn(e),0===e.avail_out))return n.last_flush=-1,0}return 4!==t?0:n.wrap<=0?1:(2===n.wrap?(Dn(n,255&e.adler),Dn(n,e.adler>>8&255),Dn(n,e.adler>>16&255),Dn(n,e.adler>>24&255),Dn(n,255&e.total_in),Dn(n,e.total_in>>8&255),Dn(n,e.total_in>>16&255),Dn(n,e.total_in>>24&255)):(Mn(n,e.adler>>>16),Mn(n,65535&e.adler)),Pn(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?0:1)},deflateEnd:function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==An&&t!==En&&t!==Rn?Tn(e,wn):(e.state=null,t===En?Tn(e,-3):0):wn},deflateSetDictionary:function(e,t){var r,n,i,a,o,s,c,d,u=t.length;if(!e||!e.state)return wn;if(2===(a=(r=e.state).wrap)||1===a&&42!==r.status||r.lookahead)return wn;for(1===a&&(e.adler=gn(e.adler,t,u,0)),r.wrap=0,u>=r.w_size&&(0===a&&(xn(r.head),r.strstart=0,r.block_start=0,r.insert=0),d=new Or.Buf8(r.w_size),Or.arraySet(d,t,u-r.w_size,r.w_size,0),t=d,u=r.w_size),o=e.avail_in,s=e.next_in,c=e.input,e.avail_in=u,e.next_in=0,e.input=t,Ln(r);r.lookahead>=3;){n=r.strstart,i=r.lookahead-2;do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+3-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--i);r.strstart=n,r.lookahead=2,Ln(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=c,e.avail_in=o,r.wrap=a,0},deflateInfo:"pako deflate (from Nodeca project)"},Hn=!0,qn=!0;try{String.fromCharCode.apply(null,[0])}catch(e){Hn=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){qn=!1}for(var Jn=new Or.Buf8(256),Zn=0;Zn<256;Zn++)Jn[Zn]=Zn>=252?6:Zn>=248?5:Zn>=240?4:Zn>=224?3:Zn>=192?2:1;Jn[254]=Jn[254]=1;function Kn(e,t){if(t<65534&&(e.subarray&&qn||!e.subarray&&Hn))return String.fromCharCode.apply(null,Or.shrinkBuf(e,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}var Qn=function(e){var t,r,n,i,a,o=e.length,s=0;for(i=0;i<o;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<o&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Or.Buf8(s),a=0,i=0;a<s;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<o&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[a++]=r:r<2048?(t[a++]=192|r>>>6,t[a++]=128|63&r):r<65536?(t[a++]=224|r>>>12,t[a++]=128|r>>>6&63,t[a++]=128|63&r):(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63,t[a++]=128|r>>>6&63,t[a++]=128|63&r);return t},Yn=function(e){return Kn(e,e.length)},Xn=function(e){for(var t=new Or.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},$n=function(e,t){var r,n,i,a,o=t||e.length,s=new Array(2*o);for(n=0,r=0;r<o;)if((i=e[r++])<128)s[n++]=i;else if((a=Jn[i])>4)s[n++]=65533,r+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&r<o;)i=i<<6|63&e[r++],a--;a>1?s[n++]=65533:i<65536?s[n++]=i:(i-=65536,s[n++]=55296|i>>10&1023,s[n++]=56320|1023&i)}return Kn(s,n)},ei=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+Jn[e[r]]>t?r:t};var ti=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},ri=Object.prototype.toString;function ni(e){if(!(this instanceof ni))return new ni(e);this.options=Or.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ti,this.strm.avail_out=0;var r=Wn.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==r)throw new Error(Sn[r]);if(t.header&&Wn.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n="string"==typeof t.dictionary?Qn(t.dictionary):"[object ArrayBuffer]"===ri.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(r=Wn.deflateSetDictionary(this.strm,n)))throw new Error(Sn[r]);this._dict_set=!0}}function ii(e,t){var r=new ni(t);if(r.push(e,!0),r.err)throw r.msg||Sn[r.err];return r.result}ni.prototype.push=function(e,t){var r,n,i=this.strm,a=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?4:0,"string"==typeof e?i.input=Qn(e):"[object ArrayBuffer]"===ri.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new Or.Buf8(a),i.next_out=0,i.avail_out=a),1!==(r=Wn.deflate(i,n))&&0!==r)return this.onEnd(r),this.ended=!0,!1;0!==i.avail_out&&(0!==i.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(Yn(Or.shrinkBuf(i.output,i.next_out))):this.onData(Or.shrinkBuf(i.output,i.next_out)))}while((i.avail_in>0||0===i.avail_out)&&1!==r);return 4===n?(r=Wn.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r):2!==n||(this.onEnd(0),i.avail_out=0,!0)},ni.prototype.onData=function(e){this.chunks.push(e)},ni.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Or.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ai={Deflate:ni,deflate:ii,deflateRaw:function(e,t){return(t=t||{}).raw=!0,ii(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,ii(e,t)}},oi=function(e,t){var r,n,i,a,o,s,c,d,u,l,p,f,h,m,v,g,y,b,_,S,w,k,C,A,E;r=e.state,n=e.next_in,A=e.input,i=n+(e.avail_in-5),a=e.next_out,E=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),c=r.dmax,d=r.wsize,u=r.whave,l=r.wnext,p=r.window,f=r.hold,h=r.bits,m=r.lencode,v=r.distcode,g=(1<<r.lenbits)-1,y=(1<<r.distbits)-1;e:do{h<15&&(f+=A[n++]<<h,h+=8,f+=A[n++]<<h,h+=8),b=m[f&g];t:for(;;){if(f>>>=_=b>>>24,h-=_,0===(_=b>>>16&255))E[a++]=65535&b;else{if(!(16&_)){if(0==(64&_)){b=m[(65535&b)+(f&(1<<_)-1)];continue t}if(32&_){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}S=65535&b,(_&=15)&&(h<_&&(f+=A[n++]<<h,h+=8),S+=f&(1<<_)-1,f>>>=_,h-=_),h<15&&(f+=A[n++]<<h,h+=8,f+=A[n++]<<h,h+=8),b=v[f&y];r:for(;;){if(f>>>=_=b>>>24,h-=_,!(16&(_=b>>>16&255))){if(0==(64&_)){b=v[(65535&b)+(f&(1<<_)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(w=65535&b,h<(_&=15)&&(f+=A[n++]<<h,(h+=8)<_&&(f+=A[n++]<<h,h+=8)),(w+=f&(1<<_)-1)>c){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=_,h-=_,w>(_=a-o)){if((_=w-_)>u&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(k=0,C=p,0===l){if(k+=d-_,_<S){S-=_;do{E[a++]=p[k++]}while(--_);k=a-w,C=E}}else if(l<_){if(k+=d+l-_,(_-=l)<S){S-=_;do{E[a++]=p[k++]}while(--_);if(k=0,l<S){S-=_=l;do{E[a++]=p[k++]}while(--_);k=a-w,C=E}}}else if(k+=l-_,_<S){S-=_;do{E[a++]=p[k++]}while(--_);k=a-w,C=E}for(;S>2;)E[a++]=C[k++],E[a++]=C[k++],E[a++]=C[k++],S-=3;S&&(E[a++]=C[k++],S>1&&(E[a++]=C[k++]))}else{k=a-w;do{E[a++]=E[k++],E[a++]=E[k++],E[a++]=E[k++],S-=3}while(S>2);S&&(E[a++]=E[k++],S>1&&(E[a++]=E[k++]))}break}}break}}while(n<i&&a<s);n-=S=h>>3,f&=(1<<(h-=S<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=a<s?s-a+257:257-(a-s),r.hold=f,r.bits=h},si=15,ci=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],di=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],ui=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],li=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],pi=function(e,t,r,n,i,a,o,s){var c,d,u,l,p,f,h,m,v,g=s.bits,y=0,b=0,_=0,S=0,w=0,k=0,C=0,A=0,E=0,R=0,T=null,I=0,x=new Or.Buf16(16),P=new Or.Buf16(16),O=null,D=0;for(y=0;y<=si;y++)x[y]=0;for(b=0;b<n;b++)x[t[r+b]]++;for(w=g,S=si;S>=1&&0===x[S];S--);if(w>S&&(w=S),0===S)return i[a++]=20971520,i[a++]=20971520,s.bits=1,0;for(_=1;_<S&&0===x[_];_++);for(w<_&&(w=_),A=1,y=1;y<=si;y++)if(A<<=1,(A-=x[y])<0)return-1;if(A>0&&(0===e||1!==S))return-1;for(P[1]=0,y=1;y<si;y++)P[y+1]=P[y]+x[y];for(b=0;b<n;b++)0!==t[r+b]&&(o[P[t[r+b]]++]=b);if(0===e?(T=O=o,f=19):1===e?(T=ci,I-=257,O=di,D-=257,f=256):(T=ui,O=li,f=-1),R=0,b=0,y=_,p=a,k=w,C=0,u=-1,l=(E=1<<w)-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){h=y-C,o[b]<f?(m=0,v=o[b]):o[b]>f?(m=O[D+o[b]],v=T[I+o[b]]):(m=96,v=0),c=1<<y-C,_=d=1<<k;do{i[p+(R>>C)+(d-=c)]=h<<24|m<<16|v|0}while(0!==d);for(c=1<<y-1;R&c;)c>>=1;if(0!==c?(R&=c-1,R+=c):R=0,b++,0==--x[y]){if(y===S)break;y=t[r+o[b]]}if(y>w&&(R&l)!==u){for(0===C&&(C=w),p+=_,A=1<<(k=y-C);k+C<S&&!((A-=x[k+C])<=0);)k++,A<<=1;if(E+=1<<k,1===e&&E>852||2===e&&E>592)return 1;i[u=R&l]=w<<24|k<<16|p-a|0}}return 0!==R&&(i[p+R]=y-C<<24|64<<16|0),s.bits=w,0},fi=-2,hi=12,mi=30;function vi(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function gi(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Or.Buf16(320),this.work=new Or.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function yi(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Or.Buf32(852),t.distcode=t.distdyn=new Or.Buf32(592),t.sane=1,t.back=-1,0):fi}function bi(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,yi(e)):fi}function _i(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?fi:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,bi(e))):fi}function Si(e,t){var r,n;return e?(n=new gi,e.state=n,n.window=null,0!==(r=_i(e,t))&&(e.state=null),r):fi}var wi,ki,Ci=!0;function Ai(e){if(Ci){var t;for(wi=new Or.Buf32(512),ki=new Or.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(pi(1,e.lens,0,288,wi,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;pi(2,e.lens,0,32,ki,0,e.work,{bits:5}),Ci=!1}e.lencode=wi,e.lenbits=9,e.distcode=ki,e.distbits=5}function Ei(e,t,r,n){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Or.Buf8(a.wsize)),n>=a.wsize?(Or.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>n&&(i=n),Or.arraySet(a.window,t,r-n,i,a.wnext),(n-=i)?(Or.arraySet(a.window,t,r-n,n,0),a.wnext=n,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}var Ri={inflateReset:bi,inflateReset2:_i,inflateResetKeep:yi,inflateInit:function(e){return Si(e,15)},inflateInit2:Si,inflate:function(e,t){var r,n,i,a,o,s,c,d,u,l,p,f,h,m,v,g,y,b,_,S,w,k,C,A,E=0,R=new Or.Buf8(4),T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return fi;(r=e.state).mode===hi&&(r.mode=13),o=e.next_out,i=e.output,c=e.avail_out,a=e.next_in,n=e.input,s=e.avail_in,d=r.hold,u=r.bits,l=s,p=c,k=0;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;u<16;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(2&r.wrap&&35615===d){r.check=0,R[0]=255&d,R[1]=d>>>8&255,r.check=_n(r.check,R,2,0),d=0,u=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",r.mode=mi;break}if(8!=(15&d)){e.msg="unknown compression method",r.mode=mi;break}if(u-=4,w=8+(15&(d>>>=4)),0===r.wbits)r.wbits=w;else if(w>r.wbits){e.msg="invalid window size",r.mode=mi;break}r.dmax=1<<w,e.adler=r.check=1,r.mode=512&d?10:hi,d=0,u=0;break;case 2:for(;u<16;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(r.flags=d,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=mi;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=mi;break}r.head&&(r.head.text=d>>8&1),512&r.flags&&(R[0]=255&d,R[1]=d>>>8&255,r.check=_n(r.check,R,2,0)),d=0,u=0,r.mode=3;case 3:for(;u<32;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}r.head&&(r.head.time=d),512&r.flags&&(R[0]=255&d,R[1]=d>>>8&255,R[2]=d>>>16&255,R[3]=d>>>24&255,r.check=_n(r.check,R,4,0)),d=0,u=0,r.mode=4;case 4:for(;u<16;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}r.head&&(r.head.xflags=255&d,r.head.os=d>>8),512&r.flags&&(R[0]=255&d,R[1]=d>>>8&255,r.check=_n(r.check,R,2,0)),d=0,u=0,r.mode=5;case 5:if(1024&r.flags){for(;u<16;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}r.length=d,r.head&&(r.head.extra_len=d),512&r.flags&&(R[0]=255&d,R[1]=d>>>8&255,r.check=_n(r.check,R,2,0)),d=0,u=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((f=r.length)>s&&(f=s),f&&(r.head&&(w=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),Or.arraySet(r.head.extra,n,a,f,w)),512&r.flags&&(r.check=_n(r.check,n,f,a)),s-=f,a+=f,r.length-=f),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===s)break e;f=0;do{w=n[a+f++],r.head&&w&&r.length<65536&&(r.head.name+=String.fromCharCode(w))}while(w&&f<s);if(512&r.flags&&(r.check=_n(r.check,n,f,a)),s-=f,a+=f,w)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===s)break e;f=0;do{w=n[a+f++],r.head&&w&&r.length<65536&&(r.head.comment+=String.fromCharCode(w))}while(w&&f<s);if(512&r.flags&&(r.check=_n(r.check,n,f,a)),s-=f,a+=f,w)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;u<16;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(d!==(65535&r.check)){e.msg="header crc mismatch",r.mode=mi;break}d=0,u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=hi;break;case 10:for(;u<32;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}e.adler=r.check=vi(d),d=0,u=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,r.hold=d,r.bits=u,2;e.adler=r.check=1,r.mode=hi;case hi:if(5===t||6===t)break e;case 13:if(r.last){d>>>=7&u,u-=7&u,r.mode=27;break}for(;u<3;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}switch(r.last=1&d,u-=1,3&(d>>>=1)){case 0:r.mode=14;break;case 1:if(Ai(r),r.mode=20,6===t){d>>>=2,u-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=mi}d>>>=2,u-=2;break;case 14:for(d>>>=7&u,u-=7&u;u<32;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",r.mode=mi;break}if(r.length=65535&d,d=0,u=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(f=r.length){if(f>s&&(f=s),f>c&&(f=c),0===f)break e;Or.arraySet(i,n,a,f,o),s-=f,a+=f,c-=f,o+=f,r.length-=f;break}r.mode=hi;break;case 17:for(;u<14;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(r.nlen=257+(31&d),d>>>=5,u-=5,r.ndist=1+(31&d),d>>>=5,u-=5,r.ncode=4+(15&d),d>>>=4,u-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=mi;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;u<3;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}r.lens[T[r.have++]]=7&d,d>>>=3,u-=3}for(;r.have<19;)r.lens[T[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,C={bits:r.lenbits},k=pi(0,r.lens,0,19,r.lencode,0,r.work,C),r.lenbits=C.bits,k){e.msg="invalid code lengths set",r.mode=mi;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;g=(E=r.lencode[d&(1<<r.lenbits)-1])>>>16&255,y=65535&E,!((v=E>>>24)<=u);){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(y<16)d>>>=v,u-=v,r.lens[r.have++]=y;else{if(16===y){for(A=v+2;u<A;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(d>>>=v,u-=v,0===r.have){e.msg="invalid bit length repeat",r.mode=mi;break}w=r.lens[r.have-1],f=3+(3&d),d>>>=2,u-=2}else if(17===y){for(A=v+3;u<A;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}u-=v,w=0,f=3+(7&(d>>>=v)),d>>>=3,u-=3}else{for(A=v+7;u<A;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}u-=v,w=0,f=11+(127&(d>>>=v)),d>>>=7,u-=7}if(r.have+f>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=mi;break}for(;f--;)r.lens[r.have++]=w}}if(r.mode===mi)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=mi;break}if(r.lenbits=9,C={bits:r.lenbits},k=pi(1,r.lens,0,r.nlen,r.lencode,0,r.work,C),r.lenbits=C.bits,k){e.msg="invalid literal/lengths set",r.mode=mi;break}if(r.distbits=6,r.distcode=r.distdyn,C={bits:r.distbits},k=pi(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,C),r.distbits=C.bits,k){e.msg="invalid distances set",r.mode=mi;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(s>=6&&c>=258){e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,r.hold=d,r.bits=u,oi(e,p),o=e.next_out,i=e.output,c=e.avail_out,a=e.next_in,n=e.input,s=e.avail_in,d=r.hold,u=r.bits,r.mode===hi&&(r.back=-1);break}for(r.back=0;g=(E=r.lencode[d&(1<<r.lenbits)-1])>>>16&255,y=65535&E,!((v=E>>>24)<=u);){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(g&&0==(240&g)){for(b=v,_=g,S=y;g=(E=r.lencode[S+((d&(1<<b+_)-1)>>b)])>>>16&255,y=65535&E,!(b+(v=E>>>24)<=u);){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}d>>>=b,u-=b,r.back+=b}if(d>>>=v,u-=v,r.back+=v,r.length=y,0===g){r.mode=26;break}if(32&g){r.back=-1,r.mode=hi;break}if(64&g){e.msg="invalid literal/length code",r.mode=mi;break}r.extra=15&g,r.mode=22;case 22:if(r.extra){for(A=r.extra;u<A;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}r.length+=d&(1<<r.extra)-1,d>>>=r.extra,u-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;g=(E=r.distcode[d&(1<<r.distbits)-1])>>>16&255,y=65535&E,!((v=E>>>24)<=u);){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(0==(240&g)){for(b=v,_=g,S=y;g=(E=r.distcode[S+((d&(1<<b+_)-1)>>b)])>>>16&255,y=65535&E,!(b+(v=E>>>24)<=u);){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}d>>>=b,u-=b,r.back+=b}if(d>>>=v,u-=v,r.back+=v,64&g){e.msg="invalid distance code",r.mode=mi;break}r.offset=y,r.extra=15&g,r.mode=24;case 24:if(r.extra){for(A=r.extra;u<A;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}r.offset+=d&(1<<r.extra)-1,d>>>=r.extra,u-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=mi;break}r.mode=25;case 25:if(0===c)break e;if(f=p-c,r.offset>f){if((f=r.offset-f)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=mi;break}f>r.wnext?(f-=r.wnext,h=r.wsize-f):h=r.wnext-f,f>r.length&&(f=r.length),m=r.window}else m=i,h=o-r.offset,f=r.length;f>c&&(f=c),c-=f,r.length-=f;do{i[o++]=m[h++]}while(--f);0===r.length&&(r.mode=21);break;case 26:if(0===c)break e;i[o++]=r.length,c--,r.mode=21;break;case 27:if(r.wrap){for(;u<32;){if(0===s)break e;s--,d|=n[a++]<<u,u+=8}if(p-=c,e.total_out+=p,r.total+=p,p&&(e.adler=r.check=r.flags?_n(r.check,i,p,o-p):gn(r.check,i,p,o-p)),p=c,(r.flags?d:vi(d))!==r.check){e.msg="incorrect data check",r.mode=mi;break}d=0,u=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;u<32;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(d!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=mi;break}d=0,u=0}r.mode=29;case 29:k=1;break e;case mi:k=-3;break e;case 31:return-4;case 32:default:return fi}return e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,r.hold=d,r.bits=u,(r.wsize||p!==e.avail_out&&r.mode<mi&&(r.mode<27||4!==t))&&Ei(e,e.output,e.next_out,p-e.avail_out),l-=e.avail_in,p-=e.avail_out,e.total_in+=l,e.total_out+=p,r.total+=p,r.wrap&&p&&(e.adler=r.check=r.flags?_n(r.check,i,p,e.next_out-p):gn(r.check,i,p,e.next_out-p)),e.data_type=r.bits+(r.last?64:0)+(r.mode===hi?128:0)+(20===r.mode||15===r.mode?256:0),(0===l&&0===p||4===t)&&0===k&&(k=-5),k},inflateEnd:function(e){if(!e||!e.state)return fi;var t=e.state;return t.window&&(t.window=null),e.state=null,0},inflateGetHeader:function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?fi:(r.head=t,t.done=!1,0):fi},inflateSetDictionary:function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?fi:11===r.mode&&gn(1,t,n,0)!==r.check?-3:Ei(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,0):fi},inflateInfo:"pako inflate (from Nodeca project)"},Ti={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var Ii=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},xi=Object.prototype.toString;function Pi(e){if(!(this instanceof Pi))return new Pi(e);this.options=Or.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ti,this.strm.avail_out=0;var r=Ri.inflateInit2(this.strm,t.windowBits);if(r!==Ti.Z_OK)throw new Error(Sn[r]);if(this.header=new Ii,Ri.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Qn(t.dictionary):"[object ArrayBuffer]"===xi.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Ri.inflateSetDictionary(this.strm,t.dictionary))!==Ti.Z_OK))throw new Error(Sn[r])}function Oi(e,t){var r=new Pi(t);if(r.push(e,!0),r.err)throw r.msg||Sn[r.err];return r.result}Pi.prototype.push=function(e,t){var r,n,i,a,o,s=this.strm,c=this.options.chunkSize,d=this.options.dictionary,u=!1;if(this.ended)return!1;n=t===~~t?t:!0===t?Ti.Z_FINISH:Ti.Z_NO_FLUSH,"string"==typeof e?s.input=Xn(e):"[object ArrayBuffer]"===xi.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new Or.Buf8(c),s.next_out=0,s.avail_out=c),(r=Ri.inflate(s,Ti.Z_NO_FLUSH))===Ti.Z_NEED_DICT&&d&&(r=Ri.inflateSetDictionary(this.strm,d)),r===Ti.Z_BUF_ERROR&&!0===u&&(r=Ti.Z_OK,u=!1),r!==Ti.Z_STREAM_END&&r!==Ti.Z_OK)return this.onEnd(r),this.ended=!0,!1;s.next_out&&(0!==s.avail_out&&r!==Ti.Z_STREAM_END&&(0!==s.avail_in||n!==Ti.Z_FINISH&&n!==Ti.Z_SYNC_FLUSH)||("string"===this.options.to?(i=ei(s.output,s.next_out),a=s.next_out-i,o=$n(s.output,i),s.next_out=a,s.avail_out=c-a,a&&Or.arraySet(s.output,s.output,i,a,0),this.onData(o)):this.onData(Or.shrinkBuf(s.output,s.next_out)))),0===s.avail_in&&0===s.avail_out&&(u=!0)}while((s.avail_in>0||0===s.avail_out)&&r!==Ti.Z_STREAM_END);return r===Ti.Z_STREAM_END&&(n=Ti.Z_FINISH),n===Ti.Z_FINISH?(r=Ri.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Ti.Z_OK):n!==Ti.Z_SYNC_FLUSH||(this.onEnd(Ti.Z_OK),s.avail_out=0,!0)},Pi.prototype.onData=function(e){this.chunks.push(e)},Pi.prototype.onEnd=function(e){e===Ti.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Or.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Di={Inflate:Pi,inflate:Oi,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Oi(e,t)},ungzip:Oi},Mi={};(0,Or.assign)(Mi,ai,Di,Ti);var Bi=Mi,Li={version:"3.21.0",ntpServerUrls:"",logServerUrl:"https://log.snssdk.com/video/v1/webrtc_log/",global:{compressReport:!0}},Ni=2e3,ji="counter",Fi="store",Ui={rtc_sdk_self:822,rtc_join_room:823,rtc_get_config:824,rtc_leave_room:825,rtc_publish:826,rtc_unpublish:832,rtc_subscribe:833,rtc_unsubscribe:834,rtc_websocket:835,rtc_signaling:836,rtc_server_signaling:842,rtc_create_media:843,rtc_create_offer:844,rtc_recv_answer:845,rtc_set_description:846,rtc_ice:852,rtc_transport:853,rtc_reconnect:854,rtc_account:855,rtc_sdk_api_call:856,oner_signaling:736,oner_update_rtc_provider:771},Vi=Rr(kr),zi=0,Gi=0,Wi=!1;function Hi(){Wi=!0}var qi=new function e(){Ce(this,e),this.product_line="rtc",this.project_key="_app_name_",this.report_version="5",this.rtc_sdk_version=Li.version,this.oner_sdk_version=Li.version,this.rtc_sdk_version_num=Li.version.split(".").map((function(e,t){return parseInt(e)*Math.pow(10,[12,9,6,0][t])})).reduce((function(e,t){return e+t}),0),this.user_agent=window.navigator.userAgent,this.device_id=Vi,this.engine_id=sr(),this.rtc_app_id="",this.oner_app_id="",this.rtc_business_id=""},Ji=[],Zi=function(){function e(t){var r=this;Ce(this,e),this.postHeader=qi,this.sessionId=null,this.isInRoom=0,this.connection_id=null,this.dataBuffer=Ji,this.sentNtpMessage=!1,this.sliceObjectDepthForLog=na,t&&t.default&&(setInterval(this.sendToLogServer.bind(this),5e3),window.addEventListener("unload",(function(){try{r.sendToLogServer(!0)}catch(e){}})))}return Ee(e,[{key:"getEngineId",value:function(){return this.postHeader.engine_id}},{key:"setConfigServerHost",value:function(e){this.postHeader.config_server=e}},{key:"getConfigServerHost",value:function(){return this.postHeader.config_server}},{key:"setAid",value:function(e){this.postHeader.aid=e}},{key:"getDeviceId",value:function(){return this.postHeader.device_id}},{key:"setProductLine",value:function(e){this.postHeader.product_line=e}},{key:"setRtcProvider",value:function(e){this.postHeader.oner_provider=e}},{key:"setOnerAppId",value:function(e){this.postHeader.oner_app_id=e}},{key:"getOnerAppId",value:function(){return this.postHeader.oner_app_id}},{key:"setBusinessId",value:function(e){this.postHeader.rtc_business_id=e}},{key:"getBusinessId",value:function(){return this.postHeader.rtc_business_id}},{key:"setOnerRoomId",value:function(e){this.postHeader.oner_room_id=e}},{key:"setOnerUserId",value:function(e){this.postHeader.oner_user_id=e}},{key:"setAppId",value:function(e){this.postHeader.rtc_app_id=e}},{key:"getAppId",value:function(){return this.postHeader.rtc_app_id}},{key:"setCallId",value:function(e){this.postHeader.rtc_call_id=e}},{key:"getCallId",value:function(){return this.postHeader.rtc_call_id}},{key:"setRoomId",value:function(e){this.postHeader.room_id=e}},{key:"getRoomId",value:function(){return this.postHeader.room_id}},{key:"setUserId",value:function(e){this.postHeader.user_id=e}},{key:"getUserId",value:function(){return this.postHeader.user_id}},{key:"setHeader",value:function(e,t){if(Gi>=8)return!1;if("string"!=typeof e)return!1;var r=Ht("ex_".concat(e));return void 0===this.postHeader[r]&&(this.postHeader[r]=t,Gi++,!0)}},{key:"getAndSetSessionId",value:function(){return this.sessionId=sr(),this.sessionId}},{key:"setInRoom",value:function(e){this.isInRoom=e?1:0}},{key:"setConnectionId",value:function(e){this.connection_id=e}},{key:"getInRoom",value:function(){return!!this.isInRoom}},{key:"getNtpOffsetOnce",value:function(){var e=this;!window.gotNtpOffset&&function(e){return ur.apply(this,arguments)}({urls:Li.ntpServerUrls,sdkVersion:Li.version}).then((function(t){e.eventLog("rtc_sync_server_time",{message:t})})).catch((function(t){e.eventLog("rtc_sync_server_time_failed",{message:JSON.stringify(t)})})),window.gotNtpOffset=!0}},{key:"sendToLogServer",value:function(e){var t=this;if(Wi&&(this.getNtpOffsetOnce(),!(this.dataBuffer.length<=0))){var r={data:this.dataBuffer.splice(0,4e3),header:this.postHeader,from:"web",os:"web",version:"1"};if(r.header.report_time=new Date,r.header.report_log_count=r.data.length,e)navigator.sendBeacon(Li.logServerUrl,JSON.stringify(r));else{var n=new XMLHttpRequest;n.timeout=1e4,n.ontimeout=a,n.onerror=a,n.onreadystatechange=function(){if(4===n.readyState){var e,t;if(200===n.status||304===n.status)try{e=JSON.parse(n.responseText)}catch(e){t=e}e&&0===e.StatusCode||a(t||n)}},n.open("POST",Li.logServerUrl,!0);var i=Bi.gzip(JSON.stringify(r));n.setRequestHeader("Content-Encoding","gzip"),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),n.send(i)}}function a(e){et.verbose("[".concat(t.postHeader.product_line,"]post log error"),e),0!==r.data.length?(r.data.splice(Ni,1/0),Array.prototype.splice.apply(t.dataBuffer,[0,0].concat(r.data)),t.dataBuffer.splice(4e3,1/0),r.data=[]):et.verbose("[".concat(t.postHeader.product_line,"]post log error has processed"))}}},{key:"eventLog",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;this.addLogToBuffer(Object.assign({},this.formatJson("event",e,t,r,n)))}},{key:"metricsLog",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;a=a||("number"==typeof t?ji:Fi),this.addLogToBuffer(Object.assign({metric_value:t,metric_type:a},this.formatJson("metrics",e,r,n,i)))}},{key:"addLogToBuffer",value:function(e){var t=Object.assign({},e);this.dataBuffer.length<3999?this.dataBuffer.push(t):3999===this.dataBuffer.length&&this.dataBuffer.push({report_id:zi++,event_type:t.event_type,event_key:"rtc_warning",message:"reach log dataBuffer limit: ".concat(this.dataBuffer.length)})}},{key:"formatJson",value:function(e,t,r,n,i){var a={event_type:e,event_key:t,error_code:0,report_id:zi++,in_room:this.isInRoom,connection_id:this.connection_id,session_id:this.sessionId,time:(new Date).getTime()};for(var o in r)o.startsWith("$")?a[o.slice(1)]=r[o]:"metrics"!==e&&(a[o]=r[o]);if(r.event_starttime&&(a.elapse=new Date-r.event_starttime),i&&i.message&&(a.message=i.message),n){n.message&&(a.message=n.message);var s=parseInt(n.code);(isNaN(s)||0>=s||s>9999)&&(s=9999,a.message+="(err.code:".concat(n.code,")")),a.error_code=1e4*(Ui[t]||999)+s}return a}}]),e}();Zi.default=new Zi({default:!0}),Zi.create=function(e){return new Zi(e)};var Ki=Zi.default.eventLog.bind(Zi.default),Qi=Zi.default.setConfigServerHost.bind(Zi.default),Yi=(Zi.default.getConfigServerHost.bind(Zi.default),Zi.default.getDeviceId.bind(Zi.default)),Xi=(Zi.default.setProductLine.bind(Zi.default),Zi.default.setRtcProvider.bind(Zi.default),Zi.default.getOnerAppId.bind(Zi.default),Zi.default.setOnerAppId.bind(Zi.default),Zi.default.getBusinessId.bind(Zi.default)),$i=Zi.default.setBusinessId.bind(Zi.default),ea=Zi.default.setAid.bind(Zi.default),ta=(Zi.default.setOnerRoomId.bind(Zi.default),Zi.default.setOnerUserId.bind(Zi.default),Zi.default.getAppId.bind(Zi.default),Zi.default.setAppId.bind(Zi.default),Zi.default.getRoomId.bind(Zi.default),Zi.default.setRoomId.bind(Zi.default),Zi.default.getUserId.bind(Zi.default),Zi.default.setUserId.bind(Zi.default),Zi.default.setHeader.bind(Zi.default));Zi.default.getAndSetSessionId.bind(Zi.default),Zi.default.setInRoom.bind(Zi.default),Zi.default.setConnectionId.bind(Zi.default),Zi.default.getInRoom.bind(Zi.default),Zi.default.getEngineId.bind(Zi.default);function ra(e){var t={};return e&&(t.stream_id=e.getServerId(),t.vid=e.getId(),t.stream_user_id=e.uid,t.direction=e.local?"up":"down",t.stream_state_description=e.getState().toString(),t.stream_attempts=e.attempts||0,t.event_starttime=e.__logSignaling.event_starttime,e.pc&&(t.pc_session_id=e.pc.pc_session_id)),Object.keys(t).forEach((function(e){t[e]||0===t[e]||delete t[e]})),t}function na(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!e)return e;switch(i(e)){case"object":if(e.class)return e.class;if(t){var r,n;for(var a in e instanceof Array?(r=[],n=t):(r={},n=t-1),e)r[a]=na(e[a],n);return r}return e instanceof Array?"[...]":"{...}";case"function":return"()=>{}";default:return e}}var ia=function(e,t){e||Ki("assert_error",{message:t})},aa=function(){var e={},t={eventListeners:{}};return e.addEventListener=function(e,r){void 0===t.eventListeners[e]&&(t.eventListeners[e]=[]),t.eventListeners[e].push(r)},e.removeEventListener=function(e,r){if(t.eventListeners[e]){var n=t.eventListeners[e].indexOf(r);-1!==n&&t.eventListeners[e].splice(n,1)}},e.dispatchEvent=function(e){if(!e||!e.type)throw new Error("Undefined event");for(var r=t.eventListeners[e.type]||[],n=0;n<r.length;n+=1)r[n](e)},e.on=e.addEventListener,e.off=e.removeEventListener,e.emit=e.dispatchEvent,e},oa=function(e){var t={};return t.type=e.type,t.code=e.code,t.message=e.message,t},sa=function(e){var t=oa(e);return Object.assign(t,e),t},ca=function(e){var t=oa(e);return t.stream=e.stream,t.message=e.message,t.bandwidth=e.bandwidth,t.attributes=e.attributes,t.options=e.options,t.state=e.state,t},da=function(e){var t=oa(e);return t.stream=e.stream,t.state=e.state,t},ua=function(){function e(){Ce(this,e),this.emitter=aa()}return Ee(e,[{key:"addEventListener",value:function(e,t){this.emitter.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this.emitter.removeEventListener(e,t)}},{key:"dispatchEvent",value:function(e){this.emitter.dispatchEvent(e)}},{key:"on",value:function(e,t){this.addEventListener(e,t)}},{key:"off",value:function(e,t){this.removeEventListener(e,t)}},{key:"emit",value:function(e){this.dispatchEvent(e)}}]),e}(),la=Object.freeze({__proto__:null,EventDispatcher:aa,LicodeEvent:oa,RoomEvent:sa,StreamEvent:ca,PublisherEvent:function(e){return oa(e)},EventEmitter:ua,ConnectionEvent:da}),pa=function(){var e="none";return null!==window.navigator.userAgent.match("Firefox")?e="mozilla":null!==window.navigator.userAgent.match("Chrome")?(e="chrome-stable",null!==window.navigator.userAgent.match("Electron")&&(e="electron")):(null!==window.navigator.userAgent.match("Safari")||null!==window.navigator.userAgent.match("AppleWebKit"))&&(e="safari"),e},fa=function(){return"safari"===pa()},ha=function(){return"chrome-stable"===pa()};function ma(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function va(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?ma(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ma(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ga=new He,ya={},ba=function(e){var t=aa(),r=e;t.negotiationing=!1,t.refCount=0,ya={},t.pc_session_id=r.pcId||sr(),t.isSinglePC=function(){return r.pcId},t.lastStatus="",t.currentStatus="initial";var n=null,a=r.encodedInsertableStreams,o=r.room;t.streams=new Set,t.iceOptions={offer:{},answer:{}},t.pcConfig={iceServers:[],bundlePolicy:"max-bundle",sdpSemantics:"unified-plan",encodedInsertableStreams:a},t.con={},void 0===r.audio&&(r.audio=!0),void 0===r.video&&(r.video=!0),t.peerConnection=new RTCPeerConnection(t.pcConfig,t.con),t.stoppedTransceiverMids={};var s=function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";et.error("message:",n,"in baseStack at",e),Ki(e,{message:n,pc_session_id:t.pc_session_id}),void 0!==r&&r("error")},c=function(){var e=ve(ge.mark((function e(r){var n,i,a,o;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r,a=Be.parse(i.sdp),o="",Array.isArray(a.media)&&a.media.forEach((function(e){for(var r=0,n=Object.entries(t.iceOptions.offer);r<n.length;r++){var i=ke(n[r],2),a=i[0],s=i[1];e[a]=s}void 0!==t.stoppedTransceiverMids[e.mid]?(e.direction="inactive",e.port=0,delete e.ssrcs,delete e.ssrcGroups,delete e.msid):o+=" ".concat(e.mid)})),null!==(n=a.groups)&&void 0!==n&&n.length&&(a.groups[0].mids=o.trim()),i.sdp=Be.write(a),e.next=8,d(i);case 8:return e.abrupt("return",t.peerConnection.localDescription||i);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function d(e){return u.apply(this,arguments)}function u(){return(u=ve(ge.mark((function e(r){return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.peerConnection.setLocalDescription(r);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),s.bind(null,"pc_set_local_SDP_failed",void 0)(e.t0.toString());case 8:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}function l(e,t){if(t.length){e.ssrcs=[];var r=t.shift();if(e.ssrcs.push(r),"msid"===r.attribute){var n=r.value.split(" "),i=ke(n,2)[1];ya[e.mid]=i}for(;t.length&&t[0].id===r.id;){var a=t.shift();if("msid"===a.attribute){var o=a.value.split(" "),s=ke(o,2)[1];ya[e.mid]=s}e.ssrcs.push(a)}}}return t.peerConnection.onicecandidate=function(e){Ki("on_ice_candidate",{message:e.candidate,pc_session_id:t.pc_session_id})},t.peerConnection.ontrack=function(e){if(Array.isArray(e.streams)&&e.streams.length){var r=e.streams[0];t.emit(da({type:"add-stream",stream:r})),t.emitTransformBindEvent(r)}},t.peerConnection.onremovestream=function(e){t.emit(da({type:"remove-stream",stream:e.stream}))},t.peerConnection.oniceconnectionstatechange=function(e){var r=e.target.iceConnectionState;switch(t.lastStatus=t.currentStatus,t.currentStatus=r,et.debug("[pc-state] id: ".concat(t.pc_session_id," state from ").concat(t.lastStatus," to ").concat(t.currentStatus)),r){case"completed":case"connected":t.beginGetStats()}t.oniceconnectionstatechange&&t.oniceconnectionstatechange(t.peerConnection.iceConnectionState),t.emit(da({type:"ice-state-change",state:r})),Ki("rtc_ice_change",{pc_session_id:t.pc_session_id,ice_state:t.peerConnection.iceConnectionState})},t.peerConnection.onconnectionstatechange=function(e){var r=e.target.connectionState;"failed"===r&&(t.lastStatus=t.currentStatus,t.currentStatus=r,t.emit(da({type:"ice-state-change",state:r})))},t.setMinVideoBW=function(e){return et.error("minVideoBw not implemented for this browser"),e},t.setConference=function(e){return et.error("x-google-flag:conference not implemented for this browser"),e},t.enableSimulcast=function(e){return et.error("Simulcast not implemented"),e},t.stopTransceiver=function(e){var r=t.peerConnection.getTransceivers();if(r){var n=e.stream;if(n){var i={};n.getTracks().forEach((function(e){i[e.id]=e.id})),r.forEach((function(e){var r,n,a=null==e||null===(r=e.sender)||void 0===r||null===(n=r.track)||void 0===n?void 0:n.id;i[a]&&("function"==typeof(null==e?void 0:e.stop)?e.stop():(t.stoppedTransceiverMids[e.mid]=e.mid,t.peerConnection.removeTrack(e.sender)))}))}}},t.close=lr((function(){"closed"!==t.peerConnection.iceConnectionState&&(t.peerConnection.close(),et.debug("[pc] id: ".concat(t.pc_session_id," state: ").concat(t.peerConnection.iceConnectionState)),t.emit(da({type:"ice-state-change",state:t.peerConnection.iceConnectionState})),t.updateRoomIdOnce(),Ki("rtc_ice_change",{pc_session_id:t.pc_session_id,ice_state:t.peerConnection.iceConnectionState}))})),t.sdpRollback=function(){return t.negotiationing=!1,"stable"!==t.peerConnection.signalingState?t.peerConnection.setLocalDescription({type:"rollback"}):Promise.resolve()},t.createOffer=function(e,r,n,i){return new Promise(function(){var n=ve(ge.mark((function n(a,o){var d,u,l;return ge.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.negotiationing){n.next=7;break}return n.next=3,new Promise((function(e){return setTimeout((function(){return e()}),100)}));case 3:if("closed"!==t.peerConnection.connectionState){n.next=5;break}return n.abrupt("return",o(new tr("".concat(e?"subscribe":"publish"," createOffer timeout error"),tr.TIMEOUT)));case 5:n.next=0;break;case 7:try{t.negotiationing=!0,!e&&r?(d=r.getAudioTracks()[0],u=r.getVideoTracks()[0],d&&t.peerConnection.addTransceiver(d,{direction:"sendonly",streams:[r]}),u&&(l={direction:"sendonly",streams:[r]},"number"==typeof i.maxVideoBW&&(l.sendEncodings=[{maxBitrate:1e3*i.maxVideoBW}]),t.peerConnection.addTransceiver(u,l))):(t.peerConnection.addTransceiver("audio",{direction:"recvonly"}),t.peerConnection.addTransceiver("video",{direction:"recvonly"}))}catch(e){o(e),t.sdpRollback()}a(t.peerConnection.createOffer().then(c).catch((function(r){s.bind(null,"pc_create_offer_failed",void 0)(r.toString());var n=new tr("".concat(e?"subscribe":"publish"," createOffer error"),tr.INVALID_SDP,r);throw t.sdpRollback(),n})));case 9:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())},t.resetRemoteDesc=function(){var e=ve(ge.mark((function e(r,n){var i;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,i=new RTCSessionDescription({type:"answer",sdp:r}),et.debug("resetRemoteDesc..",{sdp:i.sdp,sequenceId:n}),"have-local-offer"===t.peerConnection.signalingState){e.next=6;break}return t.sdpRollback(),e.abrupt("return",!1);case 6:return Ki("pc_receive_answer",{pc_session_id:t.pc_session_id,message:i.sdp}),e.next=9,t.peerConnection.setRemoteDescription(i);case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),et.error(e.t0),t.sdpRollback();case 15:return e.prev=15,t.negotiationing=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,11,15,18]])})));return function(t,r){return e.apply(this,arguments)}}(),t.createDataChannel=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.peerConnection.createDataChannel(e,va({negotiated:!1},r))},t.addStream=function(e){t.peerConnection.addStream(e),t.emitTransformBindEvent(e)},t.emitTransformBindEvent=function(e){a&&e.getTracks().forEach((function(e){t.emit({type:"add-transform",trackId:e.id,kind:e.kind})}))},t.bindTransform=function(e,r,n){n?t.peerConnection.getSenders().forEach((function(t){if(t.track.id===e){var n=t.createEncodedStreams(),i=n.readableStream,a=n.writableStream;i.pipeThrough(new TransformStream({transform:r})).pipeTo(a)}})):t.peerConnection.getReceivers().forEach((function(t){if(t.track.id===e){var n=t.createEncodedStreams(),i=n.readableStream,a=n.writableStream;i.pipeThrough(new TransformStream({transform:r})).pipeTo(a)}}))},t.removeStream=function(e){"closed"!==t.peerConnection.signalingState&&t.peerConnection.removeStream(e)},t.beginGetStats=lr((function(){!function(e,t,r){var n,a="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(n="undefined"!=typeof global?global:null)&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:a,getUserMedia:function(){}},global.console||(global.console={}),void 0!==global.console.log&&void 0!==global.console.error||(global.console.error=global.console.log=global.console.log||function(){}),"undefined"==typeof document&&(n.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},n.HTMLVideoElement=function(){}),"undefined"==typeof location&&(n.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(n.screen={width:0,height:0}),"undefined"==typeof URL&&(n.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),"undefined"==typeof MediaStreamTrack&&(n.MediaStreamTrack=function(){}),void 0===o&&(n.RTCPeerConnection=function(){}),n.window=global);var o=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;"undefined"==typeof MediaStreamTrack&&(MediaStreamTrack={});var s={encryption:"sha-256",audio:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,latency:0,packetsLost:0},video:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,latency:0,packetsLost:0},bandwidth:{systemBandwidth:0,sentPerSecond:0,encodedPerSecond:0,helper:{audioBytesSent:0,videoBytestSent:0},speed:0},results:{},connectionType:{systemNetworkType:((navigator.connection||{}).type||"unknown").toString().toLowerCase(),systemIpAddress:"192.168.1.2",local:{candidateType:[],transport:[],ipAddress:[],networkType:[]},remote:{candidateType:[],transport:[],ipAddress:[],networkType:[]}},resolutions:{send:{width:0,height:0},recv:{width:0,height:0}},internal:{audio:{send:{},recv:{}},video:{send:{},recv:{}},candidates:{}},nomore:function(){l=!0}},c={checkIfOfferer:function(e){"googLibjingleSession"===e.type&&(s.isOfferer=e.googInitiator)}},d=fa(),u=this;if(!(arguments[0]instanceof o))throw"1st argument is not instance of RTCPeerConnection.";u=arguments[0],arguments[1]instanceof MediaStreamTrack&&(e=arguments[1],t=arguments[2],r=arguments[3]);var l=!1;function p(){f((function(e){if(e&&e.forEach){e.forEach((function(e){Object.keys(c).forEach((function(t){if("function"==typeof c[t])try{c[t](e)}catch(e){}}))}));try{-1!==u.iceConnectionState.search(/failed|closed/gi)&&(l=!0)}catch(e){l=!0}!0===l&&(s.datachannel&&(s.datachannel.state="close"),s.ended=!0),s.results=e,s.audio&&s.video&&(s.bandwidth.speed=s.audio.bytesSent-s.bandwidth.helper.audioBytesSent+(s.video.bytesSent-s.bandwidth.helper.videoBytesSent),s.bandwidth.helper.audioBytesSent=s.audio.bytesSent,s.bandwidth.helper.videoBytesSent=s.video.bytesSent),t(s),l||null!=i(r)&&r&&setTimeout(p,r||1e3)}}))}function f(e){void 0!==window.InstallTrigger||d?u.getStats(window.mediaStreamTrack||null).then((function(t){var r=[];t.forEach((function(e){r.push(e)})),e(r)})).catch(e):u.getStats((function(t){var r=[];t.result().forEach((function(e){var t={};e.names().forEach((function(r){t[r]=e.stat(r)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,r.push(t)})),e(r)}))}function h(e){var t=e.isRemote;return void 0===t&&("remote-inbound-rtp"===e.type||"remote-outbound-rtp"===e.type)}c.datachannel=function(e){"datachannel"===e.type&&(s.datachannel={state:e.state})},c.googCertificate=function(e){"googCertificate"==e.type&&(s.encryption=e.googFingerprintAlgorithm),"certificate"==e.type&&(s.encryption=e.fingerprintAlgorithm)},c.checkAudioTracks=function(e){if("audio"===e.mediaType){var t=h(e),r=e.id.split("_").pop();if(!0===t?r="recv":!1===t&&(r="send"),r){if(-1===s.audio[r].codecs.indexOf(e.googCodecName||"opus")&&s.audio[r].codecs.push(e.googCodecName||"opus"),e.bytesSent){var n=0;s.internal.audio[r].prevBytesSent||(s.internal.audio[r].prevBytesSent=e.bytesSent);var i=e.bytesSent-s.internal.audio[r].prevBytesSent;s.internal.audio[r].prevBytesSent=e.bytesSent,n=i/1024,s.audio[r].availableBandwidth=n.toFixed(1),s.audio.bytesSent=n.toFixed(1)}e.bytesReceived&&(n=0,s.internal.audio[r].prevBytesReceived||(s.internal.audio[r].prevBytesReceived=e.bytesReceived),i=e.bytesReceived-s.internal.audio[r].prevBytesReceived,s.internal.audio[r].prevBytesReceived=e.bytesReceived,n=i/1024,s.audio.bytesReceived=n.toFixed(1)),e.googTrackId&&-1===s.audio[r].tracks.indexOf(e.googTrackId)&&s.audio[r].tracks.push(e.googTrackId),e.googCurrentDelayMs&&(n=0,s.internal.audio.prevGoogCurrentDelayMs||(s.internal.audio.prevGoogCurrentDelayMs=e.googCurrentDelayMs),i=e.googCurrentDelayMs-s.internal.audio.prevGoogCurrentDelayMs,s.internal.audio.prevGoogCurrentDelayMs=e.googCurrentDelayMs,s.audio.latency=i.toFixed(1),s.audio.latency<0&&(s.audio.latency=0)),e.packetsLost&&(n=0,s.internal.audio.prevPacketsLost||(s.internal.audio.prevPacketsLost=e.packetsLost),i=e.packetsLost-s.internal.audio.prevPacketsLost,s.internal.audio.prevPacketsLost=e.packetsLost,s.audio.packetsLost=i.toFixed(1),s.audio.packetsLost<0&&(s.audio.packetsLost=0))}}},c.checkVideoTracks=function(e){if("video"===e.mediaType){var t=h(e),r=e.id.split("_").pop();if(!0===t?r="recv":!1===t&&(r="send"),r){if(-1===s.video[r].codecs.indexOf(e.googCodecName||"VP8")&&s.video[r].codecs.push(e.googCodecName||"VP8"),e.bytesSent){var n=0;s.internal.video[r].prevBytesSent||(s.internal.video[r].prevBytesSent=e.bytesSent);var i=e.bytesSent-s.internal.video[r].prevBytesSent;s.internal.video[r].prevBytesSent=e.bytesSent,n=i/1024,s.video[r].availableBandwidth=n.toFixed(1),s.video.bytesSent=n.toFixed(1)}e.bytesReceived&&(n=0,s.internal.video[r].prevBytesReceived||(s.internal.video[r].prevBytesReceived=e.bytesReceived),i=e.bytesReceived-s.internal.video[r].prevBytesReceived,s.internal.video[r].prevBytesReceived=e.bytesReceived,n=i/1024,s.video.bytesReceived=n.toFixed(1)),e.googFrameHeightReceived&&e.googFrameWidthReceived&&(s.resolutions[r].width=e.googFrameWidthReceived,s.resolutions[r].height=e.googFrameHeightReceived),e.googFrameHeightSent&&e.googFrameWidthSent&&(s.resolutions[r].width=e.googFrameWidthSent,s.resolutions[r].height=e.googFrameHeightSent),e.googTrackId&&-1===s.video[r].tracks.indexOf(e.googTrackId)&&s.video[r].tracks.push(e.googTrackId),e.framerateMean&&(s.bandwidth.framerateMean=e.framerateMean,n=0,s.internal.video[r].prevFramerateMean||(s.internal.video[r].prevFramerateMean=e.bitrateMean),i=e.bytesSent-s.internal.video[r].prevFramerateMean,s.internal.video[r].prevFramerateMean=e.framerateMean,n=i/1024,s.video[r].framerateMean=i.toFixed(1)),e.bitrateMean&&(s.bandwidth.bitrateMean=e.bitrateMean,n=0,s.internal.video[r].prevBitrateMean||(s.internal.video[r].prevBitrateMean=e.bitrateMean),i=e.bytesSent-s.internal.video[r].prevBitrateMean,s.internal.video[r].prevBitrateMean=e.bitrateMean,n=i/1024,s.video[r].bitrateMean=i.toFixed(1)),e.googCurrentDelayMs&&(n=0,s.internal.video.prevGoogCurrentDelayMs||(s.internal.video.prevGoogCurrentDelayMs=e.googCurrentDelayMs),i=e.googCurrentDelayMs-s.internal.video.prevGoogCurrentDelayMs,s.internal.video.prevGoogCurrentDelayMs=e.googCurrentDelayMs,s.video.latency=i.toFixed(1),s.video.latency<0&&(s.video.latency=0)),e.packetsLost&&(n=0,s.internal.video.prevPacketsLost||(s.internal.video.prevPacketsLost=e.packetsLost),i=e.packetsLost-s.internal.video.prevPacketsLost,s.internal.video.prevPacketsLost=e.packetsLost,s.video.packetsLost=i.toFixed(1),s.video.packetsLost<0&&(s.video.packetsLost=0))}}},c.bweforvideo=function(e){"VideoBwe"===e.type&&(s.bandwidth.availableSendBandwidth=e.googAvailableSendBandwidth,s.bandwidth.googActualEncBitrate=e.googActualEncBitrate,s.bandwidth.googAvailableSendBandwidth=e.googAvailableSendBandwidth,s.bandwidth.googAvailableReceiveBandwidth=e.googAvailableReceiveBandwidth,s.bandwidth.googRetransmitBitrate=e.googRetransmitBitrate,s.bandwidth.googTargetEncBitrate=e.googTargetEncBitrate,s.bandwidth.googBucketDelay=e.googBucketDelay,s.bandwidth.googTransmitBitrate=e.googTransmitBitrate)},c.candidatePair=function(e){if("googCandidatePair"===e.type||"candidate-pair"===e.type||"local-candidate"===e.type||"remote-candidate"===e.type){if("true"==e.googActiveConnection&&(Object.keys(s.internal.candidates).forEach((function(t){var r=s.internal.candidates[t];-1!==r.ipAddress.indexOf(e.googLocalAddress)&&(s.connectionType.local.candidateType=r.candidateType,s.connectionType.local.ipAddress=r.ipAddress,s.connectionType.local.networkType=r.networkType,s.connectionType.local.transport=r.transport),-1!==r.ipAddress.indexOf(e.googRemoteAddress)&&(s.connectionType.remote.candidateType=r.candidateType,s.connectionType.remote.ipAddress=r.ipAddress,s.connectionType.remote.networkType=r.networkType,s.connectionType.remote.transport=r.transport)})),s.connectionType.transport=e.googTransportType,(t=s.internal.candidates[e.localCandidateId])&&t.ipAddress&&(s.connectionType.systemIpAddress=t.ipAddress),(r=s.internal.candidates[e.remoteCandidateId])&&r.ipAddress&&(s.connectionType.systemIpAddress=r.ipAddress)),"candidate-pair"===e.type&&!0===e.selected&&!0===e.nominated&&"succeeded"===e.state)var t=s.internal.candidates[e.remoteCandidateId],r=s.internal.candidates[e.remoteCandidateId];if("local-candidate"===e.type&&(s.connectionType.local.candidateType=e.candidateType,s.connectionType.local.ipAddress=e.ipAddress,s.connectionType.local.networkType=e.networkType,s.connectionType.local.transport=e.mozLocalTransport||e.transport),"remote-candidate"===e.type&&(s.connectionType.remote.candidateType=e.candidateType,s.connectionType.remote.ipAddress=e.ipAddress,s.connectionType.remote.networkType=e.networkType,s.connectionType.remote.transport=e.mozRemoteTransport||e.transport),d){var n=e.localCandidateId?"send":"recv";if(!n)return;if(e.bytesSent){var i=0;s.internal.video[n].prevBytesSent||(s.internal.video[n].prevBytesSent=e.bytesSent);var a=e.bytesSent-s.internal.video[n].prevBytesSent;s.internal.video[n].prevBytesSent=e.bytesSent,i=a/1024,s.video[n].availableBandwidth=i.toFixed(1),s.video.bytesSent=i.toFixed(1)}e.bytesReceived&&(i=0,s.internal.video[n].prevBytesReceived||(s.internal.video[n].prevBytesReceived=e.bytesReceived),a=e.bytesReceived-s.internal.video[n].prevBytesReceived,s.internal.video[n].prevBytesReceived=e.bytesReceived,i=a/1024,s.video.bytesReceived=i.toFixed(1)),e.availableOutgoingBitrate&&(i=0,s.internal.video[n].prevAvailableOutgoingBitrate||(s.internal.video[n].prevAvailableOutgoingBitrate=e.availableOutgoingBitrate),a=e.availableOutgoingBitrate-s.internal.video[n].prevAvailableOutgoingBitrate,s.internal.video[n].prevAvailableOutgoingBitrate=e.availableOutgoingBitrate,i=a/1024,s.video.availableOutgoingBitrate=i.toFixed(1)),e.availableIncomingBitrate&&(i=0,s.internal.video[n].prevAvailableIncomingBitrate||(s.internal.video[n].prevAvailableIncomingBitrate=e.availableIncomingBitrate),a=e.availableIncomingBitrate-s.internal.video[n].prevAvailableIncomingBitrate,s.internal.video[n].prevAvailableIncomingBitrate=e.availableIncomingBitrate,i=a/1024,s.video.availableIncomingBitrate=i.toFixed(1))}}};var m={},v={},g={},y={};c.localcandidate=function(e){"localcandidate"!==e.type&&"local-candidate"!==e.type||e.id&&(m[e.id]||(m[e.id]=[]),v[e.id]||(v[e.id]=[]),g[e.id]||(g[e.id]=[]),y[e.id]||(y[e.id]=[]),e.candidateType&&-1===m[e.id].indexOf(e.candidateType)&&m[e.id].push(e.candidateType),e.transport&&-1===v[e.id].indexOf(e.transport)&&v[e.id].push(e.transport),e.ipAddress&&-1===g[e.id].indexOf(e.ipAddress+":"+e.portNumber)&&g[e.id].push(e.ipAddress+":"+e.portNumber),e.networkType&&-1===y[e.id].indexOf(e.networkType)&&y[e.id].push(e.networkType),s.internal.candidates[e.id]={candidateType:m[e.id],ipAddress:g[e.id],portNumber:e.portNumber,networkType:y[e.id],priority:e.priority,transport:v[e.id],timestamp:e.timestamp,id:e.id,type:e.type},s.connectionType.local.candidateType=m[e.id],s.connectionType.local.ipAddress=g[e.id],s.connectionType.local.networkType=y[e.id],s.connectionType.local.transport=v[e.id])};var b={},_={},S={},w={};c.remotecandidate=function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||e.id&&(b[e.id]||(b[e.id]=[]),_[e.id]||(_[e.id]=[]),S[e.id]||(S[e.id]=[]),w[e.id]||(w[e.id]=[]),e.candidateType&&-1===b[e.id].indexOf(e.candidateType)&&b[e.id].push(e.candidateType),e.transport&&-1===_[e.id].indexOf(e.transport)&&_[e.id].push(e.transport),e.ipAddress&&-1===S[e.id].indexOf(e.ipAddress+":"+e.portNumber)&&S[e.id].push(e.ipAddress+":"+e.portNumber),e.networkType&&-1===w[e.id].indexOf(e.networkType)&&w[e.id].push(e.networkType),s.internal.candidates[e.id]={candidateType:b[e.id],ipAddress:S[e.id],portNumber:e.portNumber,networkType:w[e.id],priority:e.priority,transport:_[e.id],timestamp:e.timestamp,id:e.id,type:e.type},s.connectionType.remote.candidateType=b[e.id],s.connectionType.remote.ipAddress=S[e.id],s.connectionType.remote.networkType=w[e.id],s.connectionType.remote.transport=_[e.id])},c.dataSentReceived=function(e){!e.googCodecName||"video"!==e.mediaType&&"audio"!==e.mediaType||(e.bytesSent&&(s[e.mediaType].bytesSent=parseInt(e.bytesSent)),e.bytesReceived&&(s[e.mediaType].bytesReceived=parseInt(e.bytesReceived)))},c.inboundrtp=function(e){if(d&&"inbound-rtp"===e.type){var t=e.mediaType||"audio",r=e.isRemote?"recv":"send";if(r){if(e.bytesSent){var n=0;s.internal[t][r].prevBytesSent||(s.internal[t][r].prevBytesSent=e.bytesSent);var i=e.bytesSent-s.internal[t][r].prevBytesSent;s.internal[t][r].prevBytesSent=e.bytesSent,n=i/1024,s[t][r].availableBandwidth=n.toFixed(1),s[t].bytesSent=n.toFixed(1)}e.bytesReceived&&(n=0,s.internal[t][r].prevBytesReceived||(s.internal[t][r].prevBytesReceived=e.bytesReceived),i=e.bytesReceived-s.internal[t][r].prevBytesReceived,s.internal[t][r].prevBytesReceived=e.bytesReceived,n=i/1024,s[t].bytesReceived=n.toFixed(1))}}},c.outboundrtp=function(e){if(d&&"outbound-rtp"===e.type){var t=e.mediaType||"audio",r=e.isRemote?"recv":"send";if(r){if(e.bytesSent){var n=0;s.internal[t][r].prevBytesSent||(s.internal[t][r].prevBytesSent=e.bytesSent);var i=e.bytesSent-s.internal[t][r].prevBytesSent;s.internal[t][r].prevBytesSent=e.bytesSent,n=i/1024,s[t][r].availableBandwidth=n.toFixed(1),s[t].bytesSent=n.toFixed(1)}e.bytesReceived&&(n=0,s.internal[t][r].prevBytesReceived||(s.internal[t][r].prevBytesReceived=e.bytesReceived),i=e.bytesReceived-s.internal[t][r].prevBytesReceived,s.internal[t][r].prevBytesReceived=e.bytesReceived,n=i/1024,s[t].bytesReceived=n.toFixed(1))}}},c.track=function(e){if(d&&"track"===e.type){var t=!0===e.remoteSource?"send":"recv";e.frameWidth&&e.frameHeight&&(s.resolutions[t].width=e.frameWidth,s.resolutions[t].height=e.frameHeight)}};var k={audio:{send:[],recv:[]},video:{send:[],recv:[]}};c.ssrc=function(e){if(e.googCodecName&&("video"===e.mediaType||"audio"===e.mediaType)&&"ssrc"===e.type){var t=e.id.split("_").pop();-1===k[e.mediaType][t].indexOf(e.ssrc)&&k[e.mediaType][t].push(e.ssrc),s[e.mediaType][t].streams=k[e.mediaType][t].length}},p()}(t.peerConnection,(function(e){n=e}),1e3)})),t.getPCStats=function(){return n},t.updateRoomIdOnce=lr((function(){o&&o.iceReusePcIdUpdate()})),t.removeSSRCFromSDP=function(e,t,r){if(!e||!Array.isArray(t)||!r)return e;var n=Be.parse(e),i=n.media;return Array.isArray(i)&&i.forEach((function(e){if(t.includes(e.type)){var n=i.find((function(e){return"audio"===e.type})),a=null;if(Array.isArray(null==n?void 0:n.ssrcs)){for(var o=0;o<(null==n?void 0:n.ssrcs.length);o++)if(null!=n&&n.ssrcs[o].value.includes(r)){a=null==n?void 0:n.ssrcs[o].id;break}var s=null==n?void 0:n.ssrcs.filter((function(e){return e.id!==a}));n.ssrcs=s}}})),Be.write(n)},t.getDefaultSDP=ve(ge.mark((function e(){var t,r,n;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=localStorage.getItem("cache_sdp"))||"string"!=typeof t){e.next=3;break}return e.abrupt("return",{type:"offer",sdp:t});case 3:return(r=new RTCPeerConnection).createDataChannel("default"),r.addTransceiver("audio",{direction:"sendrecv"}),r.addTransceiver("video",{direction:"sendrecv"}),e.next=9,r.createOffer();case 9:return n=e.sent,r.close(),localStorage.setItem("cache_sdp",n.sdp),e.abrupt("return",n);case 13:case"end":return e.stop()}}),e)}))),t.toPlanB=function(){var e=ve(ge.mark((function e(r){var n,i,a,o,s,c,d,u;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=ga.toPlanB(r),(i=Be.parse(n.sdp)).msidSemantic.token="",a={audio:1,video:1},i.media.forEach((function(e){e.direction="sendrecv",delete a[e.type]})),!(o=Object.keys(a)).length){e.next=16;break}return e.next=10,t.getDefaultSDP();case 10:s=e.sent,c=Be.parse(s.sdp),d=c.media,u={},Array.isArray(d)&&d.forEach((function(e){e.ssrcs=[],e.ssrcGroups&&(e.ssrcGroups=[]),delete e.msid,u[e.type]=e})),o.forEach((function(e){var t=u[e];t.mid=e,i.media.push(t)}));case 16:try{i.groups[0].mids="data audio video"}catch(e){}return e.abrupt("return",new RTCSessionDescription({type:r.type,sdp:Be.write(i)}));case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.toUnifiedPlan=function(){var e=ve(ge.mark((function e(r){var n,i,a,o,s,d,u,p,f,h,m,v,g,y,b,_,S,w,k;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.negotiationing=!0,i=Be.parse(t.peerConnection.localDescription.sdp),a=Be.parse(r.sdp),o=a.media,s=null,d=null,u=null,p=[],f=[],h=[],m=!1,v=[],o.forEach((function(e){for(var r=0,n=Object.entries(t.iceOptions.answer);r<n.length;r++){var i=ke(n[r],2),a=i[0],o=i[1];e[a]=o}"application"===e.type?s=e:"audio"===e.type?(d=Re(e),p=d.ssrcs||[],delete d.ssrcs):"video"===e.type&&(u=Re(e),f=u.ssrcs||[],h=u.ssrcGroups||[],delete u.ssrcs,delete u.ssrcGroups)})),g={},r.sdp.replace(/a=ssrc:(\d+) msid:.+ ([0-9a-z\-]+)/g,(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t[1],i=t[2];g[i]?g[i].push(+n):g[i]=[+n]})),y=0,b="",i.media.forEach((function(e){var t=null;switch(y=e.mid,"inactive"!==e.direction&&(b+=" ".concat(e.mid)),e.type){case"application":s.mid=y,v.push(s);break;case"audio":if((t=Re(d)).mid=y,"sendonly"===e.direction)t.direction="recvonly";else if("inactive"===e.direction)t.direction="inactive",t.port=0;else if("recvonly"===e.direction){t.direction="sendonly";var r=ya[t.mid];if(r){var n=g[r];n&&(t.ssrcs=[],p=p.filter((function(e){return!n.includes(e.id)||(t.ssrcs.push(e),!1)})))}else p.length&&(m=!0),l(t,p)}v.push(t);break;case"video":if((t=Re(u)).mid=y,"sendonly"===e.direction)t.direction="recvonly";else if("inactive"===e.direction)t.direction="inactive",t.port=0;else if("recvonly"===e.direction){t.direction="sendonly";var i=ya[t.mid];if(i){var a=g[i];if(a){t.ssrcs=[],f=f.filter((function(e){return!a.includes(e.id)||(t.ssrcs.push(e),!1)}));for(var o=0;o<h.length;o++){var c=h[o];if(c.ssrcs.includes(a[0])&&c.ssrcs.includes(a[1])){t.ssrcGroups=[c],h.splice(o,1);break}}}}else if(h.length){m=!0;var _=h.shift();for(t.ssrcGroups=[_],t.ssrcs=[];f.length&&_.ssrcs.includes(f[0].id);){var S=f.shift();if("msid"===S.attribute){var w=S.value.split(" "),k=ke(w,2)[1];ya[t.mid]=k}t.ssrcs.push(S)}}else if(f.length){m=!0;var C=f.shift();for(t.ssrcs=[C];f.length&&f[0].id===C.id;){var A=f.shift();if("msid"===A.attribute){var E=A.value.split(" "),R=ke(E,2)[1];ya[t.mid]=R}t.ssrcs.push(A)}}}v.push(t)}})),!p.length){e.next=36;break}case 19:if(!p.length){e.next=34;break}return _=t.peerConnection.addTransceiver("audio",{direction:"recvonly"}),e.next=23,t.peerConnection.createOffer();case 23:return S=e.sent,e.next=26,c(S);case 26:(w=Re(d)).mid=_.mid,w.direction="sendonly",b+=" ".concat(_.mid),l(w,p),v.push(w),e.next=19;break;case 34:e.next=42;break;case 36:if(!m){e.next=42;break}return e.next=39,t.peerConnection.createOffer();case 39:return k=e.sent,e.next=42,c(k);case 42:return h.length,a.media=v,null!=a&&null!==(n=a.groups)&&void 0!==n&&n.length&&(a.groups[0].mids=b.trim()),e.abrupt("return",Be.write(a));case 46:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.getOffer=function(){return""},t},_a=function(e){et.info("Starting Chrome stable stack",e);var t=e,r=ba(e);return r.enableSimulcast=function(e,r){var n,i=e;if(!t.video)return i;var a=new RegExp(/a=ssrc-group:SIM ([0-9]*) ([0-9]*)\r?\na=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\na=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\n/),o=i.replace(a,"").match(/a=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\n/);if(!o||o.length<=0)return i;var s=r.numSpatialLayers||2,c=parseInt(o[1],10),d=parseInt(o[2],10),u=i.match(new RegExp("a=ssrc:".concat(o[1]," cname:(.*)\r?\n")))[1],l=i.match(new RegExp("a=ssrc:".concat(o[1]," msid:(.*)\r?\n")))[1],p=i.match(new RegExp("a=ssrc:".concat(o[1]," mslabel:(.*)\r?\n")))[1],f=i.match(new RegExp("a=ssrc:".concat(o[1]," label:(.*)\r?\n")))[1];i.match(new RegExp("a=ssrc:".concat(o[1],".*\r?\n"),"g")).forEach((function(e){i=i.replace(e,"")})),i.match(new RegExp("a=ssrc:".concat(o[2],".*\r?\n"),"g")).forEach((function(e){i=i.replace(e,"")}));for(var h,m,v=[c],g=[d],y=1;y<s;y+=1)v.push(c+1e3*y),g.push(d+1e3*y);n=nt.addSim(v);for(var b=0;b<v.length;b+=1)h=v[b],m=g[b],n+=nt.addGroup(h,m);for(var _=0;_<v.length;_+=1)h=v[_],m=g[_],n+=nt.addSpatialLayer(u,l,p,f,h,m);return n+="a=x-google-flag:conference\r\n",i.replace(o[0],n)},r.setMinVideoBW=function(e,t){t&&(et.debug("minVideoBW requested: ".concat(t)),nt.setParamForCodecs(e,"video","x-google-min-bitrate",t),nt.setParamForCodecs(e,"audio","x-google-min-bitrate",t))},r.setConference=function(e){nt.setXGoogleFlag(e,"video","conference")},r.getOffer=function(){return r.peerConnection.localDescription.toJSON()},r},Sa=function(e){et.info("Starting Firefox stack");var t=ba(e),r=e,n=[{rid:"low",scaleResolutionDownBy:3},{rid:"med",scaleResolutionDownBy:2},{rid:"high"}],i=function(){r.simulcast&&t.peerConnection.getSenders().forEach((function(e){"video"===e.track.kind&&function(e){var t=r.simulcast.numSpatialLayers||2,i=n.length;t=t<i?t:i;var a=e.getParameters()||{};a.encodings=[];for(var o=i-1;o>=i-t;o-=1)a.encodings.push(n[o]);e.setParameters(a)}(e)}))};t.enableSimulcast=function(e){return e};var a=t.createOffer;return t.createOffer=function(e){!0!==e&&i(),a(e)},t.getOffer=function(){return t.peerConnection.localDescription},t};function wa(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return ka(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ka(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function ka(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ca=103,Aa=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r={},n=e;if(t&&(n.pcId=t),Ca+=1,n.sessionId=Ca,r.browser=pa(),"mozilla"===r.browser)et.debug("Firefox Stack"),r=Sa(n);else if("safari"===r.browser)et.debug("Safari using Chrome Stable Stack"),r=_a(n);else{if("chrome-stable"!==r.browser&&"electron"!==r.browser)throw et.error("No stack available for this browser"),new Error("WebRTC stack not available");et.debug("Chrome Stable Stack"),r=_a(n)}return r.updateSpec||(r.updateSpec=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};et.error("Update Configuration not implemented in this browser"),t("unimplemented")}),r},Ea=function(){function e(){var t=this;Ce(this,e),this.connectionsMap=new Map,this.clearTimer=setInterval((function(){var e,r=wa(t.connectionsMap.entries());try{for(r.s();!(e=r.n()).done;){var n=ke(e.value,2),i=n[0];"closed"===n[1].peerConnection.signalingState&&t.connectionsMap.delete(i)}}catch(e){r.e(e)}finally{r.f()}}),1e3)}return Ee(e,[{key:"destroy",value:function(){clearInterval(this.clearTimer);var e,t=wa(this.connectionsMap.entries());try{for(t.s();!(e=t.n()).done;){var r=ke(e.value,2),n=r[0],i=r[1];"closed"===i.peerConnection.signalingState&&(i.peerConnection.close(),this.connectionsMap.delete(n))}}catch(e){t.e(e)}finally{t.f()}}},{key:"getOrCreateConnection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!t)return Aa(e);if(this.connectionsMap.has(t))return this.connectionsMap.get(t);var r=Aa(e,t);return this.connectionsMap.set(t,r),r}},{key:"reset",value:function(){this.connectionsMap.forEach((function(e){e.close()})),this.connectionsMap.clear()}}]),e}(),Ra={GetUserMedia:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=function(e,t,r){navigator.mediaDevices.getUserMedia(e).then(t,r)},a=function(e,t,r){navigator.mediaDevices.getDisplayMedia(e).then(t,r)},o=function(e){return{video:{width:e.video.width.ideal,height:e.video.height.ideal,frameRate:{ideal:e.video.frameRate.ideal}},audio:!!e.screenAudio}},s=function(){switch(et.debug("Screen access requested"),pa()){case"electron":if(et.debug("Screen sharing in Electron"),e.desktopStreamId)(t={}).video={},et.debug("screen video config",JSON.stringify(e.video)),t.video.mandatory=e.video.mandatory||{},t.video.mandatory.chromeMediaSource="desktop",t.video.mandatory.chromeMediaSourceId=e.desktopStreamId,e.video.height&&(t.video.mandatory.minHeight=e.video.height.min,t.video.mandatory.maxHeight=e.video.height.max),e.video.width&&(t.video.mandatory.minWidth=e.video.width.min,t.video.mandatory.maxWidth=e.video.width.max);else{var s=!1,c=!1;e.audio&&(s=!0===e.audio?{}:e.audio,Object.assign(s,{mandatory:{chromeMediaSource:"desktop"}})),e.video&&(c=!0===e.video?{}:e.video,Object.assign(c,{mandatory:{chromeMediaSource:"desktop"}})),t={audio:s,video:c}}et.debug("Screen sharing in Electron getUserMedia",t),i(t,r,n);break;case"mozilla":et.debug("Screen sharing in Firefox"),t={},void 0!==e.video?(t.video=e.video,t.video.mediaSource||(t.video.mediaSource="window")):t={audio:e.audio,video:{mediaSource:"window"}},i(t,r,n);break;case"chrome-stable":if(et.debug("Screen sharing in Chrome"),t={},e.desktopStreamId)t.video=e.video||{mandatory:{}},t.video.mandatory=t.video.mandatory||{},t.video.mandatory.chromeMediaSource="desktop",t.video.mandatory.chromeMediaSourceId=e.desktopStreamId,t.audio=e.screenAudio,i(t,r,n);else if(e.extensionId){var d=e.extensionId;et.debug("Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(d,{getStream:!0},(function(a){if(void 0!==a){var o=a.streamId;void 0!==e.video.mandatory?(t.video=e.video||{mandatory:{}},t.video.mandatory.chromeMediaSource="desktop",t.video.mandatory.chromeMediaSourceId=o):t={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o}}},i(t,r,n)}else{et.error("Access to screen denied");n({code:"Access to screen denied"})}}))}catch(e){et.debug("Screensharing plugin is not accessible ");n({code:"no_plugin_present"})}}else a(o(e),r,n);break;case"safari":a(o(e),r,n);break;default:et.error("This browser does not support ScreenSharing")}};e.screen?s():(et.debug("Calling getUserMedia with config",e),i(e,r,n))},buildConnection:Aa,ConnectionManager:Ea},Ta=(r((function(e,r){e.exports=function(){var e;return function e(t,r,i){function a(s,c){if(!r[s]){if(!t[s]){if(!c&&n)return n(s);if(o)return o(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var u=r[s]={exports:{}};t[s][0].call(u.exports,(function(e){var r=t[s][1][e];return a(r||e)}),u,u.exports,e,t,r,i)}return r[s].exports}for(var o=n,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,r){t.exports=e("./lib/")},{"./lib/":2}],2:[function(e,t,r){t.exports=e("./socket"),t.exports.parser=e("engine.io-parser")},{"./socket":3,"engine.io-parser":19}],3:[function(e,r,n){(function(t){var n=e("./transports"),a=e("component-emitter"),o=e("debug")("engine.io-client:socket"),s=e("indexof"),c=e("engine.io-parser"),d=e("parseuri"),u=e("parsejson"),l=e("parseqs");function p(e,r){if(!(this instanceof p))return new p(e,r);r=r||{},e&&"object"==i(e)&&(r=e,e=null),e?(e=d(e),r.hostname=e.host,r.secure="https"==e.protocol||"wss"==e.protocol,r.port=e.port,e.query&&(r.query=e.query)):r.host&&(r.hostname=d(r.host).host),this.secure=null!=r.secure?r.secure:t.location&&"https:"==location.protocol,r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.agent=r.agent||!1,this.hostname=r.hostname||(t.location?location.hostname:"localhost"),this.port=r.port||(t.location&&location.port?location.port:this.secure?443:80),this.query=r.query||{},"string"==typeof this.query&&(this.query=l.decode(this.query)),this.upgrade=!1!==r.upgrade,this.path=(r.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!r.forceJSONP,this.jsonp=!1!==r.jsonp,this.forceBase64=!!r.forceBase64,this.enablesXDR=!!r.enablesXDR,this.timestampParam=r.timestampParam||"t",this.timestampRequests=r.timestampRequests,this.transports=r.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.policyPort=r.policyPort||843,this.rememberUpgrade=r.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=r.onlyBinaryUpgrades,this.perMessageDeflate=!1!==r.perMessageDeflate&&(r.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=r.pfx||null,this.key=r.key||null,this.passphrase=r.passphrase||null,this.cert=r.cert||null,this.ca=r.ca||null,this.ciphers=r.ciphers||null,this.rejectUnauthorized=void 0===r.rejectUnauthorized?null:r.rejectUnauthorized;var n="object"==i(t)&&t;n.global===n&&r.extraHeaders&&Object.keys(r.extraHeaders).length>0&&(this.extraHeaders=r.extraHeaders),this.open()}function f(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}r.exports=p,p.priorWebsocketSuccess=!1,a(p.prototype),p.protocol=c.protocol,p.Socket=p,p.Transport=e("./transport"),p.transports=e("./transports"),p.parser=e("engine.io-parser"),p.prototype.createTransport=function(e){o('creating transport "%s"',e);var t=f(this.query);return t.EIO=c.protocol,t.transport=e,this.id&&(t.sid=this.id),new n[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders})},p.prototype.open=function(){var e;if(this.rememberUpgrade&&p.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},p.prototype.setTransport=function(e){o("setting transport %s",e.name);var t=this;this.transport&&(o("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))},p.prototype.probe=function(e){o('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),r=!1,n=this;function i(){if(n.onlyBinaryUpgrades){var i=!this.supportsBinary&&n.transport.supportsBinary;r=r||i}r||(o('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(function(i){if(!r)if("pong"==i.type&&"probe"==i.data){if(o('probe transport "%s" pong',e),n.upgrading=!0,n.emit("upgrading",t),!t)return;p.priorWebsocketSuccess="websocket"==t.name,o('pausing current transport "%s"',n.transport.name),n.transport.pause((function(){r||"closed"!=n.readyState&&(o("changing transport and sending upgrade packet"),l(),n.setTransport(t),t.send([{type:"upgrade"}]),n.emit("upgrade",t),t=null,n.upgrading=!1,n.flush())}))}else{o('probe transport "%s" failed',e);var a=new Error("probe error");a.transport=t.name,n.emit("upgradeError",a)}})))}function a(){r||(r=!0,l(),t.close(),t=null)}function s(r){var i=new Error("probe error: "+r);i.transport=t.name,a(),o('probe transport "%s" failed because of error: %s',e,r),n.emit("upgradeError",i)}function c(){s("transport closed")}function d(){s("socket closed")}function u(e){t&&e.name!=t.name&&(o('"%s" works - aborting "%s"',e.name,t.name),a())}function l(){t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",c),n.removeListener("close",d),n.removeListener("upgrading",u)}p.priorWebsocketSuccess=!1,t.once("open",i),t.once("error",s),t.once("close",c),this.once("close",d),this.once("upgrading",u),t.open()},p.prototype.onOpen=function(){if(o("socket open"),this.readyState="open",p.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){o("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},p.prototype.onPacket=function(e){if("opening"==this.readyState||"open"==this.readyState)switch(o('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(u(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else o('packet received with socket readyState "%s"',this.readyState)},p.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},p.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout((function(){"closed"!=t.readyState&&t.onClose("ping timeout")}),e||t.pingInterval+t.pingTimeout)},p.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout((function(){o("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)}),e.pingInterval)},p.prototype.ping=function(){var e=this;this.sendPacket("ping",(function(){e.emit("ping")}))},p.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},p.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},p.prototype.write=p.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},p.prototype.sendPacket=function(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"!=this.readyState&&"closed"!=this.readyState){(r=r||{}).compress=!1!==r.compress;var i={type:e,data:t,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}},p.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?n():t()})):this.upgrading?n():t()}function t(){e.onClose("forced close"),o("socket closing - telling transport to close"),e.transport.close()}function r(){e.removeListener("upgrade",r),e.removeListener("upgradeError",r),t()}function n(){e.once("upgrade",r),e.once("upgradeError",r)}return this},p.prototype.onError=function(e){o("socket error %j",e),p.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},p.prototype.onClose=function(e,t){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){o('socket close with reason: "%s"',e);var r=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),r.writeBuffer=[],r.prevBufferLen=0}},p.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;r<n;r++)~s(this.transports,e[r])&&t.push(e[r]);return t}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{})},{"./transport":4,"./transports":5,"component-emitter":15,debug:17,"engine.io-parser":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(e,t,r){var n=e("engine.io-parser"),i=e("component-emitter");function a(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders}t.exports=a,i(a.prototype),a.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},a.prototype.open=function(){return"closed"!=this.readyState&&""!=this.readyState||(this.readyState="opening",this.doOpen()),this},a.prototype.close=function(){return"opening"!=this.readyState&&"open"!=this.readyState||(this.doClose(),this.onClose()),this},a.prototype.send=function(e){if("open"!=this.readyState)throw new Error("Transport not open");this.write(e)},a.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},a.prototype.onData=function(e){var t=n.decodePacket(e,this.socket.binaryType);this.onPacket(t)},a.prototype.onPacket=function(e){this.emit("packet",e)},a.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":15,"engine.io-parser":19}],5:[function(e,r,n){(function(t){var r=e("xmlhttprequest-ssl"),i=e("./polling-xhr"),a=e("./polling-jsonp"),o=e("./websocket");function s(e){var n=!1,o=!1,s=!1!==e.jsonp;if(t.location){var c="https:"==location.protocol,d=location.port;d||(d=c?443:80),n=e.hostname!=location.hostname||d!=e.port,o=e.secure!=c}if(e.xdomain=n,e.xscheme=o,"open"in new r(e)&&!e.forceJSONP)return new i(e);if(!s)throw new Error("JSONP disabled");return new a(e)}n.polling=s,n.websocket=o}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{})},{"./polling-jsonp":6,"./polling-xhr":7,"./websocket":9,"xmlhttprequest-ssl":10}],6:[function(e,r,n){(function(t){var n=e("./polling"),i=e("component-inherit");r.exports=d;var a,o=/\n/g,s=/\\n/g;function c(){}function d(e){n.call(this,e),this.query=this.query||{},a||(t.___eio||(t.___eio=[]),a=t.___eio),this.index=a.length;var r=this;a.push((function(e){r.onData(e)})),this.query.j=this.index,t.document&&t.addEventListener&&t.addEventListener("beforeunload",(function(){r.script&&(r.script.onerror=c)}),!1)}i(d,n),d.prototype.supportsBinary=!1,d.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),n.prototype.doClose.call(this)},d.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)},d.prototype.doWrite=function(e,t){var r=this;if(!this.form){var n,i=document.createElement("form"),a=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=c,i.method="POST",i.setAttribute("accept-charset","utf-8"),a.name="d",i.appendChild(a),document.body.appendChild(i),this.form=i,this.area=a}function d(){u(),t()}function u(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(e){r.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';n=document.createElement(e)}catch(e){(n=document.createElement("iframe")).name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}this.form.action=this.uri(),u(),e=e.replace(s,"\\\n"),this.area.value=e.replace(o,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==r.iframe.readyState&&d()}:this.iframe.onload=d}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{})},{"./polling":8,"component-inherit":16}],7:[function(e,r,n){(function(t){var n=e("xmlhttprequest-ssl"),i=e("./polling"),a=e("component-emitter"),o=e("component-inherit"),s=e("debug")("engine.io-client:polling-xhr");function c(){}function d(e){if(i.call(this,e),t.location){var r="https:"==location.protocol,n=location.port;n||(n=r?443:80),this.xd=e.hostname!=t.location.hostname||n!=e.port,this.xs=e.secure!=r}else this.extraHeaders=e.extraHeaders}function u(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=null!=e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function l(){for(var e in u.requests)u.requests.hasOwnProperty(e)&&u.requests[e].abort()}r.exports=d,r.exports.Request=u,o(d,i),d.prototype.supportsBinary=!0,d.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.extraHeaders=this.extraHeaders,new u(e)},d.prototype.doWrite=function(e,t){var r="string"!=typeof e&&void 0!==e,n=this.request({method:"POST",data:e,isBinary:r}),i=this;n.on("success",t),n.on("error",(function(e){i.onError("xhr post error",e)})),this.sendXhr=n},d.prototype.doPoll=function(){s("xhr poll");var e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e},a(u.prototype),u.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var r=this.xhr=new n(e),i=this;try{s("xhr open %s: %s",this.method,this.uri),r.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var a in r.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(a)&&r.setRequestHeader(a,this.extraHeaders[a])}catch(e){}if(this.supportsBinary&&(r.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?r.setRequestHeader("Content-type","application/octet-stream"):r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}"withCredentials"in r&&(r.withCredentials=!0),this.hasXDR()?(r.onload=function(){i.onLoad()},r.onerror=function(){i.onError(r.responseText)}):r.onreadystatechange=function(){4==r.readyState&&(200==r.status||1223==r.status?i.onLoad():setTimeout((function(){i.onError(r.status)}),0))},s("xhr data %s",this.data),r.send(this.data)}catch(e){return void setTimeout((function(){i.onError(e)}),0)}t.document&&(this.index=u.requestsCount++,u.requests[this.index]=this)},u.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},u.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},u.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},u.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,e)try{this.xhr.abort()}catch(e){}t.document&&delete u.requests[this.index],this.xhr=null}},u.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}if("application/octet-stream"===t)e=this.xhr.response;else if(this.supportsBinary)try{e=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(t){for(var r=new Uint8Array(this.xhr.response),n=[],i=0,a=r.length;i<a;i++)n.push(r[i]);e=String.fromCharCode.apply(null,n)}else e=this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},u.prototype.hasXDR=function(){return void 0!==t.XDomainRequest&&!this.xs&&this.enablesXDR},u.prototype.abort=function(){this.cleanup()},t.document&&(u.requestsCount=0,u.requests={},t.attachEvent?t.attachEvent("onunload",l):t.addEventListener&&t.addEventListener("beforeunload",l,!1))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{})},{"./polling":8,"component-emitter":15,"component-inherit":16,debug:17,"xmlhttprequest-ssl":10}],8:[function(e,t,r){var n=e("../transport"),i=e("parseqs"),a=e("engine.io-parser"),o=e("component-inherit"),s=e("yeast"),c=e("debug")("engine.io-client:polling");t.exports=u;var d=null!=new(e("xmlhttprequest-ssl"))({xdomain:!1}).responseType;function u(e){var t=e&&e.forceBase64;d&&!t||(this.supportsBinary=!1),n.call(this,e)}o(u,n),u.prototype.name="polling",u.prototype.doOpen=function(){this.poll()},u.prototype.pause=function(e){var t=this;function r(){c("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(c("we are currently polling - waiting to pause"),n++,this.once("pollComplete",(function(){c("pre-pause polling complete"),--n||r()}))),this.writable||(c("we are currently writing - waiting to pause"),n++,this.once("drain",(function(){c("pre-pause writing complete"),--n||r()})))}else r()},u.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},u.prototype.onData=function(e){var t=this;c("polling got data %s",e);var r=function(e,r,n){if("opening"==t.readyState&&t.onOpen(),"close"==e.type)return t.onClose(),!1;t.onPacket(e)};a.decodePayload(e,this.socket.binaryType,r),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},u.prototype.doClose=function(){var e=this;function t(){c("writing close packet"),e.write([{type:"close"}])}"open"==this.readyState?(c("transport open - closing"),t()):(c("transport not open - deferring close"),this.once("open",t))},u.prototype.write=function(e){var t=this;this.writable=!1;var r=function(){t.writable=!0,t.emit("drain")};t=this,a.encodePayload(e,this.supportsBinary,(function(e){t.doWrite(e,r)}))},u.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";return!1!==this.timestampRequests&&(e[this.timestampParam]=s()),this.supportsBinary||e.sid||(e.b64=1),e=i.encode(e),this.port&&("https"==t&&443!=this.port||"http"==t&&80!=this.port)&&(r=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e}},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,"xmlhttprequest-ssl":10,yeast:30}],9:[function(e,r,n){(function(t){var n=e("../transport"),i=e("engine.io-parser"),a=e("parseqs"),o=e("component-inherit"),s=e("yeast"),c=e("debug")("engine.io-client:websocket"),d=t.WebSocket||t.MozWebSocket,u=d;if(!u&&"undefined"==typeof window)try{u=e("ws")}catch(e){}function l(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,n.call(this,e)}r.exports=l,o(l,n),l.prototype.name="websocket",l.prototype.supportsBinary=!0,l.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=void 0,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.ws=d?new u(e):new u(e,t,r),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="buffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},l.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(l.prototype.onData=function(e){var t=this;setTimeout((function(){n.prototype.onData.call(t,e)}),0)}),l.prototype.write=function(e){var r=this;this.writable=!1;for(var n=e.length,a=0,o=n;a<o;a++)!function(e){i.encodePacket(e,r.supportsBinary,(function(i){if(!d){var a={};e.options&&(a.compress=e.options.compress),r.perMessageDeflate&&("string"==typeof i?t.Buffer.byteLength(i):i.length)<r.perMessageDeflate.threshold&&(a.compress=!1)}try{d?r.ws.send(i):r.ws.send(i,a)}catch(e){c("websocket closed before onclose event")}--n||s()}))}(e[a]);function s(){r.emit("flush"),setTimeout((function(){r.writable=!0,r.emit("drain")}),0)}},l.prototype.onClose=function(){n.prototype.onClose.call(this)},l.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},l.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";return this.port&&("wss"==t&&443!=this.port||"ws"==t&&80!=this.port)&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=s()),this.supportsBinary||(e.b64=1),(e=a.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e},l.prototype.check=function(){return!(!u||"__initialize"in u&&this.name===l.prototype.name)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{})},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,ws:void 0,yeast:30}],10:[function(e,t,r){var n=e("has-cors");t.exports=function(e){var t=e.xdomain,r=e.xscheme,i=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||n))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!r&&i)return new XDomainRequest}catch(e){}if(!t)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}},{"has-cors":22}],11:[function(e,t,r){function n(e,t,r){var n=!1;return r=r||i,a.count=e,0===e?t():a;function a(e,i){if(a.count<=0)throw new Error("after called too many times");--a.count,e?(n=!0,t(e),t=r):0!==a.count||n||t(null,i)}}function i(){}t.exports=n},{}],12:[function(e,t,r){t.exports=function(e,t,r){var n=e.byteLength;if(t=t||0,r=r||n,e.slice)return e.slice(t,r);if(t<0&&(t+=n),r<0&&(r+=n),r>n&&(r=n),t>=n||t>=r||0===n)return new ArrayBuffer(0);for(var i=new Uint8Array(e),a=new Uint8Array(r-t),o=t,s=0;o<r;o++,s++)a[s]=i[o];return a.buffer}},{}],13:[function(e,t,r){var n;n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r.encode=function(e){var t,r=new Uint8Array(e),i=r.length,a="";for(t=0;t<i;t+=3)a+=n[r[t]>>2],a+=n[(3&r[t])<<4|r[t+1]>>4],a+=n[(15&r[t+1])<<2|r[t+2]>>6],a+=n[63&r[t+2]];return i%3==2?a=a.substring(0,a.length-1)+"=":i%3==1&&(a=a.substring(0,a.length-2)+"=="),a},r.decode=function(e){var t,r,i,a,o,s=.75*e.length,c=e.length,d=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var u=new ArrayBuffer(s),l=new Uint8Array(u);for(t=0;t<c;t+=4)r=n.indexOf(e[t]),i=n.indexOf(e[t+1]),a=n.indexOf(e[t+2]),o=n.indexOf(e[t+3]),l[d++]=r<<2|i>>4,l[d++]=(15&i)<<4|a>>2,l[d++]=(3&a)<<6|63&o;return u}},{}],14:[function(e,r,n){(function(e){var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,n=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),i=n&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),a=t&&t.prototype.append&&t.prototype.getBlob;function o(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.buffer instanceof ArrayBuffer){var n=r.buffer;if(r.byteLength!==n.byteLength){var i=new Uint8Array(r.byteLength);i.set(new Uint8Array(n,r.byteOffset,r.byteLength)),n=i.buffer}e[t]=n}}}function s(e,r){r=r||{};var n=new t;o(e);for(var i=0;i<e.length;i++)n.append(e[i]);return r.type?n.getBlob(r.type):n.getBlob()}function c(e,t){return o(e),new Blob(e,t||{})}r.exports=n?i?e.Blob:c:a?s:void 0}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{})},{}],15:[function(e,t,r){function n(e){if(e)return i(e)}function i(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},n.prototype.once=function(e,t){var r=this;function n(){r.off(e,n),t.apply(this,arguments)}return this._callbacks=this._callbacks||{},n.fn=t,this.on(e,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks[e];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t);return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],16:[function(e,t,r){t.exports=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],17:[function(e,t,r){function n(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function a(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+r.humanize(this.diff),!t)return e;var n="color: "+this.color;e=[e[0],n,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0,a=0;return e[0].replace(/%[a-z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(a=i))})),e.splice(a,0,n),e}function o(){return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(e){try{null==e?r.storage.removeItem("debug"):r.storage.debug=e}catch(e){}}function c(){var e;try{e=r.storage.debug}catch(e){}return e}function d(){try{return window.localStorage}catch(e){}}(r=t.exports=e("./debug")).log=o,r.formatArgs=a,r.save=s,r.load=c,r.useColors=n,r.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:d(),r.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],r.formatters.j=function(e){return JSON.stringify(e)},r.enable(c())},{"./debug":18}],18:[function(e,t,r){(r=t.exports=o).coerce=u,r.disable=c,r.enable=s,r.enabled=d,r.humanize=e("ms"),r.names=[],r.skips=[],r.formatters={};var n,i=0;function a(){return r.colors[i++%r.colors.length]}function o(e){function t(){}function i(){var e=i,t=+new Date,o=t-(n||t);e.diff=o,e.prev=n,e.curr=t,n=t,null==e.useColors&&(e.useColors=r.useColors()),null==e.color&&e.useColors&&(e.color=a());var s=Array.prototype.slice.call(arguments);s[0]=r.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var c=0;s[0]=s[0].replace(/%([a-z%])/g,(function(t,n){if("%%"===t)return t;c++;var i=r.formatters[n];if("function"==typeof i){var a=s[c];t=i.call(e,a),s.splice(c,1),c--}return t})),"function"==typeof r.formatArgs&&(s=r.formatArgs.apply(e,s)),(i.log||r.log||void 0).apply(e,s)}t.enabled=!1,i.enabled=!0;var o=r.enabled(e)?i:t;return o.namespace=e,o}function s(e){r.save(e);for(var t=(e||"").split(/[\s,]+/),n=t.length,i=0;i<n;i++)t[i]&&("-"===(e=t[i].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")))}function c(){r.enable("")}function d(e){var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1}function u(e){return e instanceof Error?e.stack||e.message:e}},{ms:25}],19:[function(e,r,n){(function(t){var r=e("./keys"),i=e("has-binary"),a=e("arraybuffer.slice"),o=e("base64-arraybuffer"),s=e("after"),c=e("utf8"),d=navigator.userAgent.match(/Android/i),u=/PhantomJS/i.test(navigator.userAgent),l=d||u;n.protocol=3;var p=n.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},f=r(p),h={type:"error",data:"parser error"},m=e("blob");function v(e,t){return t("b"+n.packets[e.type]+e.data.data)}function g(e,t,r){if(!t)return n.encodeBase64Packet(e,r);var i=e.data,a=new Uint8Array(i),o=new Uint8Array(1+i.byteLength);o[0]=p[e.type];for(var s=0;s<a.length;s++)o[s+1]=a[s];return r(o.buffer)}function y(e,t,r){if(!t)return n.encodeBase64Packet(e,r);var i=new FileReader;return i.onload=function(){e.data=i.result,n.encodePacket(e,t,!0,r)},i.readAsArrayBuffer(e.data)}function b(e,t,r){if(!t)return n.encodeBase64Packet(e,r);if(l)return y(e,t,r);var i=new Uint8Array(1);return i[0]=p[e.type],r(new m([i.buffer,e.data]))}function _(e,t,r){for(var n=new Array(e.length),i=s(e.length,r),a=function(e,r,i){t(r,(function(t,r){n[e]=r,i(t,n)}))},o=0;o<e.length;o++)a(o,e[o],i)}n.encodePacket=function(e,r,n,i){"function"==typeof r&&(i=r,r=!1),"function"==typeof n&&(i=n,n=null);var a=void 0===e.data?void 0:e.data.buffer||e.data;if(t.ArrayBuffer&&a instanceof ArrayBuffer)return g(e,r,i);if(m&&a instanceof t.Blob)return b(e,r,i);if(a&&a.base64)return v(e,i);var o=p[e.type];return void 0!==e.data&&(o+=n?c.encode(String(e.data)):String(e.data)),i(""+o)},n.encodeBase64Packet=function(e,r){var i,a="b"+n.packets[e.type];if(m&&e.data instanceof t.Blob){var o=new FileReader;return o.onload=function(){var e=o.result.split(",")[1];r(a+e)},o.readAsDataURL(e.data)}try{i=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var s=new Uint8Array(e.data),c=new Array(s.length),d=0;d<s.length;d++)c[d]=s[d];i=String.fromCharCode.apply(null,c)}return a+=t.btoa(i),r(a)},n.decodePacket=function(e,t,r){if("string"==typeof e||void 0===e){if("b"==e.charAt(0))return n.decodeBase64Packet(e.substr(1),t);if(r)try{e=c.decode(e)}catch(e){return h}var i=e.charAt(0);return Number(i)==i&&f[i]?e.length>1?{type:f[i],data:e.substring(1)}:{type:f[i]}:h}i=new Uint8Array(e)[0];var o=a(e,1);return m&&"blob"===t&&(o=new m([o])),{type:f[i],data:o}},n.decodeBase64Packet=function(e,r){var n=f[e.charAt(0)];if(!t.ArrayBuffer)return{type:n,data:{base64:!0,data:e.substr(1)}};var i=o.decode(e.substr(1));return"blob"===r&&m&&(i=new m([i])),{type:n,data:i}},n.encodePayload=function(e,t,r){"function"==typeof t&&(r=t,t=null);var a=i(e);if(t&&a)return m&&!l?n.encodePayloadAsBlob(e,r):n.encodePayloadAsArrayBuffer(e,r);if(!e.length)return r("0:");function o(e){return e.length+":"+e}function s(e,r){n.encodePacket(e,!!a&&t,!0,(function(e){r(null,o(e))}))}_(e,s,(function(e,t){return r(t.join(""))}))},n.decodePayload=function(e,t,r){if("string"!=typeof e)return n.decodePayloadAsBinary(e,t,r);var i;if("function"==typeof t&&(r=t,t=null),""==e)return r(h,0,1);for(var a,o,s="",c=0,d=e.length;c<d;c++){var u=e.charAt(c);if(":"!=u)s+=u;else{if(""==s||s!=(a=Number(s)))return r(h,0,1);if(s!=(o=e.substr(c+1,a)).length)return r(h,0,1);if(o.length){if(i=n.decodePacket(o,t,!0),h.type==i.type&&h.data==i.data)return r(h,0,1);if(!1===r(i,c+a,d))return}c+=a,s=""}}return""!=s?r(h,0,1):void 0},n.encodePayloadAsArrayBuffer=function(e,t){if(!e.length)return t(new ArrayBuffer(0));function r(e,t){n.encodePacket(e,!0,!0,(function(e){return t(null,e)}))}_(e,r,(function(e,r){var n=r.reduce((function(e,t){var r;return e+(r="string"==typeof t?t.length:t.byteLength).toString().length+r+2}),0),i=new Uint8Array(n),a=0;return r.forEach((function(e){var t="string"==typeof e,r=e;if(t){for(var n=new Uint8Array(e.length),o=0;o<e.length;o++)n[o]=e.charCodeAt(o);r=n.buffer}i[a++]=t?0:1;var s=r.byteLength.toString();for(o=0;o<s.length;o++)i[a++]=parseInt(s[o]);for(i[a++]=255,n=new Uint8Array(r),o=0;o<n.length;o++)i[a++]=n[o]})),t(i.buffer)}))},n.encodePayloadAsBlob=function(e,t){function r(e,t){n.encodePacket(e,!0,!0,(function(e){var r=new Uint8Array(1);if(r[0]=1,"string"==typeof e){for(var n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);e=n.buffer,r[0]=0}var a=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),o=new Uint8Array(a.length+1);for(i=0;i<a.length;i++)o[i]=parseInt(a[i]);if(o[a.length]=255,m){var s=new m([r.buffer,o.buffer,e]);t(null,s)}}))}_(e,r,(function(e,r){return t(new m(r))}))},n.decodePayloadAsBinary=function(e,t,r){"function"==typeof t&&(r=t,t=null);for(var i=e,o=[],s=!1;i.byteLength>0;){for(var c=new Uint8Array(i),d=0===c[0],u="",l=1;255!=c[l];l++){if(u.length>310){s=!0;break}u+=c[l]}if(s)return r(h,0,1);i=a(i,2+u.length),u=parseInt(u);var p=a(i,0,u);if(d)try{p=String.fromCharCode.apply(null,new Uint8Array(p))}catch(e){var f=new Uint8Array(p);for(p="",l=0;l<f.length;l++)p+=String.fromCharCode(f[l])}o.push(p),i=a(i,u)}var m=o.length;o.forEach((function(e,i){r(n.decodePacket(e,t,!0),i,m)}))}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{})},{"./keys":20,after:11,"arraybuffer.slice":12,"base64-arraybuffer":13,blob:14,"has-binary":21,utf8:29}],20:[function(e,t,r){t.exports=Object.keys||function(e){var t=[],r=Object.prototype.hasOwnProperty;for(var n in e)r.call(e,n)&&t.push(n);return t}},{}],21:[function(e,r,n){(function(t){var n=e("isarray");function a(e){function r(e){if(!e)return!1;if(t.Buffer&&t.Buffer.isBuffer(e)||t.ArrayBuffer&&e instanceof ArrayBuffer||t.Blob&&e instanceof Blob||t.File&&e instanceof File)return!0;if(n(e)){for(var a=0;a<e.length;a++)if(r(e[a]))return!0}else if(e&&"object"==i(e))for(var o in e.toJSON&&(e=e.toJSON()),e)if(Object.prototype.hasOwnProperty.call(e,o)&&r(e[o]))return!0;return!1}return r(e)}r.exports=a}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{})},{isarray:24}],22:[function(e,t,r){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},{}],23:[function(e,t,r){var n=[].indexOf;t.exports=function(e,t){if(n)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}},{}],24:[function(e,t,r){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],25:[function(e,t,r){var n=1e3,i=60*n,a=60*i,o=24*a,s=365.25*o;function c(e){if(!((e=""+e).length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*s;case"days":case"day":case"d":return r*o;case"hours":case"hour":case"hrs":case"hr":case"h":return r*a;case"minutes":case"minute":case"mins":case"min":case"m":return r*i;case"seconds":case"second":case"secs":case"sec":case"s":return r*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r}}}}function d(e){return e>=o?Math.round(e/o)+"d":e>=a?Math.round(e/a)+"h":e>=i?Math.round(e/i)+"m":e>=n?Math.round(e/n)+"s":e+"ms"}function u(e){return l(e,o,"day")||l(e,a,"hour")||l(e,i,"minute")||l(e,n,"second")||e+" ms"}function l(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}t.exports=function(e,t){return t=t||{},"string"==typeof e?c(e):t.long?u(e):d(e)}},{}],26:[function(e,r,n){(function(e){var t=/^[\],:{}\s]*$/,n=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,i=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,a=/(?:^|:|,)(?:\s*\[)+/g,o=/^\s+/,s=/\s+$/;r.exports=function(r){return"string"==typeof r&&r?(r=r.replace(o,"").replace(s,""),e.JSON&&JSON.parse?JSON.parse(r):t.test(r.replace(n,"@").replace(i,"]").replace(a,""))?new Function("return "+r)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{})},{}],27:[function(e,t,r){r.encode=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},r.decode=function(e){for(var t={},r=e.split("&"),n=0,i=r.length;n<i;n++){var a=r[n].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t}},{}],28:[function(e,t,r){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(e){var t=e,r=e.indexOf("["),a=e.indexOf("]");-1!=r&&-1!=a&&(e=e.substring(0,r)+e.substring(r,a).replace(/:/g,";")+e.substring(a,e.length));for(var o=n.exec(e||""),s={},c=14;c--;)s[i[c]]=o[c]||"";return-1!=r&&-1!=a&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s}},{}],29:[function(e,r,n){(function(e){!function(t){var a="object"==i(n)&&n,o="object"==i(r)&&r&&r.exports==a&&r,s="object"==i(e)&&e;s.global!==s&&s.window!==s||(t=s);var c,d,u,l=String.fromCharCode;function p(e){for(var t,r,n=[],i=0,a=e.length;i<a;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<a?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function f(e){for(var t,r=e.length,n=-1,i="";++n<r;)(t=e[n])>65535&&(i+=l((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=l(t);return i}function h(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function m(e,t){return l(e>>t&63|128)}function v(e){if(0==(4294967168&e))return l(e);var t="";return 0==(4294965248&e)?t=l(e>>6&31|192):0==(4294901760&e)?(h(e),t=l(e>>12&15|224),t+=m(e,6)):0==(4292870144&e)&&(t=l(e>>18&7|240),t+=m(e,12),t+=m(e,6)),t+=l(63&e|128)}function g(e){for(var t=p(e),r=t.length,n=-1,i="";++n<r;)i+=v(t[n]);return i}function y(){if(u>=d)throw Error("Invalid byte index");var e=255&c[u];if(u++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function b(){var e,t;if(u>d)throw Error("Invalid byte index");if(u==d)return!1;if(e=255&c[u],u++,0==(128&e))return e;if(192==(224&e)){if((t=(31&e)<<6|y())>=128)return t;throw Error("Invalid continuation byte")}if(224==(240&e)){if((t=(15&e)<<12|y()<<6|y())>=2048)return h(t),t;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=(15&e)<<18|y()<<12|y()<<6|y())>=65536&&t<=1114111)return t;throw Error("Invalid UTF-8 detected")}function _(e){c=p(e),d=c.length,u=0;for(var t,r=[];!1!==(t=b());)r.push(t);return f(r)}var S={version:"2.0.0",encode:g,decode:_};if(a&&!a.nodeType)if(o)o.exports=S;else{var w={}.hasOwnProperty;for(var k in S)w.call(S,k)&&(a[k]=S[k])}else t.utf8=S}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{})},{}],30:[function(e,t,r){var n,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),a=64,o={},s=0,c=0;function d(e){var t="";do{t=i[e%a]+t,e=Math.floor(e/a)}while(e>0);return t}function u(e){var t=0;for(c=0;c<e.length;c++)t=t*a+o[e.charAt(c)];return t}function l(){var e=d(+new Date);return e!==n?(s=0,n=e):e+"."+d(s++)}for(;c<a;c++)o[i[c]]=c;l.encode=d,l.decode=u,t.exports=l},{}],31:[function(e,t,r){var n=e("./url"),a=e("socket.io-parser"),o=e("./manager"),s=e("debug")("socket.io-client");t.exports=r=d;var c=r.managers={};function d(e,t){"object"==i(e)&&(t=e,e=void 0),t=t||{};var r,a=n(e),d=a.source,u=a.id,l=a.path,p=c[u]&&l in c[u].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||p?(s("ignoring socket cache for %s",d),r=o(d,t)):(c[u]||(s("new io instance for %s",d),c[u]=o(d,t)),r=c[u]),r.socket(a.path)}r.protocol=a.protocol,r.connect=d,r.Manager=e("./manager"),r.Socket=e("./socket")},{"./manager":32,"./socket":34,"./url":35,debug:39,"socket.io-parser":47}],32:[function(e,t,r){var n=e("engine.io-client"),a=e("./socket"),o=e("component-emitter"),s=e("socket.io-parser"),c=e("./on"),d=e("component-bind"),u=e("debug")("socket.io-client:manager"),l=e("indexof"),p=e("backo2"),f=Object.prototype.hasOwnProperty;function h(e,t){if(!(this instanceof h))return new h(e,t);e&&"object"==i(e)&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new p({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new s.Encoder,this.decoder=new s.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}t.exports=h,h.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)f.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},h.prototype.updateSocketIds=function(){for(var e in this.nsps)f.call(this.nsps,e)&&(this.nsps[e].id=this.engine.id)},o(h.prototype),h.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},h.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},h.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},h.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},h.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},h.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},h.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},h.prototype.open=h.prototype.connect=function(e){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=n(this.uri,this.opts);var t=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var i=c(t,"open",(function(){r.onopen(),e&&e()})),a=c(t,"error",(function(t){if(u("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else r.maybeReconnectOnOpen()}));if(!1!==this._timeout){var o=this._timeout;u("connect attempt will timeout after %d",o);var s=setTimeout((function(){u("connect attempt timed out after %d",o),i.destroy(),t.close(),t.emit("error","timeout"),r.emitAll("connect_timeout",o)}),o);this.subs.push({destroy:function(){clearTimeout(s)}})}return this.subs.push(i),this.subs.push(a),this},h.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(c(e,"data",d(this,"ondata"))),this.subs.push(c(e,"ping",d(this,"onping"))),this.subs.push(c(e,"pong",d(this,"onpong"))),this.subs.push(c(e,"error",d(this,"onerror"))),this.subs.push(c(e,"close",d(this,"onclose"))),this.subs.push(c(this.decoder,"decoded",d(this,"ondecoded")))},h.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},h.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},h.prototype.ondata=function(e){this.decoder.add(e)},h.prototype.ondecoded=function(e){this.emit("packet",e)},h.prototype.onerror=function(e){u("error",e),this.emitAll("error",e)},h.prototype.socket=function(e){var t=this.nsps[e];if(!t){t=new a(this,e),this.nsps[e]=t;var r=this;t.on("connecting",n),t.on("connect",(function(){t.id=r.engine.id})),this.autoConnect&&n()}function n(){~l(r.connecting,t)||r.connecting.push(t)}return t},h.prototype.destroy=function(e){var t=l(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},h.prototype.packet=function(e){u("writing packet %j",e);var t=this;t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,(function(r){for(var n=0;n<r.length;n++)t.engine.write(r[n],e.options);t.encoding=!1,t.processPacketQueue()})))},h.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},h.prototype.cleanup=function(){var e;for(u("cleanup");e=this.subs.shift();)e.destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},h.prototype.close=h.prototype.disconnect=function(){u("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"==this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},h.prototype.onclose=function(e){u("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},h.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();u("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var r=setTimeout((function(){e.skipReconnect||(u("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open((function(t){t?(u("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(u("reconnect success"),e.onreconnect())})))}),t);this.subs.push({destroy:function(){clearTimeout(r)}})}},h.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},{"./on":33,"./socket":34,backo2:36,"component-bind":37,"component-emitter":38,debug:39,"engine.io-client":1,indexof:42,"socket.io-parser":47}],33:[function(e,t,r){function n(e,t,r){return e.on(t,r),{destroy:function(){e.removeListener(t,r)}}}t.exports=n},{}],34:[function(e,t,r){var n=e("socket.io-parser"),i=e("component-emitter"),a=e("to-array"),o=e("./on"),s=e("component-bind"),c=e("debug")("socket.io-client:socket"),d=e("has-binary");t.exports=p;var u={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},l=i.prototype.emit;function p(e,t){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.io.autoConnect&&this.open()}i(p.prototype),p.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[o(e,"open",s(this,"onopen")),o(e,"packet",s(this,"onpacket")),o(e,"close",s(this,"onclose"))]}},p.prototype.open=p.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this.emit("connecting")),this},p.prototype.send=function(){var e=a(arguments);return e.unshift("message"),this.emit.apply(this,e),this},p.prototype.emit=function(e){if(u.hasOwnProperty(e))return l.apply(this,arguments),this;var t=a(arguments),r=n.EVENT;d(t)&&(r=n.BINARY_EVENT);var i={type:r,data:t,options:{}};return i.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),delete this.flags,this},p.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},p.prototype.onopen=function(){c("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:n.CONNECT})},p.prototype.onclose=function(e){c("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},p.prototype.onpacket=function(e){if(e.nsp==this.nsp)switch(e.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(e);break;case n.ACK:case n.BINARY_ACK:this.onack(e);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",e.data)}},p.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?l.apply(this,t):this.receiveBuffer.push(t)},p.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var i=a(arguments);c("sending ack %j",i);var o=d(i)?n.BINARY_ACK:n.ACK;t.packet({type:o,id:e,data:i})}}},p.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(c("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):c("bad ack %s",e.id)},p.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},p.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)l.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},p.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},p.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},p.prototype.close=p.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},p.prototype.compress=function(e){return this.flags=this.flags||{},this.flags.compress=e,this}},{"./on":33,"component-bind":37,"component-emitter":38,debug:39,"has-binary":41,"socket.io-parser":47,"to-array":51}],35:[function(e,r,n){(function(t){var n=e("parseuri"),i=e("debug")("socket.io-client:url");function a(e,r){var a=e;r=r||t.location,null==e&&(e=r.protocol+"//"+r.host),"string"==typeof e&&("/"==e.charAt(0)&&(e="/"==e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e=void 0!==r?r.protocol+"//"+e:"https://"+e),i("parse %s",e),a=n(e)),a.port||(/^(http|ws)$/.test(a.protocol)?a.port="80":/^(http|ws)s$/.test(a.protocol)&&(a.port="443")),a.path=a.path||"/";var o=-1!==a.host.indexOf(":")?"["+a.host+"]":a.host;return a.id=a.protocol+"://"+o+":"+a.port,a.href=a.protocol+"://"+o+(r&&r.port==a.port?"":":"+a.port),a}r.exports=a}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{})},{debug:39,parseuri:45}],36:[function(e,t,r){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}t.exports=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}},{}],37:[function(e,t,r){var n=[].slice;t.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return t.apply(e,r.concat(n.call(arguments)))}}},{}],38:[function(e,t,r){function n(e){if(e)return i(e)}function i(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t);return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],39:[function(e,t,r){arguments[4][17][0].apply(r,arguments)},{"./debug":40,dup:17}],40:[function(e,t,r){arguments[4][18][0].apply(r,arguments)},{dup:18,ms:44}],41:[function(e,r,n){(function(t){var n=e("isarray");function a(e){function r(e){if(!e)return!1;if(t.Buffer&&t.Buffer.isBuffer&&t.Buffer.isBuffer(e)||t.ArrayBuffer&&e instanceof ArrayBuffer||t.Blob&&e instanceof Blob||t.File&&e instanceof File)return!0;if(n(e)){for(var a=0;a<e.length;a++)if(r(e[a]))return!0}else if(e&&"object"==i(e))for(var o in e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),e)if(Object.prototype.hasOwnProperty.call(e,o)&&r(e[o]))return!0;return!1}return r(e)}r.exports=a}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{})},{isarray:43}],42:[function(e,t,r){arguments[4][23][0].apply(r,arguments)},{dup:23}],43:[function(e,t,r){arguments[4][24][0].apply(r,arguments)},{dup:24}],44:[function(e,t,r){arguments[4][25][0].apply(r,arguments)},{dup:25}],45:[function(e,t,r){arguments[4][28][0].apply(r,arguments)},{dup:28}],46:[function(e,r,n){(function(t){var r=e("isarray"),a=e("./is-buffer");n.deconstructPacket=function(e){var t=[],n=e.data;function o(e){if(!e)return e;if(a(e)){var n={_placeholder:!0,num:t.length};return t.push(e),n}if(r(e)){for(var s=new Array(e.length),c=0;c<e.length;c++)s[c]=o(e[c]);return s}if("object"==i(e)&&!(e instanceof Date)){for(var d in s={},e)s[d]=o(e[d]);return s}return e}var s=e;return s.data=o(n),s.attachments=t.length,{packet:s,buffers:t}},n.reconstructPacket=function(e,t){function n(e){if(e&&e._placeholder)return t[e.num];if(r(e)){for(var a=0;a<e.length;a++)e[a]=n(e[a]);return e}if(e&&"object"==i(e)){for(var o in e)e[o]=n(e[o]);return e}return e}return e.data=n(e.data),e.attachments=void 0,e},n.removeBlobs=function(e,n){function o(e,d,u){if(!e)return e;if(t.Blob&&e instanceof Blob||t.File&&e instanceof File){s++;var l=new FileReader;l.onload=function(){u?u[d]=this.result:c=this.result,--s||n(c)},l.readAsArrayBuffer(e)}else if(r(e))for(var p=0;p<e.length;p++)o(e[p],p,e);else if(e&&"object"==i(e)&&!a(e))for(var f in e)o(e[f],f,e)}var s=0,c=e;o(c),s||n(c)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{})},{"./is-buffer":48,isarray:43}],47:[function(e,t,r){var n=e("debug")("socket.io-parser"),i=e("json3"),a=(e("isarray"),e("component-emitter")),o=e("./binary"),s=e("./is-buffer");function c(){}function d(e){var t="",a=!1;return t+=e.type,r.BINARY_EVENT!=e.type&&r.BINARY_ACK!=e.type||(t+=e.attachments,t+="-"),e.nsp&&"/"!=e.nsp&&(a=!0,t+=e.nsp),null!=e.id&&(a&&(t+=",",a=!1),t+=e.id),null!=e.data&&(a&&(t+=","),t+=i.stringify(e.data)),n("encoded %j as %s",e,t),t}function u(e,t){function r(e){var r=o.deconstructPacket(e),n=d(r.packet),i=r.buffers;i.unshift(n),t(i)}o.removeBlobs(e,r)}function l(){this.reconstructor=null}function p(e){var t={},a=0;if(t.type=Number(e.charAt(0)),null==r.types[t.type])return h();if(r.BINARY_EVENT==t.type||r.BINARY_ACK==t.type){for(var o="";"-"!=e.charAt(++a)&&(o+=e.charAt(a),a!=e.length););if(o!=Number(o)||"-"!=e.charAt(a))throw new Error("Illegal attachments");t.attachments=Number(o)}if("/"==e.charAt(a+1))for(t.nsp="";++a&&","!=(c=e.charAt(a))&&(t.nsp+=c,a!=e.length););else t.nsp="/";var s=e.charAt(a+1);if(""!==s&&Number(s)==s){for(t.id="";++a;){var c;if(null==(c=e.charAt(a))||Number(c)!=c){--a;break}if(t.id+=e.charAt(a),a==e.length)break}t.id=Number(t.id)}if(e.charAt(++a))try{t.data=i.parse(e.substr(a))}catch(e){return h()}return n("decoded %s as %j",e,t),t}function f(e){this.reconPack=e,this.buffers=[]}function h(e){return{type:r.ERROR,data:"parser error"}}r.protocol=4,r.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],r.CONNECT=0,r.DISCONNECT=1,r.EVENT=2,r.ACK=3,r.ERROR=4,r.BINARY_EVENT=5,r.BINARY_ACK=6,r.Encoder=c,r.Decoder=l,c.prototype.encode=function(e,t){n("encoding packet %j",e),r.BINARY_EVENT==e.type||r.BINARY_ACK==e.type?u(e,t):t([d(e)])},a(l.prototype),l.prototype.add=function(e){var t;if("string"==typeof e)t=p(e),r.BINARY_EVENT==t.type||r.BINARY_ACK==t.type?(this.reconstructor=new f(t),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!s(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",t))}},l.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},f.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length==this.reconPack.attachments){var t=o.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},f.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":46,"./is-buffer":48,"component-emitter":49,debug:39,isarray:43,json3:50}],48:[function(e,r,n){(function(e){function t(t){return e.Buffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer}r.exports=t}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{})},{}],49:[function(e,t,r){arguments[4][15][0].apply(r,arguments)},{dup:15}],50:[function(r,n,a){(function(t){(function(){var r="function"==typeof e,o={function:!0,object:!0},s=o[i(a)]&&a&&!a.nodeType&&a,c=o["undefined"==typeof window?"undefined":i(window)]&&window||this,d=s&&o[i(n)]&&n&&!n.nodeType&&"object"==i(t)&&t;function u(e,t){e||(e=c.Object()),t||(t=c.Object());var r=e.Number||c.Number,n=e.String||c.String,a=e.Object||c.Object,s=e.Date||c.Date,d=e.SyntaxError||c.SyntaxError,l=e.TypeError||c.TypeError,p=e.Math||c.Math,f=e.JSON||c.JSON;"object"==i(f)&&f&&(t.stringify=f.stringify,t.parse=f.parse);var h,m,v,g=a.prototype,y=g.toString,b=new s(-0xc782b5b800cec);try{b=-109252==b.getUTCFullYear()&&0===b.getUTCMonth()&&1===b.getUTCDate()&&10==b.getUTCHours()&&37==b.getUTCMinutes()&&6==b.getUTCSeconds()&&708==b.getUTCMilliseconds()}catch(e){}function _(e){if(_[e]!==v)return _[e];var i;if("bug-string-char-index"==e)i="a"!="a"[0];else if("json"==e)i=_("json-stringify")&&_("json-parse");else{var a,o='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var c=t.stringify,d="function"==typeof c&&b;if(d){(a=function(){return 1}).toJSON=a;try{d="0"===c(0)&&"0"===c(new r)&&'""'==c(new n)&&c(y)===v&&c(v)===v&&c()===v&&"1"===c(a)&&"[1]"==c([a])&&"[null]"==c([v])&&"null"==c(null)&&"[null,null,null]"==c([v,y,null])&&c({a:[a,!0,!1,null,"\0\b\n\f\r\t"]})==o&&"1"===c(null,a)&&"[\n 1,\n 2\n]"==c([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==c(new s(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==c(new s(864e13))&&'"-000001-01-01T00:00:00.000Z"'==c(new s(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==c(new s(-1))}catch(e){d=!1}}i=d}if("json-parse"==e){var u=t.parse;if("function"==typeof u)try{if(0===u("0")&&!u(!1)){var l=5==(a=u(o)).a.length&&1===a.a[0];if(l){try{l=!u('"\t"')}catch(e){}if(l)try{l=1!==u("01")}catch(e){}if(l)try{l=1!==u("1.")}catch(e){}}}}catch(e){l=!1}i=l}}return _[e]=!!i}if(!_("json")){var S="[object Function]",w="[object Date]",k="[object Number]",C="[object String]",A="[object Array]",E="[object Boolean]",R=_("bug-string-char-index");if(!b)var T=p.floor,I=[0,31,59,90,120,151,181,212,243,273,304,334],x=function(e,t){return I[t]+365*(e-1970)+T((e-1969+(t=+(t>1)))/4)-T((e-1901+t)/100)+T((e-1601+t)/400)};if((h=g.hasOwnProperty)||(h=function(e){var t,r={};return(r.__proto__=null,r.__proto__={toString:1},r).toString!=y?h=function(e){var t=this.__proto__,r=e in(this.__proto__=null,this);return this.__proto__=t,r}:(t=r.constructor,h=function(e){var r=(this.constructor||t).prototype;return e in this&&!(e in r&&this[e]===r[e])}),r=null,h.call(this,e)}),m=function(e,t){var r,n,a,s=0;for(a in(r=function(){this.valueOf=0}).prototype.valueOf=0,n=new r)h.call(n,a)&&s++;return r=n=null,s?m=2==s?function(e,t){var r,n={},i=y.call(e)==S;for(r in e)i&&"prototype"==r||h.call(n,r)||!(n[r]=1)||!h.call(e,r)||t(r)}:function(e,t){var r,n,i=y.call(e)==S;for(r in e)i&&"prototype"==r||!h.call(e,r)||(n="constructor"===r)||t(r);(n||h.call(e,r="constructor"))&&t(r)}:(n=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],m=function(e,t){var r,a,s=y.call(e)==S,c=!s&&"function"!=typeof e.constructor&&o[i(e.hasOwnProperty)]&&e.hasOwnProperty||h;for(r in e)s&&"prototype"==r||!c.call(e,r)||t(r);for(a=n.length;r=n[--a];c.call(e,r)&&t(r));}),m(e,t)},!_("json-stringify")){var P={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},O="000000",D=function(e,t){return(O+(t||0)).slice(-e)},M="\\u00",B=function(e){for(var t='"',r=0,n=e.length,i=!R||n>10,a=i&&(R?e.split(""):e);r<n;r++){var o=e.charCodeAt(r);switch(o){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=P[o];break;default:if(o<32){t+=M+D(2,o.toString(16));break}t+=i?a[r]:e.charAt(r)}}return t+'"'},L=function e(t,r,n,a,o,s,c){var d,u,p,f,g,b,_,S,R,I,P,O,M,L,N,j;try{d=r[t]}catch(e){}if("object"==i(d)&&d)if((u=y.call(d))!=w||h.call(d,"toJSON"))"function"==typeof d.toJSON&&(u!=k&&u!=C&&u!=A||h.call(d,"toJSON"))&&(d=d.toJSON(t));else if(d>-1/0&&d<1/0){if(x){for(g=T(d/864e5),p=T(g/365.2425)+1970-1;x(p+1,0)<=g;p++);for(f=T((g-x(p,0))/30.42);x(p,f+1)<=g;f++);g=1+g-x(p,f),_=T((b=(d%864e5+864e5)%864e5)/36e5)%24,S=T(b/6e4)%60,R=T(b/1e3)%60,I=b%1e3}else p=d.getUTCFullYear(),f=d.getUTCMonth(),g=d.getUTCDate(),_=d.getUTCHours(),S=d.getUTCMinutes(),R=d.getUTCSeconds(),I=d.getUTCMilliseconds();d=(p<=0||p>=1e4?(p<0?"-":"+")+D(6,p<0?-p:p):D(4,p))+"-"+D(2,f+1)+"-"+D(2,g)+"T"+D(2,_)+":"+D(2,S)+":"+D(2,R)+"."+D(3,I)+"Z"}else d=null;if(n&&(d=n.call(r,t,d)),null===d)return"null";if((u=y.call(d))==E)return""+d;if(u==k)return d>-1/0&&d<1/0?""+d:"null";if(u==C)return B(""+d);if("object"==i(d)){for(L=c.length;L--;)if(c[L]===d)throw l();if(c.push(d),P=[],N=s,s+=o,u==A){for(M=0,L=d.length;M<L;M++)O=e(M,d,n,a,o,s,c),P.push(O===v?"null":O);j=P.length?o?"[\n"+s+P.join(",\n"+s)+"\n"+N+"]":"["+P.join(",")+"]":"[]"}else m(a||d,(function(t){var r=e(t,d,n,a,o,s,c);r!==v&&P.push(B(t)+":"+(o?" ":"")+r)})),j=P.length?o?"{\n"+s+P.join(",\n"+s)+"\n"+N+"}":"{"+P.join(",")+"}":"{}";return c.pop(),j}};t.stringify=function(e,t,r){var n,a,s,c;if(o[i(t)]&&t)if((c=y.call(t))==S)a=t;else if(c==A){s={};for(var d,u=0,l=t.length;u<l;d=t[u++],((c=y.call(d))==C||c==k)&&(s[d]=1));}if(r)if((c=y.call(r))==k){if((r-=r%1)>0)for(n="",r>10&&(r=10);n.length<r;n+=" ");}else c==C&&(n=r.length<=10?r:r.slice(0,10));return L("",((d={})[""]=e,d),a,s,n,"",[])}}if(!_("json-parse")){var N,j,F=n.fromCharCode,U={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},V=function(){throw N=j=null,d()},z=function(){for(var e,t,r,n,i,a=j,o=a.length;N<o;)switch(i=a.charCodeAt(N)){case 9:case 10:case 13:case 32:N++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=R?a.charAt(N):a[N],N++,e;case 34:for(e="@",N++;N<o;)if((i=a.charCodeAt(N))<32)V();else if(92==i)switch(i=a.charCodeAt(++N)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=U[i],N++;break;case 117:for(t=++N,r=N+4;N<r;N++)(i=a.charCodeAt(N))>=48&&i<=57||i>=97&&i<=102||i>=65&&i<=70||V();e+=F("0x"+a.slice(t,N));break;default:V()}else{if(34==i)break;for(i=a.charCodeAt(N),t=N;i>=32&&92!=i&&34!=i;)i=a.charCodeAt(++N);e+=a.slice(t,N)}if(34==a.charCodeAt(N))return N++,e;V();default:if(t=N,45==i&&(n=!0,i=a.charCodeAt(++N)),i>=48&&i<=57){for(48==i&&(i=a.charCodeAt(N+1))>=48&&i<=57&&V(),n=!1;N<o&&(i=a.charCodeAt(N))>=48&&i<=57;N++);if(46==a.charCodeAt(N)){for(r=++N;r<o&&(i=a.charCodeAt(r))>=48&&i<=57;r++);r==N&&V(),N=r}if(101==(i=a.charCodeAt(N))||69==i){for(43!=(i=a.charCodeAt(++N))&&45!=i||N++,r=N;r<o&&(i=a.charCodeAt(r))>=48&&i<=57;r++);r==N&&V(),N=r}return+a.slice(t,N)}if(n&&V(),"true"==a.slice(N,N+4))return N+=4,!0;if("false"==a.slice(N,N+5))return N+=5,!1;if("null"==a.slice(N,N+4))return N+=4,null;V()}return"$"},G=function e(t){var r,n;if("$"==t&&V(),"string"==typeof t){if("@"==(R?t.charAt(0):t[0]))return t.slice(1);if("["==t){for(r=[];"]"!=(t=z());n||(n=!0))n&&(","==t?"]"==(t=z())&&V():V()),","==t&&V(),r.push(e(t));return r}if("{"==t){for(r={};"}"!=(t=z());n||(n=!0))n&&(","==t?"}"==(t=z())&&V():V()),","!=t&&"string"==typeof t&&"@"==(R?t.charAt(0):t[0])&&":"==z()||V(),r[t.slice(1)]=e(z());return r}V()}return t},W=function(e,t,r){var n=H(e,t,r);n===v?delete e[t]:e[t]=n},H=function(e,t,r){var n,a=e[t];if("object"==i(a)&&a)if(y.call(a)==A)for(n=a.length;n--;)W(a,n,r);else m(a,(function(e){W(a,e,r)}));return r.call(e,t,a)};t.parse=function(e,t){var r,n;return N=0,j=""+e,r=G(z()),"$"!=z()&&V(),N=j=null,t&&y.call(t)==S?H(((n={})[""]=r,n),"",t):r}}}return t.runInContext=u,t}if(!d||d.global!==d&&d.window!==d&&d.self!==d||(c=d),s&&!r)u(c,s);else{var l=c.JSON,p=c.JSON3,f=!1,h=u(c,c.JSON3={noConflict:function(){return f||(f=!0,c.JSON=l,c.JSON3=p,l=p=null),h}});c.JSON={parse:h.parse,stringify:h.stringify}}}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{})},{}],51:[function(e,t,r){function n(e,t){for(var r=[],n=(t=t||0)||0;n<e.length;n++)r[n-t]=e[n];return r}t.exports=n},{}]},{},[31])(31)}()})),{CONNECTING:"CONNECTING",SUCCESS:"SUCCESS",FAILED:"FAILED",CLOSED:"CLOSED",IDLE:"IDLE"}),Ia={DISCONNECTED:"DISCONNECTED",CONNECTING:"CONNECTING",CONNECTED:"CONNECTED"},xa={COMMITING:"COMMITED",FINISHED:"FINISHED"},Pa=Object.freeze({__proto__:null,STREAM_STATE:Ta,ROOM_STATE:Ia,WEBSOCKET_STATE:{DISCONNECTED:"DISCONNECTED",CONNECTED:"CONNECTED",CONNECTING:"CONNECTING"},ACTION_STATE:xa,DATA_CHANNEL_STATE:{CONNECTING:"CONNECTING",OPEN:"OPEN",CLOSE:"CLOSE",IDLE:"IDLE"},DC_MESSAGE_FUNCTION_TYPE:{MESSAGE_FUNCTION_P2P:0,MESSAGE_FUNCTION_SIGNAL:1},DC_MESSAGE_DIRECTION:{MESSAGE_DIRECTION_SEND:0,MESSAGE_DIRECTION_FEEDBACK:1,MESSAGE_DIRECTION_ACK:2},DC_MESSAGE_CODE:{MESSAGE_SUCCESS:0,MESSAGE_ERROR_TIMEOUT:-1,MESSAGE_ERROR_BROKEN:-2,MESSAGE_ERROR_NO_RECEIVER:-3,MESSAGE_ERROR_NOT_JOIN:-100,MESSAGE_ERROR_INIT:-101,MESSAGE_ERROR_NO_CONNECTION:-102,MESSAGE_ERROR_UNKNOWN:-1e3}}),Oa={},Da="/decision/v1/multi",Ma="/oner_config/v1/multi",Ba="/oner_config/v1/multi",La="/fusion/get_rtc_service",Na="/video/v1/webrtc_log/",ja=["https://rtc.bytedance.com/decision/v1/multi","https://rtcg.bytevcloud.com/decision/v1/multi"],Fa=["https://rtc.bytedance.com/oner_config/v1/multi","https://rtc.bytevcloud.com/oner_config/v1/multi"],Ua=["https://rtc.bytedance.com/oner_config/v1/multi","https://rtc.bytevcloud.com/oner_config/v1/multi"],Va=["https://rtc.bytedance.com/fusion/get_rtc_service","https://rtc.bytevcloud.com/fusion/get_rtc_service"],za="https://log.snssdk.com/video/v1/webrtc_log/";Object.defineProperty(Oa,"configServerUrls",{get:function(){return ja}}),Object.defineProperty(Oa,"onerConfigServerUrls",{get:function(){return Fa}}),Object.defineProperty(Oa,"configServerHost",{set:function(e){0!==e.length&&("string"==typeof e?(ja=["https://".concat(e).concat(Da)],Fa=["https://".concat(e).concat(Ma)],Ua=["https://".concat(e).concat(Ba)],Va=["https://".concat(e).concat(La)]):Array.isArray(e)&&(ja=e.map((function(e){return"https://".concat(e).concat(Da)})),Fa=e.map((function(e){return"https://".concat(e).concat(Ma)})),Ua=e.map((function(e){return"https://".concat(e).concat(Ba)})),Va=e.map((function(e){return"https://".concat(e).concat(La)}))))}}),Object.defineProperty(Oa,"ntpServerUrls",{get:function(){return Ua}}),Object.defineProperty(Oa,"shortConnectionUrls",{get:function(){return Rr("shortConnectionUrls")||Va}}),Object.defineProperty(Oa,"shortConnectionHost",{set:function(e){if(0!==e.length){var t=[];"string"==typeof e?t=["https://".concat(e).concat(La)]:Array.isArray(e)&&(t=e.map((function(e){return"https://".concat(e).concat(La)}))),Ar("shortConnectionUrls",t)}}}),Object.defineProperty(Oa,"logServerUrl",{get:function(){return za}}),Object.defineProperty(Oa,"logServerHost",{set:function(e){0!==e.length&&("string"==typeof e?za="https://".concat(e).concat(Na):Array.isArray(e)&&(za=e.map((function(e){return"https://".concat(e).concat(Na)}))))}}),Oa.signalServer="http://127.0.0.1:8081",Oa.version="3.21.0",Oa.global={compressReport:!0};var Ga,Wa="live",Ha="cloud_game",qa=2,Ja=4,Za={speech_low_quality:[16e3,void 0,void 0],speech_standard:[32e3,void 0,18e3],music_standard:[48e3,void 0,void 0],standard_stereo:[48e3,1,void 0],high_quality:[48e3,void 0,128e3],high_quality_stereo:[48e3,1,192e3]},Ka={"120P":["160x120",15,65],"120P_1":["160x120",15,65],"120P_3":["120x120",15,50],"180P":["320x180",15,140],"180P_1":["320X180",15,140],"180P_3":["180x180",15,100],"180P_4":["240x180",15,120],"240P":["320x240",15,200],"240P_1":["320X240",15,200],"240P_3":["240x240",15,140],"240P_4":["424x240",15,220],"360P":["640x360",15,400],"360P_1":["640x360",15,400],"360P_3":["360x360",15,260],"360P_4":["640x360",30,600],"360P_6":["360x360",30,400],"360P_7":["480x360",15,320],"360P_8":["480x360",30,490],"360P_9":["640x360",15,800],"360P_10":["640x360",24,800],"360P_11":["640x360",24,1e3],"480P":["640x480",15,500],"480P_1":["640x480",15,500],"480P_2":["640x480",30,1e3],"480P_3":["480x480",15,400],"480P_4":["640x480",30,750],"480P_6":["480x480",30,600],"480P_8":["848x480",15,610],"480P_9":["848x480",30,930],"480P_10":["640x480",10,400],"720P":["1280x720",15,1130],"720P_1":["1280x720",15,1130],"720P_2":["1280x720",15,2080],"720P_3":["1280x720",30,1710],"720P_5":["960x720",15,910],"720P_6":["960x720",30,1380],"1080P":["1920x1080",15,2080],"1080P_1":["1920x1080",15,2080],"1080P_2":["1920x1080",30,3e3],"1080P_3":["1920x1080",30,3150],"1080P_5":["1920x1080",60,4780],"1440P":["2560x1440",30,4850],"1440P_1":["2560x1440",30,4850],"1440P_2":["2560x1440",60,7350],"4K":["3840x2160",30,8910],"4K_1":["3840x2160",30,8910],"4K_3":["3840x2160",60,13500]},Qa="function"==typeof atob,Ya="function"==typeof btoa,Xa="function"==typeof Buffer,$a=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder&&new TextEncoder,$e("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=")),eo=(Ga={},$a.forEach((function(e,t){return Ga[e]=t})),Ga),to=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,ro=String.fromCharCode.bind(String),no="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e};return new Uint8Array(Array.prototype.slice.call(e,0).map(t))},io=function(e){return e.replace(/[+\/]/g,(function(e){return"+"==e?"-":"_"})).replace(/=+$/m,"")},ao=function(e){return e.replace(/[^A-Za-z0-9\+\/]/g,"")},oo=function(e){for(var t,r,n,i,a="",o=e.length%3,s=0;s<e.length;){if((r=e.charCodeAt(s++))>255||(n=e.charCodeAt(s++))>255||(i=e.charCodeAt(s++))>255)throw new TypeError("invalid character found");a+=$a[(t=r<<16|n<<8|i)>>18&63]+$a[t>>12&63]+$a[t>>6&63]+$a[63&t]}return o?a.slice(0,o-3)+"===".substring(o):a},so=Ya?function(e){return btoa(e)}:Xa?function(e){return Buffer.from(e,"binary").toString("base64")}:oo,co=Xa?function(e){return Buffer.from(e).toString("base64")}:function(e){for(var t=[],r=0,n=e.length;r<n;r+=4096)t.push(ro.apply(null,e.subarray(r,r+4096)));return so(t.join(""))},uo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?io(co(e)):co(e)},lo=function(e){if(e=e.replace(/\s+/g,""),!to.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));for(var t,r,n,i="",a=0;a<e.length;)t=eo[e.charAt(a++)]<<18|eo[e.charAt(a++)]<<12|(r=eo[e.charAt(a++)])<<6|(n=eo[e.charAt(a++)]),i+=64===r?ro(t>>16&255):64===n?ro(t>>16&255,t>>8&255):ro(t>>16&255,t>>8&255,255&t);return i},po=Qa?function(e){return atob(ao(e))}:Xa?function(e){return Buffer.from(e,"base64").toString("binary")}:lo,fo=Xa?function(e){return no(Buffer.from(e,"base64"))}:function(e){return no(po(e),(function(e){return e.charCodeAt(0)}))},ho=function(e){return fo(mo(e))},mo=function(e){return ao(e.replace(/[-_]/g,(function(e){return"-"==e?"+":"/"})))},vo=uo,go=ho;function yo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function bo(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?yo(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yo(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var _o=function(){function e(t,r,n,i,a){Ce(this,e),this._pc=t,this._options=r,this._minitor=n,this._iceConfig=i,this._iceFeedback=a,this._offerAndAnswerICEOptions={offer:{},answer:{}}}var t,r,n,i;return Ee(e,[{key:"connect",value:(i=ve(ge.mark((function e(){var t;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._iceConfig){e.next=3;break}return e.next=3,this._getICEConfigFromServer();case 3:return e.next=5,this._createOffer();case 5:return t=e.sent,e.next=8,this._createAnswer(t);case 8:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_getICEConfigFromServer",value:(n=ve(ge.mark((function e(){var t,r,n,i,a,o;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={appID:this._options.appId,roomID:this._options.roomId,userID:this._options.userId,deviceID:this._options.deviceId,connectSessionID:xr(),os:"web",sdkVersion:this._options.sdkVersion,role:this._options.role,expectedAddr:this._options.expectedAddr},Array.isArray(this._iceFeedback)&&(t.feedbackInfo=this._iceFeedback,delete t.expectedAddr),r=["https://rtc-access.bytedance.com/dispatch/v1/AccessInfo?Action=GetAccessInfo","https://rtc-access2-hl.bytedance.com/dispatch/v1/AccessInfo?Action=GetAccessInfo"],(n=this._options.iceUrl)?"string"==typeof n?n=[n]:Array.isArray(n)||(n=r):n=r,this._minitor.eventLog("rtc_get_access",{message:JSON.stringify(t),type:"request",host:n.join(",")}),e.prev=6,i=n.map((function(e){return br(e,t)})),e.next=10,Promise.race(i);case 10:if(a=e.sent,this._minitor.eventLog("rtc_get_access",{message:JSON.stringify(a),type:"response"}),200===a.code){e.next=15;break}throw new tr("获取服务器节点报错",tr.JOIN_ROOM_ERROR);case 15:if(o=a.nodes[0]){e.next=19;break}throw new tr("获取服务器节点为空",tr.JOIN_ROOM_ERROR);case 19:this._iceConfig=o,e.next=25;break;case 22:throw e.prev=22,e.t0=e.catch(6),new tr(e.t0.message,tr.JOIN_ROOM_ERROR);case 25:case"end":return e.stop()}}),e,this,[[6,22]])}))),function(){return n.apply(this,arguments)})},{key:"_createOffer",value:(r=ve(ge.mark((function e(){var t,r,n;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._iceConfig.iceParams,e.next=3,this._pc.createOffer();case 3:return r=e.sent,(n=Be.parse(r.sdp)).media&&n.media.forEach((function(e){e.direction="sendrecv",e.iceUfrag=t.clientIceUfrag,e.icePwd=t.clientIcePwd,e.iceOptions="renomination"})),this._offerAndAnswerICEOptions.offer={iceUfrag:t.clientIceUfrag,icePwd:t.clientIcePwd,iceOptions:"renomination"},r.sdp=Be.write(n),et.debug("【EstablishConnection _createOffer: 】\n",{sdp:r.sdp}),e.prev=9,e.next=12,this._pc.setLocalDescription(r);case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(9),new tr(e.t0.message,tr.INVALID_SDP);case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}}),e,this,[[9,14]])}))),function(){return r.apply(this,arguments)})},{key:"_createAnswer",value:(t=ve(ge.mark((function e(t){var r,n,i,a,o,s,c,d,u,l;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._iceConfig,n=r.publicIPs,i=r.certFingerprint,a=r.iceParams,r.iceConfig,r.msgKey,o=bo({},t),s=[],Array.isArray(n)&&(c=0,d=2130706431,n.forEach((function(e){et.debug("【publicIp: 】",e.ip);var t={component:1,ip:e.ip,type:"host",generation:e.generation};e.udpPorts&&e.udpPorts.forEach((function(e){s.push(bo(bo({},t),{},{foundation:c++,transport:"udp",port:e,priority:d}))})),e.tcpPorts&&e.tcpPorts.forEach((function(e){s.push(bo(bo({},t),{},{foundation:c++,transport:"tcp",port:e,tcptype:"active",priority:2130705431}))}))}))),u=this._getServerUfrag(a.serverIceUfrag),this._minitor.setConnectionId(u),o.media&&o.media.forEach((function(e){e.fingerprint||(e.fingerprint={type:"sha-256"}),e.fingerprint.hash=i,e.iceUfrag=u,e.icePwd=a.serverIcePwd,e.setup="active",e.candidates=s,e.iceOptions="renomination","application"===e.type&&(e.sctpmap={sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144})})),this._offerAndAnswerICEOptions.answer={fingerprint:{type:"sha-256",hash:i},iceUfrag:u,icePwd:a.serverIcePwd,setup:"active",candidates:s,iceOptions:"renomination"},l=new RTCSessionDescription({type:"answer",sdp:Be.write(o)}),et.debug("【EstablishConnection _createAnswer: 】\n",{sdp:l.sdp}),e.prev=10,e.next=13,this._pc.setRemoteDescription(l);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(10),new tr(e.t0.message,tr.INVALID_SDP);case 18:case"end":return e.stop()}}),e,this,[[10,15]])}))),function(e){return t.apply(this,arguments)})},{key:"_concatenate",value:function(e){for(var t=0,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=0,o=n;a<o.length;a++){var s=o[a];t+=s.length}for(var c=new e(t),d=0,u=0,l=n;u<l.length;u++){var p=l[u];c.set(p,d),d+=p.length}return c}},{key:"_getServerUfrag",value:function(e){var t=new TextEncoder,r=t.encode("PREC"),n=go(e),i=t.encode(Date.now()).slice(0,4),a=new Uint8Array(4);a[0]=0,a[1]=1,a[2]=1,a[3]=1;var o=this._concatenate(Uint8Array,r,n,i,a);return vo(o)}},{key:"offerAndAnswerICEOptions",get:function(){return this._offerAndAnswerICEOptions}},{key:"iceConfig",get:function(){return this._iceConfig}}]),e}(),So="audio_mixing_failure",wo={MESSAGE_DIRECTION_SEND:0,MESSAGE_DIRECTION_FEEDBACK:1},ko=0,Co=0;function Ao(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Eo(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?Ao(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ao(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ro(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Qt(e);if(t){var i=Qt(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Kt(this,r)}}var To="idle",Io="connected",xo="closed",Po=function(e){Jt(i,e);var t,r,n=Ro(i);function i(e,t){var r;return Ce(this,i),(r=n.call(this))._dataChannel=e,r._dataChannelState=Io,r._monitor=t,r._messageTypeCache=new Map,r._rttIds={},r._handleDataChannel(),r._resolveCallbacks=new Map,r._rejectCallbacks=new Map,r._timer={},r._p2pResolveCallbacks=new Map,r._p2pRejectCallbacks=new Map,r}return Ee(i,[{key:"destroy",value:function(){this._dataChannel&&(this._dataChannelState===Io&&this._dataChannel.close(),this._dataChannel=null),this._dataChannelState=To,this._messageTypeCache=new Map,this._resolveCallbacks=new Map,this._rejectCallbacks=new Map,this._rttIds={};for(var e=0,t=Object.keys(this._timer);e<t.length;e++){var r=t[e];clearTimeout(this._timer[r])}this._timer={},this._p2pResolveCallbacks=new Map,this._p2pRejectCallbacks=new Map}},{key:"sendP2PMessage",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise((function(i,a){var o=[2,5],s=e.id;"__web__rtc__rtt__"===(null==e?void 0:e.msg)&&(t._rttIds[s]=s,n=!0),t._monitor.eventLog("rtc_signaling_msg",{direction:"send",signaling_event:"p2p",message:JSON.stringify(e)});var c=Pr();o=o.concat(c),r||(t._p2pResolveCallbacks.set(s,i),t._p2pRejectCallbacks.set(s,a),t._timer[s]=setTimeout((function(){a(new tr("调用超时",tr.TIMEOUT))}),2e4)),t._sendMessage(o,e,"p2p",n)}))}},{key:"sendSignaling",value:function(e,t){var r=this;return new Promise((function(n,i){var a=[2,1];r._monitor.eventLog("rtc_signaling_msg",{direction:"send",signaling_event:e,message:JSON.stringify(t)});var o=Pr();a=a.concat(o);var s=o.join("-");r._resolveCallbacks.set(s,n),r._rejectCallbacks.set(s,i),r._messageTypeCache.set(s,e),r._timer[s]=setTimeout((function(){i(new tr("调用超时",tr.TIMEOUT))}),1e4),r._sendMessage(a,t,e)}))}},{key:"_str2ab",value:function(e){return new Promise((function(t,r){var n=new Blob([e],{type:"text/plain"}),i=new FileReader;i.readAsArrayBuffer(n),i.onload=function(){t(i.result)}}))}},{key:"_ab2str",value:function(e){return new Promise((function(t,r){var n=new Blob([e]),i=new FileReader;i.readAsText(n,"utf-8"),i.onload=function(){t(i.result)}}))}},{key:"_concatenate",value:function(e){for(var t=0,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=0,o=n;a<o.length;a++){var s=o[a];t+=s.length}for(var c=new e(t),d=0,u=0,l=n;u<l.length;u++){var p=l[u];c.set(p,d),d+=p.length}return c}},{key:"_sendMessage",value:(r=ve(ge.mark((function e(t,r,n,i){var a,o;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i||et.debug("[DCSignaling >>>>] 信令名称：",n,"。请求体：",r),e.next=3,this._str2ab(JSON.stringify([n,r]));case 3:a=e.sent,o=this._concatenate(Uint8Array,t,new Uint8Array(a)),this._dataChannel.send(o.buffer);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"_handleDataChannel",value:function(){var e=this;if(!this._dataChannel)throw new Error("[DCSignaling] data channel不存在");this._dataChannel.onclose=function(){et.debug("close"),e._dataChannelState=xo},this._dataChannel.onerror=function(e){et.debug(e)},this._dataChannel.onmessage=function(t){et.debug("message",t.data),e._handleMessage(t.data)}}},{key:"_isByteId",value:function(e){return 128==(128&e)}},{key:"_dispartData",value:function(e){var t={messageType:0,compress:!1,direction:"ack"},r="",n=(new Uint8Array([]),new Uint8Array(e)),i=n[0],a=n[1],o=1&a;t.messageType=(60&a)>>2,t.compress=16==(16&i),t.direction=2==(2&a)?"ack":"send";var s=0;if(o||"ack"===t.direction){for(var c=2;c<=6;c++){var d=n[c];if(!this._isByteId(d)){s=c-2+1;break}}r=n.slice(2,2+s).join("-")}return{config:t,id:r,data:n.slice(2+s)}}},{key:"_feedbackMessage",value:function(e){var t,r="__web__rtc__rtt__"===(null===(t=e=Eo({},e))||void 0===t?void 0:t.msg);e.dir=wo.MESSAGE_DIRECTION_FEEDBACK,e.msg="",this.sendP2PMessage(e,!0,r)}},{key:"_handleFeedback",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id,r=this._p2pResolveCallbacks.get(t),n=this._p2pRejectCallbacks.get(t);switch(clearTimeout(this._timer[t]),this._p2pResolveCallbacks.delete(t),this._p2pRejectCallbacks.delete(t),e.err){case Co:"function"==typeof r&&r();break;default:"function"==typeof n&&n(e)}}},{key:"_handleMessage",value:(t=ve(ge.mark((function e(t){var r,n,i,a,o,s,c,d,u,l,p,f,h,m,v;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._dispartData(t),n=r.config,i=r.id,a=r.data,o=a,n.compress&&((s=new Bi.Inflate).push(o,!0),o=s.result),e.next=5,this._ab2str(o);case 5:c=e.sent,d=[],e.prev=7,d=JSON.parse(c),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(7),e.abrupt("return");case 14:if(u="p2p",0!==n.messageType){e.next=20;break}"ack"===n.direction?(l=this._resolveCallbacks.get(i),p=this._rejectCallbacks.get(i),f=d[0]||{},clearTimeout(this._timer[i]),this._resolveCallbacks.delete(i),this._rejectCallbacks.delete(i),200===(null==f?void 0:f.code)?"function"==typeof l&&l(f):"function"==typeof p&&p(f),(u=this._messageTypeCache.get(i))&&(this._monitor.eventLog("rtc_signaling_msg",{direction:"revc",signaling_evnet:"".concat(u,"-res"),message:JSON.stringify(d)}),this._messageTypeCache.delete(i))):Array.isArray(d)&&(u=d[0],d=d[1],this.emit(Eo(Eo({},d),{},{type:u})),this._monitor.eventLog("rtc_signaling_msg",{direction:"revc",signaling_evnet:u,message:JSON.stringify(d)})),et.debug("[DCSignaling <<<<] 信令名称：",u,"。响应体：",d),e.next=32;break;case 20:if(1!==n.messageType){e.next=32;break}Array.isArray(d)&&(u=d[0],d=d[1]),v=null===(h=d)||void 0===h?void 0:h.id,this._rttIds[v]||"__web__rtc__rtt__"===(null===(m=d)||void 0===m?void 0:m.msg)?delete this._rttIds[v]:et.debug("[DCSignaling <<<<] 信令名称：p2p。响应体：",d),e.t1=d.dir,e.next=e.t1===wo.MESSAGE_DIRECTION_SEND||e.t1===wo.MESSAGE_DIRECTION_ACK?27:e.t1===wo.MESSAGE_DIRECTION_FEEDBACK?30:32;break;case 27:return this.emit(Eo(Eo({},d),{},{type:"user-message-received"})),this._feedbackMessage(d),e.abrupt("break",32);case 30:return this._handleFeedback(d),e.abrupt("break",32);case 32:case"end":return e.stop()}}),e,this,[[7,11]])}))),function(e){return t.apply(this,arguments)})},{key:"dataChannelState",get:function(){return this.dataChannelState}}]),i}(ua),Oo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAQAAAD9CzEMAAAABGdBTUEAALGOfPtRkwAACidpQ0NQaWNjAAB42p2Wd1RU1xaHz713eqHNMAJSht67wADSe5NeRWGYGWAoAw4zNLEhogIRRUSaIkhQxIDRUCRWRLEQFFSwByQIKDEYRVQsb0bWi66svPfy8vvjrG/ts/e5++y9z1oXAJKnL5eXBksBkMoT8IM8nOkRkVF07ACAAR5ggCkATFZGul+wewgQycvNhZ4hcgJfBAHweli8AnDT0DOATgf/n6RZ6XyB6JgAEZuzORksEReIOCVLkC62z4qYGpcsZhglZr4oQRHLiTlhkQ0++yyyo5jZqTy2iMU5p7NT2WLuFfG2TCFHxIiviAszuZwsEd8SsUaKMJUr4jfi2FQOMwMAFElsF3BYiSI2ETGJHxLkIuLlAOBICV9x3Fcs4GQLxJdySUvP4XMTEgV0HZYu3dTamkH35GSlcAQCwwAmK5nJZ9Nd0lLTmbwcABbv/Fky4trSRUW2NLW2tDQ0MzL9qlD/dfNvStzbRXoZ+LlnEK3/i+2v/NIaAGDMiWqz84strgqAzi0AyN37YtM4AICkqG8d17+6D008L4kCQbqNsXFWVpYRl8MyEhf0D/1Ph7+hr75nJD7uj/LQXTnxTGGKgC6uGystJU3Ip2ekM1kcuuGfh/gfB/51HgZBnHgOn8MTRYSJpozLSxC1m8fmCrhpPDqX95+a+A/D/qTFuRaJ0vgRUGOMgNR1KkB+7QcoChEg0fvFXf+jb774MCB+eeEqk4tz/+83/WfBpeIlg5vwOc4lKITOEvIzF/fEzxKgAQFIAiqQB8pAHegAQ2AGrIAtcARuwBv4gxAQCVYDFkgEqYAPskAe2AQKQTHYCfaAalAHGkEzaAXHQSc4Bc6DS+AauAFug/tgFEyAZ2AWvAYLEARhITJEgeQhFUgT0ofMIAZkD7lBvlAQFAnFQgkQDxJCedBmqBgqg6qheqgZ+h46CZ2HrkCD0F1oDJqGfofewQhMgqmwEqwFG8MM2An2gUPgVXACvAbOhQvgHXAl3AAfhTvg8/A1+DY8Cj+D5xCAEBEaoooYIgzEBfFHopB4hI+sR4qQCqQBaUW6kT7kJjKKzCBvURgUBUVHGaJsUZ6oUBQLtQa1HlWCqkYdRnWgelE3UWOoWdRHNBmtiNZH26C90BHoBHQWuhBdgW5Ct6Mvom+jJ9CvMRgMDaONscJ4YiIxSZi1mBLMPkwb5hxmEDOOmcNisfJYfawd1h/LxAqwhdgq7FHsWewQdgL7BkfEqeDMcO64KBwPl4+rwB3BncEN4SZxC3gpvCbeBu+PZ+Nz8KX4Rnw3/jp+Ar9AkCZoE+wIIYQkwiZCJaGVcJHwgPCSSCSqEa2JgUQucSOxkniMeJk4RnxLkiHpkVxI0SQhaQfpEOkc6S7pJZlM1iI7kqPIAvIOcjP5AvkR+Y0ERcJIwkuCLbFBokaiQ2JI4rkkXlJT0klytWSuZIXkCcnrkjNSeCktKRcpptR6qRqpk1IjUnPSFGlTaX/pVOkS6SPSV6SnZLAyWjJuMmyZApmDMhdkxikIRZ3iQmFRNlMaKRcpE1QMVZvqRU2iFlO/ow5QZ2VlZJfJhslmy9bInpYdpSE0LZoXLYVWSjtOG6a9W6K0xGkJZ8n2Ja1LhpbMyy2Vc5TjyBXJtcndlnsnT5d3k0+W3yXfKf9QAaWgpxCokKWwX+GiwsxS6lLbpaylRUuPL72nCCvqKQYprlU8qNivOKekrOShlK5UpXRBaUaZpuyonKRcrnxGeVqFomKvwlUpVzmr8pQuS3eip9Ar6b30WVVFVU9VoWq96oDqgpq2Wqhavlqb2kN1gjpDPV69XL1HfVZDRcNPI0+jReOeJl6ToZmouVezT3NeS1srXGurVqfWlLactpd2rnaL9gMdso6DzhqdBp1buhhdhm6y7j7dG3qwnoVeol6N3nV9WN9Sn6u/T3/QAG1gbcAzaDAYMSQZOhlmGrYYjhnRjHyN8o06jZ4baxhHGe8y7jP+aGJhkmLSaHLfVMbU2zTftNv0dzM9M5ZZjdktc7K5u/kG8y7zF8v0l3GW7V92x4Ji4Wex1aLH4oOllSXfstVy2krDKtaq1mqEQWUEMEoYl63R1s7WG6xPWb+1sbQR2By3+c3W0DbZ9ojt1HLt5ZzljcvH7dTsmHb1dqP2dPtY+wP2ow6qDkyHBofHjuqObMcmx0knXackp6NOz51NnPnO7c7zLjYu61zOuSKuHq5FrgNuMm6hbtVuj9zV3BPcW9xnPSw81nqc80R7+nju8hzxUvJieTV7zXpbea/z7vUh+QT7VPs89tXz5ft2+8F+3n67/R6s0FzBW9HpD/y9/Hf7PwzQDlgT8GMgJjAgsCbwSZBpUF5QXzAlOCb4SPDrEOeQ0pD7oTqhwtCeMMmw6LDmsPlw1/Cy8NEI44h1EdciFSK5kV1R2KiwqKaouZVuK/esnIi2iC6MHl6lvSp71ZXVCqtTVp+OkYxhxpyIRceGxx6Jfc/0ZzYw5+K84mrjZlkurL2sZ2xHdjl7mmPHKeNMxtvFl8VPJdgl7E6YTnRIrEic4bpwq7kvkjyT6pLmk/2TDyV/SglPaUvFpcamnuTJ8JJ5vWnKadlpg+n66YXpo2ts1uxZM8v34TdlQBmrMroEVNHPVL9QR7hFOJZpn1mT+SYrLOtEtnQ2L7s/Ry9ne85krnvut2tRa1lre/JU8zblja1zWle/Hloft75ng/qGgg0TGz02Ht5E2JS86ad8k/yy/Febwzd3FygVbCwY3+KxpaVQopBfOLLVdmvdNtQ27raB7ebbq7Z/LGIXXS02Ka4ofl/CKrn6jek3ld982hG/Y6DUsnT/TsxO3s7hXQ67DpdJl+WWje/2291RTi8vKn+1J2bPlYplFXV7CXuFe0crfSu7qjSqdla9r06svl3jXNNWq1i7vXZ+H3vf0H7H/a11SnXFde8OcA/cqfeo72jQaqg4iDmYefBJY1hj37eMb5ubFJqKmz4c4h0aPRx0uLfZqrn5iOKR0ha4RdgyfTT66I3vXL/rajVsrW+jtRUfA8eEx55+H/v98HGf4z0nGCdaf9D8obad0l7UAXXkdMx2JnaOdkV2DZ70PtnTbdvd/qPRj4dOqZ6qOS17uvQM4UzBmU9nc8/OnUs/N3M+4fx4T0zP/QsRF271BvYOXPS5ePmS+6ULfU59Zy/bXT51xebKyauMq53XLK919Fv0t/9k8VP7gOVAx3Wr6103rG90Dy4fPDPkMHT+puvNS7e8bl27veL24HDo8J2R6JHRO+w7U3dT7r64l3lv4f7GB+gHRQ+lHlY8UnzU8LPuz22jlqOnx1zH+h8HP74/zhp/9kvGL+8nCp6Qn1RMqkw2T5lNnZp2n77xdOXTiWfpzxZmCn+V/rX2uc7zH35z/K1/NmJ24gX/xaffS17Kvzz0atmrnrmAuUevU18vzBe9kX9z+C3jbd+78HeTC1nvse8rP+h+6P7o8/HBp9RPn/4FA5jz/EHct2gAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAAJiS0dEAP+Hj8y/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAACXZwQWcAAAAwAAAAMADO7oxXAAAHsUlEQVRYw+1XfVSUVRp/ZgYGcPgc+TRNPgtRhDZELEhdPX62kZuSCGoqIIsalKUejazctW3LXE9ohoAppeDXKOdQIpsgioKCqwYKAwoCKSDDt8LAzNx+dwYExMMiq//1/s6ZM/e+931+z+e9zyX64/njGfARkJBEWgjx/xmIF5GBYJiliVBChqT3/1MI+ogQQOQwkoaPvfXRHj+yJGPSHzoF11UPAvTx2+0MERmRtb9XxUGNqi4z1I/sQDFEK4QQLCGzkFGBXIgYY06pT+bkkveNRqVhGk3J0fFeZANK0VDEG5AZ2cXPbkq7tg5CTCFaCF0l0Pml9etq76qZmnW2n/onudJwrBU8qWsMSWrgkBTWKmcsLxZCbCDaiEwcbPVdyJcC18c1tHYyFWuuWLeQRoP+CdykC6PlSNf06LYaNetg6T/QRHIgK7Ja7l62PT6M/kyL9D5I+KVN3QGKguPW3mQLcuHgxUvI2tszP6ajpZO1MyVLOUzTaCw5+k+8naRRN5SsiKAACnfaeqVMibf3m75aTc6IzKCyiQfWhGwX+5UcVimVrA1oZ8dkNJteJo/0rZ0d7ayTFZ13WkZLKTLqQIOyDRS/ppr50IiBbBB0QaQN7MiNr989o1K3sftaPGBHjtPrNIkmvRFSdOMBxu0diXtoEYVYRV8obsO4oXbVUthgBtsfU/J6SEADhNQIfjdB4TjsXNLwaycEtwCtwH12mBO8gtD+dfHXVY2tEFldPnUNBdPqTcmNKqzQpOwiT6TBI7mkyxUTiaXzKGd7R4fRTs5uQVPSt7RWdkB080O0sEMymkveNIHm0Krv0ps0zeyB+sfvYcOK8X8vruZqFOXYTEMuSfo6idekdL1X5S7FyXtptWk1p6ozmks64dUm1tgLTSyZx8CT3GBFoNfWopomkMoLng+hxcKoE7nNWFFdvWAJvYhA6/XWn9ek/YXPVRoV04HnTAtreASNLElGMyH+eRpDMyg8MZPP1jWHboYNYVuSFZoGplD+I5rGI5H1exMYoiY9/7OvkdU/hOIxqGcHZRD8IlnTc3BTQMjuO0oFa9B8t5cC6Z35/668j1WaxN1w4gjIFPQkpARe8z2SXMfuDYg6doATuJAFSUEz66WN12vrQJyWTotpiefHRff46CcZvQZ5w3oTGJMTTTtwtJbVDIha9qOOwAxfjCJfm/DsYk6c81/D5RRs90H+bT7KzDScCXkmPWEWYuBCMxJl1ezugKhmiToCUzjAhrzEwen5nDivSLqSgoZHZstrsCYrx/wv9AKUED1CsF92h/02IO6w/d0EBqgTD2HAyYucOEduFQGCNWeL7mLNmUsWbyIJzPsR7JNVscoBUcX2dROIsTG7mwacvsyJz9ww/hsFWa+5UMJH6TnG85BpFv0I9soq2O0BUcH29iFwC84rqQBxyiURXOT43uVKPjqWIfB/rAUJsnJWNiDKWUKPi6zIY8FqeX05ZnefpBUUNG1TgUI7kqHOXR+NgTNN332oR9Qt4GY/3GJx3QRGqJwJu7aXq24yeWdkAr1Di1Z9Vdp+k5Woo+NRjHyNsHcd2NNk/49PFp9XnFOcqz9bn9tc0FHKSllJH5SyPToCc3xubz394pkyzF2q89lCSygoLvkW1hQ8CNiKY8gRiSzsqWQjVJ43BdhtcN7mGOO40+Fbt7h5x/YUXFXKWXEvyFksJ3gB/rcit81RlY1yiDyYZ/AuBVusOJdfihVnq8ZEYrcdBZmCHgKxtjKn0AIKoVW0hqLoQ/rI8IuVqecab7DrD3GDfcsJXOGe0a5TCzPKMHelfVk8hVLg2xuL6/mK/dnCYOIHZ58NW4TCtoFmE2gyTYcHZ9ObFEQRgk2zE1N+u8auduEai5HRLBpHjgKPn7+uVl7DTFLh8A08AocOl2BFfmdEHL51h436/Q93KdcM3nMG1Tgc7rOww7w/Libu+iV1PuO4zHbwDPkTucdHKeoKMZPV4h9L4RQ0ObKo4grep1a5rOtKA1H/9kQMv0kQHBO8lmK/HEN+cNpq6y8+O5+lzGU5LJdt4weOD/ns+PRqYy47r4pOF63l+h9JkmtysOKTVIT7FRr5+FNZdxoLtdDjRxAaFG96g1Yabg5N/ak5m2WzL3VHpp9wfkRCWlPMZavNFEaBoZvKa3Lx9kS1x2fkDwdZ/u++ghOJYclInF+zaJlgw8wfDt7JYv/iLpoIzNEPm7PD6RNCBbuHFeYVskx2Wr02BQU3BWoZD66B5I2LMfJhLPI6iN7z2P7NxaidSAIP7DQ+sCQQswulwRknKtQZ7DSLLbbbSPOgkPXg20dd8K0QdF96i5ZLwozeRtPihPg4gOZVEM89ElurzGKn2KH6yTvRIb2GNyZP0gB39ab47GWImwGiMdr21xy/Djh7p3657Zemn9nxtqVHUUFzYa3lk7a/1BWNEUhfV2hvCw3FcJ4RNmR7miRcuPT7A4qoNPFamo86eg55KBra/WAY9kcLaC7R3g94EhjC2+40Vxzm/bnZ+7QQ1jlgzRBvObrOj99wuq97PD6mKExv5NVbSGZflJcU7hE+vTsav5hYgGIc4jMeO8Bw2CR8urdMTmGKLLOFs8wgXvT0r7LccbxhNtBeq57BTbmn4X8mwgf1/A4Bm4o+oeC48QAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAwOS0wOS0xM1QxNjoxMjo1OCswMjowMBbbrGkAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMDktMDktMTNUMTY6MTI6NTgrMDI6MDBnhhTVAAAAAElFTkSuQmCC",Do="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAQAAAD9CzEMAAAABGdBTUEAALGOfPtRkwAACidpQ0NQaWNjAAB42p2Wd1RU1xaHz713eqHNMAJSht67wADSe5NeRWGYGWAoAw4zNLEhogIRRUSaIkhQxIDRUCRWRLEQFFSwByQIKDEYRVQsb0bWi66svPfy8vvjrG/ts/e5++y9z1oXAJKnL5eXBksBkMoT8IM8nOkRkVF07ACAAR5ggCkATFZGul+wewgQycvNhZ4hcgJfBAHweli8AnDT0DOATgf/n6RZ6XyB6JgAEZuzORksEReIOCVLkC62z4qYGpcsZhglZr4oQRHLiTlhkQ0++yyyo5jZqTy2iMU5p7NT2WLuFfG2TCFHxIiviAszuZwsEd8SsUaKMJUr4jfi2FQOMwMAFElsF3BYiSI2ETGJHxLkIuLlAOBICV9x3Fcs4GQLxJdySUvP4XMTEgV0HZYu3dTamkH35GSlcAQCwwAmK5nJZ9Nd0lLTmbwcABbv/Fky4trSRUW2NLW2tDQ0MzL9qlD/dfNvStzbRXoZ+LlnEK3/i+2v/NIaAGDMiWqz84strgqAzi0AyN37YtM4AICkqG8d17+6D008L4kCQbqNsXFWVpYRl8MyEhf0D/1Ph7+hr75nJD7uj/LQXTnxTGGKgC6uGystJU3Ip2ekM1kcuuGfh/gfB/51HgZBnHgOn8MTRYSJpozLSxC1m8fmCrhpPDqX95+a+A/D/qTFuRaJ0vgRUGOMgNR1KkB+7QcoChEg0fvFXf+jb774MCB+eeEqk4tz/+83/WfBpeIlg5vwOc4lKITOEvIzF/fEzxKgAQFIAiqQB8pAHegAQ2AGrIAtcARuwBv4gxAQCVYDFkgEqYAPskAe2AQKQTHYCfaAalAHGkEzaAXHQSc4Bc6DS+AauAFug/tgFEyAZ2AWvAYLEARhITJEgeQhFUgT0ofMIAZkD7lBvlAQFAnFQgkQDxJCedBmqBgqg6qheqgZ+h46CZ2HrkCD0F1oDJqGfofewQhMgqmwEqwFG8MM2An2gUPgVXACvAbOhQvgHXAl3AAfhTvg8/A1+DY8Cj+D5xCAEBEaoooYIgzEBfFHopB4hI+sR4qQCqQBaUW6kT7kJjKKzCBvURgUBUVHGaJsUZ6oUBQLtQa1HlWCqkYdRnWgelE3UWOoWdRHNBmtiNZH26C90BHoBHQWuhBdgW5Ct6Mvom+jJ9CvMRgMDaONscJ4YiIxSZi1mBLMPkwb5hxmEDOOmcNisfJYfawd1h/LxAqwhdgq7FHsWewQdgL7BkfEqeDMcO64KBwPl4+rwB3BncEN4SZxC3gpvCbeBu+PZ+Nz8KX4Rnw3/jp+Ar9AkCZoE+wIIYQkwiZCJaGVcJHwgPCSSCSqEa2JgUQucSOxkniMeJk4RnxLkiHpkVxI0SQhaQfpEOkc6S7pJZlM1iI7kqPIAvIOcjP5AvkR+Y0ERcJIwkuCLbFBokaiQ2JI4rkkXlJT0klytWSuZIXkCcnrkjNSeCktKRcpptR6qRqpk1IjUnPSFGlTaX/pVOkS6SPSV6SnZLAyWjJuMmyZApmDMhdkxikIRZ3iQmFRNlMaKRcpE1QMVZvqRU2iFlO/ow5QZ2VlZJfJhslmy9bInpYdpSE0LZoXLYVWSjtOG6a9W6K0xGkJZ8n2Ja1LhpbMyy2Vc5TjyBXJtcndlnsnT5d3k0+W3yXfKf9QAaWgpxCokKWwX+GiwsxS6lLbpaylRUuPL72nCCvqKQYprlU8qNivOKekrOShlK5UpXRBaUaZpuyonKRcrnxGeVqFomKvwlUpVzmr8pQuS3eip9Ar6b30WVVFVU9VoWq96oDqgpq2Wqhavlqb2kN1gjpDPV69XL1HfVZDRcNPI0+jReOeJl6ToZmouVezT3NeS1srXGurVqfWlLactpd2rnaL9gMdso6DzhqdBp1buhhdhm6y7j7dG3qwnoVeol6N3nV9WN9Sn6u/T3/QAG1gbcAzaDAYMSQZOhlmGrYYjhnRjHyN8o06jZ4baxhHGe8y7jP+aGJhkmLSaHLfVMbU2zTftNv0dzM9M5ZZjdktc7K5u/kG8y7zF8v0l3GW7V92x4Ji4Wex1aLH4oOllSXfstVy2krDKtaq1mqEQWUEMEoYl63R1s7WG6xPWb+1sbQR2By3+c3W0DbZ9ojt1HLt5ZzljcvH7dTsmHb1dqP2dPtY+wP2ow6qDkyHBofHjuqObMcmx0knXackp6NOz51NnPnO7c7zLjYu61zOuSKuHq5FrgNuMm6hbtVuj9zV3BPcW9xnPSw81nqc80R7+nju8hzxUvJieTV7zXpbea/z7vUh+QT7VPs89tXz5ft2+8F+3n67/R6s0FzBW9HpD/y9/Hf7PwzQDlgT8GMgJjAgsCbwSZBpUF5QXzAlOCb4SPDrEOeQ0pD7oTqhwtCeMMmw6LDmsPlw1/Cy8NEI44h1EdciFSK5kV1R2KiwqKaouZVuK/esnIi2iC6MHl6lvSp71ZXVCqtTVp+OkYxhxpyIRceGxx6Jfc/0ZzYw5+K84mrjZlkurL2sZ2xHdjl7mmPHKeNMxtvFl8VPJdgl7E6YTnRIrEic4bpwq7kvkjyT6pLmk/2TDyV/SglPaUvFpcamnuTJ8JJ5vWnKadlpg+n66YXpo2ts1uxZM8v34TdlQBmrMroEVNHPVL9QR7hFOJZpn1mT+SYrLOtEtnQ2L7s/Ry9ne85krnvut2tRa1lre/JU8zblja1zWle/Hloft75ng/qGgg0TGz02Ht5E2JS86ad8k/yy/Febwzd3FygVbCwY3+KxpaVQopBfOLLVdmvdNtQ27raB7ebbq7Z/LGIXXS02Ka4ofl/CKrn6jek3ld982hG/Y6DUsnT/TsxO3s7hXQ67DpdJl+WWje/2291RTi8vKn+1J2bPlYplFXV7CXuFe0crfSu7qjSqdla9r06svl3jXNNWq1i7vXZ+H3vf0H7H/a11SnXFde8OcA/cqfeo72jQaqg4iDmYefBJY1hj37eMb5ubFJqKmz4c4h0aPRx0uLfZqrn5iOKR0ha4RdgyfTT66I3vXL/rajVsrW+jtRUfA8eEx55+H/v98HGf4z0nGCdaf9D8obad0l7UAXXkdMx2JnaOdkV2DZ70PtnTbdvd/qPRj4dOqZ6qOS17uvQM4UzBmU9nc8/OnUs/N3M+4fx4T0zP/QsRF271BvYOXPS5ePmS+6ULfU59Zy/bXT51xebKyauMq53XLK919Fv0t/9k8VP7gOVAx3Wr6103rG90Dy4fPDPkMHT+puvNS7e8bl27veL24HDo8J2R6JHRO+w7U3dT7r64l3lv4f7GB+gHRQ+lHlY8UnzU8LPuz22jlqOnx1zH+h8HP74/zhp/9kvGL+8nCp6Qn1RMqkw2T5lNnZp2n77xdOXTiWfpzxZmCn+V/rX2uc7zH35z/K1/NmJ24gX/xaffS17Kvzz0atmrnrmAuUevU18vzBe9kX9z+C3jbd+78HeTC1nvse8rP+h+6P7o8/HBp9RPn/4FA5jz/EHct2gAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAAJiS0dEAP+Hj8y/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAACXZwQWcAAAAwAAAAMADO7oxXAAAD9UlEQVRYw+2Ya0wUVxTH/7PAwgo+l1WU9bG+RS0lqY1oNYKvpjWaGGOMxmht4tsPShpstBJbEm3QCssuIIiPTvWD/dIalagoqNFWa9oGoqAr8YVrKaKisuCy7Om5u1IeSrJXhm/OL5OdmZ17/nfOuXfuOQO837p0UxgdgnjX8VEXmA9GGLr5CGUZjSV0CEEEjN/G3U7Km4heLBWkZd913OeeiE6b8+SCt/FyCgayRIhWz6BwX8PQW2c5+GVtOVETFWRgPKL4mqKVeQOMkSNPfu1yetl8Ix3NQzw/QzctBERgw2GKi72yx10rjDeSm9RDmAYLX1c6b14ENmpefPlhT4OHTQte0UEViRjK/yidHTd69EB00qcPzjR5GtmwnwYhML2zAv5x0wuDrItr/m7ymW2mng50WuB1YA3Djm54cdfDJl28N+Oi/ZICorfB7G29j1DGwK7pZxlXlFr/2E117XhJ+VICYoYa0J3dYYTJRz+YzWO2zCs74q5rYHPteSElIALZ3dj/2PyKXRU2h81hd9hv2m/lPzztcnq8Lnr+Fmppn4RAkBiGuQvrK73UGg8H8zk9Y2Nv8ozyAhZQuP9GjCpIq/OKhn78R0875AnlSggYMAAfHdlbQ4HzmPZKCIRjMKbsO1DNzQKlmnKkBCxIyPmxiv4NmCrKlhCI4BunZ6v/kAzSAlmqkx4FjJOyZAXsaiU9pMqAEPfZZQVs6n16EDD3ySYrkKneIxkyZQWs6h2SwSorkKFWkAwZkgKJ6aqDbgeMg9KlJtoQTEu2lrkd1JZbHXKT9ki9i8yYFL3SXlj46Fz12dcU1Vypu+4tp7K3coN2SwiEoi9iMTd0vSm17w+mdFMGYzVnxatJxSerSrylVEKl7SihNIn1IJgTwiGYiLlYhtVYx6zHBmxEMraPzskuveb5i/5sgzj/XmpFC0MflojFJCRwsxmYiVn4HAuwApt679x6/kL9NfqjDVdph4SAP+/swY4ys4yFmw3FcIzGh5iK+Vil37bslxNPf6ff2pAqtej7cwqRSYQzEYxIAEwsF4fZWI7khEOHKy9Sa757h7xIaYWoYTgV4Pw5hnPQxdg4KjP9+rmmYiryUUzbNcnsgjl7jsQITOZ4rIvcufnSiYazVOgjRQOB/6sCdtUEHmMr9SlLj/9ce5pOMd9oItCS/po55LPxhbI58ad8ZwEV0FaNsuuWykxEIwFLsCnGtvvGr+6vcrWqD1qiYcJIfMLRWBu1bVFOzBqeNRpVOK2jYeFofIZFWMgO+4Az2DDtClnFF42eHI2x+JhfLLEYxGch2lbKIhrhPHCj2Tn9ta6TW1yl9814A/8Gdc3HhOZvFUpH5v8DfKpM3OEGjaEAAAAldEVYdGRhdGU6Y3JlYXRlADIwMDktMDktMTNUMTY6MTI6NTgrMDI6MDAW26xpAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDA5LTA5LTEzVDE2OjEyOjU4KzAyOjAwZ4YU1QAAAABJRU5ErkJggg==",Mo=function(e){var t=aa(),r=50;if(t.elementId=e.elementId,t.media=e.media,t.id=e.id,t.stream=e.stream,t.div=document.createElement("div"),t.div.setAttribute("style","width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;"),t.icon=document.createElement("img"),t.icon.setAttribute("id","volume_".concat(t.id)),t.icon.setAttribute("src",Oo),t.icon.setAttribute("style","width: 80%; height: 100%; position: absolute;"),t.div.appendChild(t.icon),t.icon.onclick=function(e){e.stopPropagation(),t.media.muted?(t.media.muted=!1,t.icon.setAttribute("src",Oo),t.stream.local?t.stream.enableAudio():(t.picker.value=r,t.media.volume=t.picker.value/100)):(t.media.muted=!0,t.icon.setAttribute("src",Do),t.stream.local?t.stream.disableAudio():(r=t.picker.value,t.picker.value=0,t.media.volume=0))},!t.stream.local){t.picker=document.createElement("input"),t.picker.setAttribute("id","picker_".concat(t.id)),t.picker.type="range",t.picker.min=0,t.picker.max=100,t.picker.step=10,t.picker.value=r,t.picker.setAttribute("orient","vertical"),t.div.appendChild(t.picker),t.media.volume=t.picker.value/100,t.media.muted=!1,t.picker.onclick=function(e){return e.stopPropagation()},t.picker.oninput=function(){t.picker.value>0?(t.media.muted=!1,t.icon.setAttribute("src",Oo)):(t.media.muted=!0,t.icon.setAttribute("src",Do)),t.media.volume=t.picker.value/100};var n=function(e){t.picker.setAttribute("style","background: transparent; width: 32px;\n                                         height: 100px; position: absolute; bottom: 90%;\n                                         z-index: 1; right: 0px; -webkit-appearance: slider-vertical;\n                                         bottom: ".concat(t.div.offsetHeight-3,"px; display: ").concat(e))};t.div.onmouseover=function(){n("block")},t.div.onmouseout=function(){n("none")},n("none")}return document.getElementById(t.elementId).appendChild(t.div),t},Bo=function(e){var t=aa(),r=null,n=e.id||sr(),i=e.stream,a=e.options||{},o=null,s=null,c=document.getElementById(e.elementId);if(c)if(i){if(i.stream){var d,u,l,p,f,h=(d=a.fit,u=i,d?"contain"===d?"contain":"cover":u.desktopStreamId?"contain":"cover");l=c,Array.from(l.children).forEach((function(e){e.className.includes("bytestyle_player")&&(ia(!1,"Please do not play stream more than one in one element. oldId:".concat(e.id," newId:").concat(n)),Array.from(e.children).filter((function(e){return e.id.indexOf("video")>-1||e.id.indexOf("audio")>-1})).forEach((function(e){e.removeAttribute("src"),e.load()})),l.removeChild(e))})),p=n,(f=document.createElement("div")).setAttribute("id","player_".concat(p)),f.setAttribute("class","bytestyle_player"),f.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"),r=f,t.video=function(t,r){var n=document.createElement("video");n.setAttribute("id","video".concat(t)),n.setAttribute("class","bytestyle_stream"),n.style.width="100%",n.style.height="100%",n.style.position="absolute",n.style.objectFit=h,e.mirror&&(n.style.transform="rotateY(180deg)");n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),n.playsinline=!0,r&&(n.muted=!0,n.setAttribute("muted",""));(!0===a.muteAudio||ha())&&(n.muted=!0);return n}(n,i.local),t.audio=function(e,t){var r=document.createElement("audio");r.setAttribute("id","audio".concat(e)),r.setAttribute("class","bytestyle_stream"),r.setAttribute("style","width: 100%; height: 100%; position: absolute"),r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),r.playsinline=!0,t&&(r.muted=!0,r.setAttribute("muted",""));!0===a.muteAudio&&(r.muted=!0);return r}(n,i.local),!1!==a.loader&&(o=function(e){var t=document.createElement("img");return t.setAttribute("style","width: 16px; height: 16px; position: absolute; top: 50%; left: 50%; margin-top: -8px; margin-left: -8px"),t.setAttribute("id","back_".concat(e)),t.setAttribute("class","bytestyle_loader"),t.setAttribute("src","data:image/gif;base64,R0lGODlhEAAQAPIAAAAAAP///zw8PLy8vP///5ycnHx8fGxsbCH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="),t}(n)),!1!==a.loader&&r.appendChild(o),r.appendChild(t.video),r.appendChild(t.audio),c.appendChild(r),i.local,ia(c.contains(r),"Create Player failed."),Ki("player_created",{message:"".concat(r.id," created in element: ").concat(e.elementId,"."),vid:i.getId(),stream_id:i.getServerId(),stream_user_id:i.uid,pc_session_id:i.pc&&i.pc.pc_session_id}),a.bar&&(s=function(e){var t,r=aa();r.elementId=e.elementId,r.id=e.id,r.div=document.createElement("div"),r.div.setAttribute("id","bar_".concat(r.id)),r.div.setAttribute("class","bytestyle_bar"),r.bar=document.createElement("div"),r.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)"),r.bar.setAttribute("id","subbar_".concat(r.id)),r.bar.setAttribute("class","bytestyle_subbar");var n=function(e){var n=e;"block"!==e?n="none":clearTimeout(t),r.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display: ".concat(n))};return r.display=function(){n("block")},r.hide=function(){t=setTimeout(n,1e3)},document.getElementById(r.elementId).appendChild(r.div),r.div.appendChild(r.bar),e.stream.screen||void 0!==e.options&&void 0!==e.options.speaker&&!0!==e.options.speaker||(r.speaker=Mo({elementId:"subbar_".concat(r.id),id:r.id,stream:e.stream,media:e.media})),r.display(),r.hide(),r}({elementId:"player_".concat(n),id:n,stream:i,media:t.audio,options:a}),r.onmouseover=function(){s.display()},r.onmouseout=function(){s.hide()}),function(){var e=i.stream.getVideoTracks()[0];if(e&&e.getSettings){var t=e.getSettings();et.verbose("[video getSettings] video(streamId=".concat(i.getId(),") width:").concat(t.width,"px, height:").concat(t.height,"px"))}}(),i.local&&(t.audio.volume=0),t.mirror=function(e){t.video?t.video.style.transform=e?"rotateY(180deg)":"":et.error("There is no video in this stream.")},t.destroy=function(){ia(c.contains(r),"Please don't remove player twice."),Ki("player_destroyed",{message:"".concat(r.id," destroyed in element: ").concat(e.elementId),vid:i.getId(),stream_id:i.getServerId(),stream_user_id:i.uid,pc_session_id:i.pc&&i.pc.pc_session_id});try{t.video.pause(),t.audio.pause(),t.video.removeAttribute("src"),t.video.load(),t.audio.removeAttribute("src"),t.audio.load()}catch(e){ia(!1,"catch in player.destroy: "+e.message)}c.contains(r)&&c.removeChild(r)};var m=lr((function(){i.emit({type:"first-local-video-render"})})),v=lr((function(){i.emit({type:"first-remote-video-render"})}));t.video.ontimeupdate=function(){i.firstVideoFrameReported||(i.local?m():v(),i.firstVideoFrameReported=!0),i.local||Lo(t.video,i,"video")},t.video.onloadeddata=function(){if(et.verbose("[video loadeddata] video(streamId=".concat(i.getId(),") width:").concat(t.video.videoWidth,"px, height:").concat(t.video.videoHeight,"px")),b(),!i.local){r=i.getId(),performance.mark(r+"_mark7");var e=yr(i.getId());et.debug("performance: ",JSON.stringify(e)),Ki("performance",{message:e,stream_id:i.getServerId(),vid:i.getId()})}var r};var g=lr((function(){i.emit({type:"first-local-audio-render"})})),y=lr((function(){i.emit({type:"first-remote-audio-render"})}));return t.audio.ontimeupdate=function(){i.firstAudioFrameReported||(i.local?g():y(),i.firstAudioFrameReported=!0),i.local||Lo(t.audio,i,"audio")},t.audio.onloadeddata=function(){if(b(),!i.local&&(t=i.getId(),performance.mark(t+"_mark6"),!i.video)){var e=yr(i.getId());et.debug("performance: ",JSON.stringify(e)),Ki("performance",{message:e,stream_id:i.getServerId(),vid:i.getId()})}var t},t.video.onresize=function(){et.verbose("[video onresize] video(streamId=".concat(i.getId(),") width:").concat(t.video.videoWidth,"px, height:").concat(t.video.videoHeight,"px"))},t.isAudioPlaying=function(){return fa()?!t.video.muted&&!t.video.paused:!!ha()&&(!t.audio.muted&&!t.audio.paused)},t.playAudio=function(){fa()?t.video.muted=!1:ha()&&(t.audio.muted=!1,t.audio.play().catch((function(){})))},t.updateSrcObject=function(){var e,n;et.info("updateSrcObject() called",i),i.hasVideo()&&i.stream&&(t.video.srcObject!==i.stream&&(t.video.srcObject=i.stream),fa()&&t.video.play().catch((function(e){et.warning("updateVideoObject, call play, err: ",e)}))),i.hasAudio()&&i.stream&&(t.audio.srcObject=(e=i,n=new MediaStream,e.stream.getAudioTracks().forEach((function(e){return n.addTrack(e)})),n),t.audio.play().catch((function(e){et.warning("updateAudioObject, call play, err: ",e)}))),Ki("player_update_src_object",{message:{id:r.id,local:i.local,hasVideo:!!(t.video.srcObject&&t.video.srcObject.getVideoTracks().length>0),hasAudio:!!(t.audio.srcObject&&t.audio.srcObject.getAudioTracks().length>0)},stream_id:i.getServerId(),vid:i.getId(),stream_user_id:i.uid,pc_session_id:i.pc&&i.pc.pc_session_id})},t.updateSrcObject(),t}et.error("Create player failed, play stream should after stream-subscribed.")}else et.error("Create player failed, stream can not be null.");else et.error("Create player failed, can not find element with id: ".concat(e.elementId));function b(){o&&o.setAttribute("style","display: none")}};function Lo(e,t,r){void 0===e.__cumulativeTime&&(e.__cumulativeTime=0),0!==e.currentTime&&(e.currentTime>e.__cumulativeTime&&function(){var n=Math.floor(1e3*(e.currentTime-e.__cumulativeTime)),i=e.currentTime-e.__cumulativeTime>.5,a={playTime:e.currentTime,isStall:i,stallCount:i?1:0,stallDuration:n%2e3};if("video"===r)t.recordedVideoFrames.push(a);else{if("audio"!==r)throw new Error("unknonw mediaType: ".concat(r));t.recordedAudioFrames.push(a)}}(),e.__cumulativeTime=e.currentTime)}function No(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return jo(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jo(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function jo(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Fo=0,Uo=1,Vo=function(){function t(r,n){var i=this;if(Ce(this,t),e(this,"mergePeerStats",(function(e){if(e){var t=function(){return"video"===i.mediaType&&"up"===i.direction};e.results.forEach((function(e){!function(e){return e.googTrackId===i.trackId&&"ssrc"===e.type}(e)?t()&&function(e){return"VideoBwe"===e.type}(e)&&(i.googActualEncBitrate=e.googActualEncBitrate,i.googAvailableSendBandwidth=e.googAvailableSendBandwidth,i.googRetransmitBitrate=e.googRetransmitBitrate,i.googAvailableReceiveBandwidth=e.googAvailableReceiveBandwidth,i.googTargetEncBitrate=e.googTargetEncBitrate,i.googBucketDelay=e.googBucketDelay,i.googTransmitBitrate=e.googTransmitBitrate):t()?(i.googAvgEncodeMs=e.googAvgEncodeMs,i.googFrameRateInput=e.googFrameRateInput,i.googEncodeUsagePercent=e.googEncodeUsagePercent,i.googFrameRateSent=e.googFrameRateSent,i.googFrameWidthInput=e.googFrameWidthInput,i.googFrameHeightInput=e.googFrameHeightInput,i.packets=e.packetsSent||0,i.packetsLost=e.packetsLost||0,i.videoNetworkElapse=e.googRtt||0):"audio"===i.mediaType&&"up"===i.direction?(i.packets=e.packetsSent||0,i.packetsLost=e.packetsLost||0,i.audioNetworkElapse=e.googRtt||0,i.audioInputLevel=e.audioInputLevel):"audio"===i.mediaType&&"down"===i.direction&&(i.audioOutputLevel=e.audioOutputLevel,i.googDecodingNormal=e.googDecodingNormal)}))}})),e(this,"processCandidatePairReport",(function(e){i.icePairId=e.id,i.iceConsentRequestsSent=e.consentRequestsSent,i.iceRequestsSent=e.requestsSent,i.iceResponsesSent=e.responsesSent,i.iceRequestsReceived=e.requestsReceived,i.iceResponsesReceived=e.responsesReceived,i.iceCurrentRoundTripTime=e.currentRoundTripTime,i.iceTotalRoundTripTime=e.totalRoundTripTime,i.iceBytesReceived=e.bytesReceived,i.iceBytesSent=e.bytesSent,i.icePairState=e.state,i.iceNominated=e.nominated,i.icePairWritable=e.writable,i.icePairRTT=e.currentRoundTripTime,i.iceAvailableIncomingBitrate=e.availableIncomingBitrate,i.iceAvailableOutgoingBitrate=e.availableOutgoingBitrate})),e(this,"processLocalCandidate",(function(e){i.localCandidateType=e.candidateType,i.localIp=e.ip,i.localPort=e.port,i.localNetworkType=e.networkType,i.protocol=e.protocol})),e(this,"processRemoteCandidate",(function(e){i.remoteCandidateType=e.candidateType,i.remoteIp=e.ip,i.remotePort=e.port})),e(this,"processInboundReport",(function(e){i.bytes=e.bytesReceived,i.fractionLost=e.fractionLost,i.kind=e.kind||e.mediaType,i.ssrc=e.ssrc,i.packets=e.packetsReceived,i.packetsLost=e.packetsLost,"audio"===i.kind&&(i.jitter=e.jitter),"video"===i.kind&&(i.nackCount=e.nackCount,i.pliCount=e.pliCount,i.firCount=e.firCount)})),e(this,"processOutboundReport",(function(e){i.bytes=e.bytesSent,i.kind=e.kind||e.mediaType,i.ssrc=e.ssrc,"video"===i.kind&&(i.framesEncoded=e.framesEncoded,i.nackCount=e.nackCount,i.pliCount=e.pliCount,i.qpSum=e.qpSum)})),e(this,"processRemoteInboundRtp",(function(e){i.rtt=e.roundTripTime})),e(this,"processSendTrackReport",(function(e){switch(e.kind||i.kind){case"audio":break;case"video":i.frameHeight=e.frameHeight,i.frameWidth=e.frameWidth,i.framesSent=e.framesSent}i.trackId=e.trackIdentifier})),e(this,"processReceiveTrackReport",(function(e){switch(e.jitterBufferDelay&&e.jitterBufferEmittedCount&&(i.jitterBufferDelay=e.jitterBufferDelay/e.jitterBufferEmittedCount),e.kind||i.kind){case"audio":i.audioLevel=e.audioLevel,i.totalAudioEnergy=e.totalAudioEnergy,i.totalSamplesDuration=e.totalSamplesDuration;break;case"video":i.frameHeight=e.frameHeight,i.frameWidth=e.frameWidth,i.framesReceived=e.framesReceived,i.framesDecoded=e.framesDecoded,i.analyseDecoderError()}i.trackId=e.trackIdentifier})),e(this,"processCodec",(function(e){i.codec=e.mimeType.split("/")[1],i.clockRate=e.clockRate})),e(this,"processSendMediaSourceReport",(function(e){switch(e.kind||i.kind){case"audio":i.audioLevel=e.audioLevel,i.totalAudioEnergy=e.totalAudioEnergy,i.totalSamplesDuration=e.totalSamplesDuration}})),"video"!==r&&"audio"!==r)throw new Error("mediaType must be audio or video");if("up"!==n&&"down"!==n)throw new Error("direction must be up or down");this.mediaType=r,this.direction=n,this.error=Fo,this.initMediaComputedProperties(),"video"===this.mediaType&&this.initVideoOnlyCoumputedProperties(),"video"===r&&(this.frameRateDecoded=0,this.frameRateEncoded=0,this.frameRateSent=0,this.frameRateReceived=0)}return Ee(t,[{key:"processStatisticReports",value:function(e){var t,r=No(e.values());try{for(r.s();!(t=r.n()).done;){var n=t.value;switch(this.timestamp!=n.timestamp&&this.updateTimestamp(n),n.type){case"candidate-pair":this.processCandidatePairReport(n);break;case"inbound-rtp":this.processInboundReport(n);break;case"outbound-rtp":this.processOutboundReport(n);break;case"remote-inbound-rtp":this.processRemoteInboundRtp(n);break;case"local-candidate":this.processLocalCandidate(n);break;case"remote-candidate":this.processRemoteCandidate(n);break;case"track":"up"===this.direction?this.processSendTrackReport(n):this.processReceiveTrackReport(n);break;case"codec":this.processCodec(n);break;case"media-source":"up"===this.direction&&this.processSendMediaSourceReport(n)}}}catch(e){r.e(e)}finally{r.f()}}},{key:"updateTimestamp",value:function(e){this.timestamp&&(this.timestampInterval=(e.timestamp-this.timestamp)/1e3),this.timestamp=e.timestamp}},{key:"initMediaComputedProperties",value:function(){var e=this;this.timestampInterval=1/0,this.packetsHistory=[],this.packetsLostHistory=[];var t=0;Object.defineProperty(this,"bytes",{enumerable:!0,get:function(){return t},set:function(r){r<e.bytes||(e.bitrate=Math.round(8*(r-e.bytes)/e.timestampInterval),e.bandwidth=Math.round(e.bitrate/1024),t=r)}});var r=0;Object.defineProperty(this,"packets",{enumerable:!0,get:function(){return r},set:function(t){for(e.packetsHistory.push(t-r);e.packetsHistory.length>30;)e.packetsHistory.shift();r=t}});var n=0;Object.defineProperty(this,"packetsLost",{enumerable:!0,get:function(){return n},set:function(t){for(e.packetsLostHistory.push(t-n);e.packetsLostHistory.length>30;)e.packetsLostHistory.shift();n=t}}),Object.defineProperty(this,"packetsLostRate",{enumerable:!0,get:function(){if(e.packetsHistory.length!==e.packetsLostHistory.length)return 0;if(!(e.packetsHistory.length<5)){if(e.packetsHistory<5)return 0;for(var t=0,r=e.packetsHistory.length,n=0;n<r;n++)0===e.packetsHistory[n]?t+=100:t+=100*e.packetsLostHistory[n]/e.packetsHistory[n];return t/=r,Math.round(t)/100}}})}},{key:"initVideoOnlyCoumputedProperties",value:function(){var e=this,t=0;Object.defineProperty(this,"framesSent",{enumerable:!0,get:function(){return t},set:function(r){e.frameRateSent=Math.round((r-t)/e.timestampInterval),t=r}});var r=0;Object.defineProperty(this,"framesReceived",{enumerable:!0,get:function(){return r},set:function(t){e.frameRateReceived=Math.round((t-r)/e.timestampInterval),r=t}});var n=0;Object.defineProperty(this,"framesDecoded",{enumerable:!0,get:function(){return n},set:function(t){e.frameRateDecoded=Math.round((t-n)/e.timestampInterval),n=t}});var i=0;Object.defineProperty(this,"framesEncoded",{enumerable:!0,get:function(){return i},set:function(t){e.frameRateEncoded=Math.round((t-i)/e.timestampInterval),i=t}})}},{key:"analyseDecoderError",value:function(){this.frameRateReceived>0&&0===this.frameRateDecoded?this.error|=Uo:this.error&=~Uo}},{key:"getServerReportStats",value:function(){var e,t,r=this.getSharedServerReportStats();return"video"===this.mediaType&&"up"===this.direction?Object.assign(r,this.getSentVideoOnlyServerReportStats()):"video"===this.mediaType&&"down"===this.direction?Object.assign(r,this.getReceivedVideoOnlyServerReportStats()):"audio"===this.mediaType&&"up"===this.direction?Object.assign(r,this.getSentAudioOnlyServerReportStats()):"audio"===this.mediaType&&"down"===this.direction&&Object.assign(r,this.getReceivedAudioOnlyServerReportStats()),e=r,t={},Object.keys(e).forEach((function(r){t[Ht(r)]=e[r]})),t}},{key:"getSharedServerReportStats",value:function(){return{bandwidth:this.bandwidth,bitrate:this.bitrate,bytes:this.bytes,direction:this.direction,mediaType:this.mediaType,packets:this.packets,rtt:1e3*this.iceCurrentRoundTripTime,sentPingRequestsBeforeFirstResponse:this.iceRequestsSent,sentPingRequestsTotal:this.iceRequestsSent+this.iceConsentRequestsSent,sentPingResponses:this.iceResponsesSent,recvPingRequests:this.iceRequestsReceived,recvPingResponses:this.iceResponsesReceived,ssrc:this.ssrc,codec:this.codec,iceBytesReceived:100,iceBytesSent:this.iceBytesSent,icePairState:this.icePairState,icePairRTT:this.icePairRTT,icePairWritable:this.icePairWritable,icePairId:this.icePairId,iceNominated:1,localIp:this.localIp,localPort:this.localPort,localCandidateType:this.localCandidateType,localNetworkType:this.localNetworkType,protocol:this.protocol,remoteIp:this.remoteIp,remotePort:this.remotePort,remoteCandidateType:this.remoteCandidateType,iceAvailableIncomingBitrate:100,iceAvailableOutgoingBitrate:100}}},{key:"getSentVideoOnlyServerReportStats",value:function(){return{pliCount:this.pliCoun,firCount:this.firCount,nackCount:this.nackCount,qpSum:this.qpSum,frameSizeHeight:this.frameHeight,frameSizeWidth:this.frameWidth,frameRateSent:this.googFrameRateSent||this.frameRateSent||0,frameRateInput:this.googFrameRateInput||0,frameRateEncoded:this.frameRateEncoded,fractionLost:this.packetsLostRate,videoNetworkElapse:this.videoNetworkElapse,avgEncodeMs:this.googAvgEncodeMs||0,encodeUsagePercent:this.googEncodeUsagePercent||0,actualEncBitrate:this.googActualEncBitrate||0,availableSendBandwidth:this.googAvailableSendBandwidth||0,retransmitBitrate:this.googRetransmitBitrate||0,availableReceiveBandwidth:this.googAvailableReceiveBandwidth||0,targetEncBitrate:this.googTargetEncBitrate||0,bucketDelay:this.googBucketDelay||0,transmitBitrate:this.googTransmitBitrate||0}}},{key:"getReceivedVideoOnlyServerReportStats",value:function(){return{pliCount:this.pliCount,firCount:this.firCount,nackCount:this.nackCount,packetsLost:this.packetsLost,packetsLostRate:this.packetsLostRate,frameSizeHeight:this.frameHeight,frameSizeWidth:this.frameWidth,frameRateOutput:this.frameRateDecoded,frameRateReceived:this.frameRateReceived,frameRateDecoded:this.frameRateDecoded,fractionLost:this.packetsLostRate,jitterBufferDelay:this.jitterBufferDelay}}},{key:"getSentAudioOnlyServerReportStats",value:function(){return{sendLevel:this.audioInputLevel,audioLevel:this.audioLevel,volume:parseInt(255*this.audioLevel),totalAudioEnergy:this.totalAudioEnergy,totalSamplesDuration:this.totalSamplesDuration,fractionLost:this.packetsLostRate,audioNetworkElapse:this.audioNetworkElapse}}},{key:"getReceivedAudioOnlyServerReportStats",value:function(){return{recvLevel:this.audioOutputLevel,audioLevel:this.audioLevel,volume:parseInt(255*this.audioLevel),totalAudioEnergy:this.totalAudioEnergy,totalSamplesDuration:this.totalSamplesDuration,decodingNormal:this.googDecodingNormal,packetsLost:this.packetsLost,packetsLostRate:this.packetsLostRate,jitter:1e3*this.jitter,fractionLost:this.packetsLostRate,jitterBufferDelay:this.jitterBufferDelay}}},{key:"getSdkStats",value:function(){return"video"===this.mediaType&&"up"===this.direction?this.sentVideoStats:"video"===this.mediaType&&"down"===this.direction?this.recevedVideoStats:"audio"===this.mediaType&&"up"===this.direction?this.sentAudioStats:"audio"===this.mediaType&&"down"===this.direction?this.recevedAudioStats:void 0}},{key:"getClientStats",value:function(){return"video"===this.mediaType&&"up"===this.direction?{CaptureFrameRate:this.googFrameRateInput,CaptureResolutionHeight:this.googFrameHeightInput,CaptureResolutionWidth:this.googFrameWidthInput,EncodeDelay:this.googAvgEncodeMs,MuteState:this.muted,PacketLossRate:100*this.packetsLostRate||0,SendBitrate:this.bitrate/1e3,SendFrameRate:this.frameRateSent,SendResolutionHeight:this.frameHeight,SendResolutionWidth:this.frameWidth,TargetSendBitrate:0,TotalDuration:0,TotalFreezeTime:0}:"video"===this.mediaType&&"down"===this.direction?{End2EndDelay:0,MuteState:this.muted,PacketLossRate:100*this.packetsLostRate||0,RecvBitrate:this.bitrate/1e3,RecvResolutionHeight:this.frameHeight,RecvResolutionWidth:this.frameWidth,RenderFrameRate:this.frameRateDecoded,RenderResolutionHeight:this.frameHeight,RenderResolutionWidth:this.frameWidth,TotalFreezeTime:0,TotalPlayDuration:0,TransportDelay:parseInt(1e3*this.icePairRTT)}:"audio"===this.mediaType&&"up"===this.direction?{CodecType:this.codec,MuteState:this.muted,PacketLossRate:100*this.packetsLostRate||0,RecordingLevel:0|this.audioInputLevel,SamplingRate:this.totalSamplesDuration,SendBitrate:this.bitrate/1e3,SendLevel:this.totalAudioEnergy}:"audio"===this.mediaType&&"down"===this.direction?{CodecType:this.codec,End2EndDelay:0,MuteState:this.muted,PacketLossRate:100*this.packetsLostRate||0,RecvBitrate:this.bitrate/1e3,RecvLevel:this.audioOutputLevel,TotalFreezeTime:0,TotalPlayDuration:0,TransportDelay:parseInt(1e3*this.icePairRTT)}:void 0}},{key:"sentVideoStats",get:function(){return{accessDelay:Math.round(1e3*this.iceCurrentRoundTripTime),videoSentBitrate:this.bitrate,videoSentBytes:this.bytes,videoSentPackets:parseInt(this.packets),videoSentPacketsLost:parseInt(this.packetsLost),videoSentPacketsLostRate:this.packetsLostRate,videoSentFrameRate:this.frameRateSent,videoSentEncodedFrameRate:this.frameRateEncoded,videoSentResolutionWidth:this.frameWidth,videoSentResolutionHeight:this.frameHeight}}},{key:"recevedVideoStats",get:function(){return{accessDelay:Math.round(1e3*this.iceCurrentRoundTripTime),videoReceivedBitrate:this.bitrate,videoReceivedBytes:this.bytes,videoReceivedPackets:this.packets,videoReceivedPacketsLost:this.packetsLost,videoReceivedPacketsLostRate:this.packetsLostRate,videoReceivedFrameRate:this.frameRateReceived,videoReceivedDecodeFrameRate:this.frameRateDecoded,videoReceivedResolutionWidth:this.frameWidth,videoReceivedResolutionHeight:this.frameHeight}}},{key:"sentAudioStats",get:function(){return{accessDelay:Math.round(1e3*this.iceCurrentRoundTripTime),audioSentBitrate:this.bitrate,audioSentBytes:this.bytes,audioSentPackets:parseInt(this.packets),audioSentPacketsLost:parseInt(this.packetsLost),audioSentPacketsLostRate:this.packetsLostRate}}},{key:"recevedAudioStats",get:function(){return{accessDelay:Math.round(1e3*this.iceCurrentRoundTripTime),audioReceivedBitrate:this.bitrate,audioReceivedBytes:this.bytes,audioReceivedPackets:this.packets,audioReceivedPacketsLost:this.packetsLost,audioReceivedPacketsLostRate:this.packetsLostRate}}}]),t}();function zo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Go(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Wo(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wo(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Wo(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ho=2e3,qo=function t(r){var n=this;Ce(this,t),e(this,"rawStatistics",[]),e(this,"clear",(function(){clearInterval(n.statInterval),clearInterval(n.eventLogInterval)})),e(this,"getStats",(function(){var e={};return n.stream.getState()!==Ta.SUCCESS||Array.from(n.reportStatisticsMap.values()).forEach((function(t){Object.assign(e,t.getSdkStats())})),e})),e(this,"getVideoStats",(function(){var e,t={},r=Go(n.reportStatisticsMap.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;"video"===i.mediaType&&(t=i.getClientStats())}}catch(e){r.e(e)}finally{r.f()}return t})),e(this,"getAudioStats",(function(){var e,t={},r=Go(n.reportStatisticsMap.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;"audio"===i.mediaType&&(t=i.getClientStats())}}catch(e){r.e(e)}finally{r.f()}return t})),e(this,"reportStatisticsMap",new Map),e(this,"extractStreamStats",ve(ge.mark((function e(){var t,r,i,a,o,s;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.hasPeerConnection()){e.next=2;break}return e.abrupt("return",[]);case 2:if(n.stream.getState()!==Ta.IDLE&&n.stream.getState()!==Ta.CLOSED){e.next=4;break}return e.abrupt("return",[]);case 4:return n.dropDisconnectedTracksRtt(),t=n.stream.getTracksId(),r=n.stream.pc.peerConnection.getSenders?n.stream.pc.peerConnection.getSenders():[],i=r.filter((function(e){return t.includes(e.track&&e.track.id)})).map((function(e){return n.processSender(e)})),a=n.stream.pc.peerConnection.getReceivers?n.stream.pc.peerConnection.getReceivers():[],o=a.filter((function(e){return t.includes(e.track&&e.track.id)})).map((function(e){return n.processReceiver(e)})),s=ra(n.stream),e.next=13,Promise.all(i.concat(o));case 13:return e.abrupt("return",e.sent.filter((function(e){return e})).map((function(e){return Object.assign(e,s)})));case 14:case"end":return e.stop()}}),e)})))),e(this,"hasPeerConnection",(function(){return n.stream&&n.stream.pc&&n.stream.pc.peerConnection})),e(this,"processSender",(function(e){return n.processHandler(e,"up")})),e(this,"processReceiver",(function(e){return n.processHandler(e,"down")})),e(this,"processHandler",function(){var e=ve(ge.mark((function e(t,r){var i,a;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.getStats||!t.track||"video"!==t.track.kind&&"audio"!==t.track.kind){e.next=13;break}return e.next=3,t.getStats();case 3:if(0!==(i=e.sent).size){e.next=6;break}return e.abrupt("return");case 6:return(a=n.reportStatisticsMap.get(t.track))||(a=new Vo(t.track.kind,r)),a.processStatisticReports(i),n.processTrackError(a),n.updateTrackRtt(a),n.reportStatisticsMap.set(t.track,a),e.abrupt("return",a.getServerReportStats());case 13:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),e(this,"processTrackError",(function(e){if(e.error&Uo){var t="receive: ".concat(e.frameRateReceived," decode: ").concat(e.frameRateDecoded);Ki("decoder_error",{message:t}),n.stream.emit(ca({type:"decoder-error",message:t,stream:n.stream}))}})),e(this,"dropDisconnectedTracksRtt",(function(){if(n.stream.stream){var e=n.stream.stream.getTracks().map((function(e){return e.id}));Array.from(n.stream.tracksRtt.keys()).forEach((function(t){e.includes(t)||n.stream.tracksRtt.delete(t)}))}})),e(this,"updateTrackRtt",(function(e){"succeeded"===e.icePairState&&n.stream.tracksRtt.set(e.trackId,{id:e.trackId,rtt:e.icePairRTT,type:e.mediaType,direction:e.direction})})),this.stream=r,this.statInterval=setInterval(ve(ge.mark((function e(){return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.extractStreamStats();case 3:n.rawStatistics=e.sent,i(n.stream.getPCStats()),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),et.error(e.t0),n.rawStatistics=[];case 11:case"end":return e.stop()}}),e,null,[[0,7]])}))),1e3),this.eventLogInterval=setInterval((function(){var t,i,s;n.rawStatistics.length>0&&(!r.local&&(t=n.rawStatistics,i=o(r,"video"),s=o(r,"audio"),et.verbose("[stall] video:",i," audio",s),a(t,i,"video"),a(t,s,"audio")),n.rawStatistics.forEach((function(e){if("number"==typeof e.audio_level){var t=e.audio_level;e.audio_level=-10*Math.log10(Math.pow(t,2)),e.volume=255*t}Ki("rtc_media_statistics",e)}))),r.hasData()&&Ki("rtc_media_statistics",function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?zo(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zo(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({media_type:"data",direction:r.local?"up":"down"},r.getMessageStatisticsAndClear()))}),Ho);var i=function(e){var t,r=Go(n.reportStatisticsMap);try{for(r.s();!(t=r.n()).done;){var i=ke(t.value,2),a=i[0],o=i[1];o.mergePeerStats(e),o.muted=a.muted}}catch(e){r.e(e)}finally{r.f()}};function a(e,t,r){e.forEach((function(e){e.media_type===r&&(e.stall_count=t.stall_count,e.stall_duration=t.stall_duration,e.play_time=t.play_time,e.total_rtt_ms=t.total_rtt_ms,e.web_e2e_delay=-1,-1!==t.total_rtt_ms&&e.jitter_buffer_delay&&(e.web_e2e_delay=Math.floor(t.total_rtt_ms+1e3*e.jitter_buffer_delay)))}))}function o(e,t){var r=0,n=0,i=0,a=e.dataChannelRTT;if("video"===t)e.recordedVideoFrames.forEach(o),e.recordedVideoFrames.length||(n=Ho),e.recordedVideoFrames=[];else{if("audio"!==t)throw new Error("Unknow mediaType: ".concat(t));e.recordedAudioFrames.forEach(o),e.recordedAudioFrames.length||(n=Ho),e.recordedAudioFrames=[]}return{stall_count:r,stall_duration:n,play_time:i,total_rtt_ms:a};function o(e){e.isStall&&(r+=e.stallCount,n+=e.stallDuration),i=e.playTime}}},Jo=function(){function e(t){Ce(this,e),this.TAG="Golomb",this._buffer=t,this._bufferIndex=0,this._totalBytes=t.byteLength,this._totalBits=8*t.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}return Ee(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._totalBytes-this._bufferIndex,t=Math.min(4,e),r=new Uint8Array(4);r.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+t)),this._currentWord=new DataView(r.buffer).getUint32(0),this._bufferIndex+=t,this._currentWordBitsLeft=8*t}},{key:"readBits",value:function(e){var t=Math.min(this._currentWordBitsLeft,e),r=this._currentWord>>>32-t;if(e>32)throw new Error("Cannot read more than 32 bits at a time");return this._currentWordBitsLeft-=t,this._currentWordBitsLeft>0?this._currentWord<<=t:this._totalBytes-this._bufferIndex>0&&this._fillCurrentWord(),(t=e-t)>0&&this._currentWordBitsLeft?r<<t|this.readBits(t):r}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e;for(e=0;e<this._currentWordBitsLeft;e++)if(0!=(this._currentWord&2147483648>>>e))return this._currentWord<<=e,this._currentWordBitsLeft-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}},{key:"readSliceType",value:function(){return this.readByte(),this.readUEG(),this.readUEG()}},{key:"nextIndex",value:function(){var e=this._currentWordBitsLeft>>3;return this._bufferIndex-e}}]),e}(),Zo=function(e){var t=[];return[e.filter((function(r,n){if(n<2)return!0;var i=0===e[n-2]&&0===e[n-1]&&3===r;return i&&t.push(n),!i})),t]},Ko=function(e){for(var t=[],r=0;r<e.byteLength-1;r++)0!==e[r]||0!==e[r+1]?t.push(e[r]):(t.push(0),t.push(0),t.push(3),r+=1);for(;r<e.byteLength;r++)t.push(e[r]);return new Uint8Array(t)};function Qo(e,t){return Array.prototype.map.call(new Uint8Array(e.slice(0,t)),(function(e){return("00"+e.toString(16)).slice(-2)})).join(" ")}function Yo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Xo(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?Yo(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Yo(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function $o(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return es(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return es(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function es(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ts,rs,ns=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e,r=aa(),n=Ta.IDLE,a=e.streamId||"_init_"+sr().slice(6),o=a;r.class="KernelStream",r.recordedVideoFrames=[],r.recordedAudioFrames=[],r.stream=t.stream,r.audioTransform=t.audioTransform||function(e,t){return t.enqueue(e)},r.videoTransform=t.videoTransform||function(e,t){return t.enqueue(e)},r.uid=t.uid,r.url=t.url,r.recording=t.recording,r.room=void 0,r.local=!1,r.video=t.video,r.audio=t.audio,r.screen=t.screen,r.data=t.data,r.enableMediaType={video:!0,audio:!0},r.videoSize=t.videoSize,r.videoFrameRate=t.videoFrameRate,r.extensionId=t.extensionId,r.desktopStreamId=t.desktopStreamId,r.actions={updateSubscribeState:xa.FINISHED},t.attributes&&t.attributes.videoDescriptions&&(r.videoDescriptions=t.attributes.videoDescriptions),r.audioMuted=!1,r.videoMuted=!1,r.minVideoBW=100,r.maxVideoBW=500,r.transportType="",r.Connection=Ra,r.__logSignaling={},r.tracksRtt=new Map,r.qualityLayer={spatialLayer:1,temporalLayer:1};var s=0,c=0,d=0;r.remoteMSIp="",r.isManualPublished=!1,r.offer="",r.rttTimer=null,r.dataChannelRTT=-1;var u=function(e){for(var t=new Uint8Array(e),r=0;r<t.length-5;r++)if(0===t[r]&&0===t[r+1]&&0===t[r+2]&&1===t[r+3]){var n=31&t[r+4];if(5===n||1===n)return r+4}else if(0===t[r]&&0===t[r+1]&&1===t[r+2]){var i=31&t[r+3];if(5===i||1===i)return r+3}return-1},l=function(e){var t=Zo(new Uint8Array(e)),r=ke(t,2),n=r[0],i=r[1],a=new Jo(n);a.readUEG(),a.readUEG(),a.readUEG();for(var o=a.nextIndex(),s=0;s<i.length;s++)o>i[s]&&(o+=1);return o},p=function(e,t){et.verbose("video frame",Qo(e.data,100),e.data.byteLength);var n=u(e.data);if(-1!==n){var i=e.data.slice(n+1,n+1+24+12),a=n+1+l(i),o=e.data.slice(0,a),s=e.data.slice(a);s=r.local?s:Zo(new Uint8Array(s))[0].buffer;var c={enqueue:function(n){n.data=r.local?Ko(new Uint8Array(n.data)).buffer:n.data;var i=new ArrayBuffer(o.byteLength+n.data.byteLength),a=new Uint8Array(i);a.set(new Uint8Array(o),0),a.set(new Uint8Array(n.data),o.byteLength),e.data=i,t.enqueue(e),et.verbose("video frame processed",Qo(e.data,100),e.data.byteLength)}};e.data=s,r.videoTransform(e,c)}else t.enqueue(e)},f=function(){var e=ve(ge.mark((function e(t,n){return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.audioTransform(t,n);case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),h=function(e){e.stream.id===r.getId()&&(r.stream=e.stream,r.emit(ca({type:"added",stream:e.stream})))},m=function(e){var t=null,n=null;switch(r.stream.getTracks().forEach((function(e){switch(e.kind){case"video":t=e;break;case"audio":n=e}})),e.kind){case"video":t&&t.id===e.trackId&&r.pc.bindTransform(t.id,p,r.local);break;case"audio":n&&n.id===e.trackId&&r.pc.bindTransform(n.id,f,r.local)}},v=function(e){e.stream.id===r.getId()&&r.emit(ca({type:"removed",stream:e.stream}))},g=function(e){switch(e){case"completed":case"connected":r.local&&r.setState(Ta.SUCCESS);break;case"closed":case"failed":r.setStateFailed(new Error("remote stream browser ice failed or closed"))}},y=function(e){return g(e.state)};if(!(void 0===r.videoSize||r.videoSize instanceof Array&&4===r.videoSize.length))throw Error("Invalid Video Size");void 0!==t.local&&!0!==t.local||(r.local=!0),r.local||S();var b=new qo(r);function _(e){t.attributes=Object.assign(t.attributes||{},e)}function S(){if(!r.local&&r.room){var e=Date.now();r.dataChannelRTT=-1,r.room.sendP2PMessage(r.uid,"__web__rtc__rtt__").then((function(){var t=Date.now()-e;t>0&&t<2e3&&(r.dataChannelRTT=t)}))}r.rttTimer=setTimeout((function(){S()}),2e3)}r.setState=function(e){et.debug("[stream] [state] sId: ".concat(r.getId().slice(0,5)," pcId: ").concat(r.pc&&r.pc.pc_session_id.slice(0,5)," state: ").concat(r.pc&&r.pc.peerConnection.iceConnectionState," from: ").concat(n.toString()," to: ").concat(e.toString())),Ki("stream_state",{vid:r.getId(),stream_id:r.getServerId(),stream_user_id:r.uid,pc_session_id:r.pc&&r.pc.pc_session_id,conn_state:e.toString(),ice_state:r.pc&&r.pc.peerConnection.iceConnectionState}),n=e},r.getState=function(){return n},r.getRttMean=function(){if(r.getState()===Ta.SUCCESS){var e,t=0,n=Array.from(r.tracksRtt.keys()).length,i=$o(r.tracksRtt);try{for(i.s();!(e=i.n()).done;){t+=ke(e.value,2)[1].rtt}}catch(e){i.e(e)}finally{i.f()}return t/n}return-1},r.getPCStats=function(){return r.pc&&r.pc.getPCStats()},r.getStats=function(){return b.getStats()},r.getAudioStats=function(){return b.getAudioStats()},r.getVideoStats=function(){var e=b.getVideoStats();return e.TargetSendBitrate=r.maxVideoBW,e},r.getId=function(){return a},r.getServerId=function(){return o},r.setId=function(e){var t="".concat(a,": ").concat(o," -> ").concat(e);Ki("stream_id_update",{message:t}),o=e},r.getAttributes=function(){if(!r.local)return t.attributes;var e,n=[];if(r.video&&(e={width:parseInt(r.videoSize[2]),height:parseInt(r.videoSize[3]),framerate:parseInt(r.videoFrameRate[1]),maxkbps:parseInt(r.maxVideoBW)},n.push(e)),r.simulcast&&r.video){n=n.concat([{width:parseInt(e.width/2),height:parseInt(e.height/2),framerate:parseInt(e.framerate/2),maxkbps:parseInt(e.maxkbps/2)}])}return Xo(Xo({},t.attributes),{},{videoDescriptions:n})},r.getCustomData=function(){return t.customData},r.setLocalOptions=function(e){r.maxVideoBW=e.maxVideoBW,r.minVideoBW=e.minVideoBW,r.simulcast=e.simulcast,r.transportType=e.transportType},r.setMaxVideoBW=function(e){r.maxVideoBW=e},r.setMinVideoBW=function(e){r.minVideoBW=e},r.getLocalOptions=function(){return{simulcast:r.simulcast,minVideoBW:r.minVideoBW,maxVideoBW:r.maxVideoBW,transportType:r.transportType}},r.setRemoteOptions=function(e){r.data=!!e.data,r.setEnableMediaType({video:!1!==e.video,audio:!1!==e.audio}),r.transportType=e.transportType},r.getRemoteOptions=function(){return{data:r.data,video:r.enableMediaType.video,audio:r.enableMediaType.audio,transportType:r.transportType,qualityLayer:r.qualityLayer}},r.isAllActionsFinished=function(){return r.actions.updateSubscribeState===xa.FINISHED},r.setEnableMediaType=function(e){r.enableMediaType.video=e.video,r.enableMediaType.audio=e.audio,r.player&&r.player.updateSrcObject&&r.player.updateSrcObject()},r.getEnableMediaType=function(){return r.enableMediaType},r.setAttributes=function(e){r.local&&(_(e),r.room&&r.room.dataChannelSignaling&&r.room.dataChannelSignaling.sendSignaling("updateStreamAttributes",{streamId:r.getServerId(),attributes:e}))},r.updateAttributesByServerEnd=_,r.hasDisableAudio=function(){if(!1===t.audio)return!0;if(t.attributes&&(!1===t.attributes.audiostream||!1===t.attributes.localaudio))return!0;if(r.room){var e=r.room.remoteUsers.get(r.uid);if(e&&!1===e.attributes.enableaudio)return!0}return!1},r.hasDisableVideo=function(){if(!1===t.video)return!0;if(t.attributes&&(!1===t.attributes.videostream||!1===t.attributes.localvideo))return!0;if(r.room){var e=r.room.remoteUsers.get(r.uid);if(e&&!1===e.attributes.enablevideo)return!0}return!1===r.enableMediaType.video},r.setAudioParam=function(e){r.audioParam=e},r.getAudioParam=function(){return r.audioParam},r.hasAudio=function(){return!1!==r.audio&&void 0!==r.audio},r.hasVideo=function(){return!1!==r.video&&void 0!==r.video},r.hasData=function(){return!1!==r.data&&void 0!==r.data},r.hasScreen=function(){return r.screen},r.hasMedia=function(){return r.audio||r.video||r.screen},r.isExternal=function(){return void 0!==r.url||void 0!==r.recording},r.removePC=function(){r.pc&&(r.pc.off("add-transform",m),r.pc.off("add-stream",h),r.pc.off("remove-stream",v),r.pc.off("ice-state-change",y),r.pc.streams.delete(r),r.pc.refCount-=1,r.pc=null)},r.addPC=function(e){r.removePC(),r.pc=e,e.refCount+=1,r.pc.on("add-transform",m),r.pc.on("add-stream",h),r.pc.on("remove-stream",v),r.pc.on("ice-state-change",y),r.pc.streams.add(r)},r.init=function(e){r.videoSize=e.videoSize||r.videoSize,r.videoFrameRate=e.videoFrameRate||r.videoFrameRate;try{if((t.audio||t.video||t.screen)&&void 0===t.url){et.info("Requested access to local media");var n=t.video;n?(n=!0===n?{}:n,void 0!==r.videoSize&&(n.width={min:r.videoSize[0],ideal:r.videoSize[2],max:r.videoSize[2]},n.height={min:r.videoSize[1],ideal:r.videoSize[3],max:r.videoSize[3]}),void 0!==r.videoFrameRate&&(n.frameRate={min:r.videoFrameRate[0],ideal:r.videoFrameRate[1],max:r.videoFrameRate[1]})):!0===t.screen&&void 0===n&&(n=!0);var i={video:n,audio:t.audio,fake:t.fake,screen:t.screen,screenAudio:t.screenAudio,extensionId:r.extensionId,desktopStreamId:r.desktopStreamId};r.Connection.GetUserMedia(i,(function(e){et.info("User has granted access to local media."),r.stream=e,r.dispatchEvent(ca({type:"access-accepted"})),r.stream.getTracks().forEach((function(e){var t=e;t.onended=function(e){et.error("track.onended",e),Ki("track_error",{message:"".concat(e.kind,"track ended"),stream_id:r.getServerId(),vid:r.getId(),log_type:Ja}),r.stream.getTracks().forEach((function(e){e.onended=null}));var n=ca({type:"track-ended",stream:r,message:t.kind});r.dispatchEvent(n)}}))}),(function(e){et.error("Failed to get access to local media. Error code was",e);var t=ca({type:"access-denied",code:e.code,message:e.name||e.message});r.dispatchEvent(t)}))}else{var a=ca({type:"access-accepted"});r.dispatchEvent(a)}}catch(e){et.error("Failed to get access to local media. Error was",e);var o=ca({type:"access-denied",message:e});r.dispatchEvent(o)}},r.play=function(e,t){var n=t||{};r.elementId=e,e?(r.player&&(et.warning("One Stream only play in one player. Removing Last Player."),r.player.destroy(),r.player=null),r.player=Bo({stream:r,elementId:e,mirror:!r.screen&&r.local,options:n})):et.error("play(elementId): elementId can not be null.")},r.mirror=function(e){r.player?r.player.mirror(e):et.warning("Stream is not playing.")},r.stop=function(){r.player&&(r.player.destroy(),r.player=void 0)},r.close=function(){if(r.stop(),clearTimeout(r.rttTimer),r.room&&r.getState()!==Ta.CLOSED)try{r.local?r.room.unpublish(r):r.room.unsubscribe(r)}catch(e){et.error("close stream error",r.local,e,r.getId())}r.local&&(r.stream&&r.stream.getTracks().forEach((function(e){var t=e;t.onended=null,et.debug("that.close() -> track.stop()",t.onended),t.stop()})),r.stream=void 0),r.removePC(),b.clear()},r.removeStreamFromPC=function(){r.stream&&r.pc&&r.pc.removeStream(r.stream)},r.removeLivingStream=function(){r.setState(Ta.CLOSED),r.local?r.pc&&r.pc.removeStream(r.stream):r.stream?(r.close(),delete r.stream):r.removePC()},r.applyBitreate=function(){if(r.pc&&r.pc.peerConnection&&r.stream){var e=r.stream.getVideoTracks();if(e.length){var t=r.pc.peerConnection.getSenders();if(t.length){var n=e[0];t.forEach((function(e){if(e.track===n){var t=e.getParameters();t.encodings&&t.encodings.length||(t.encodings=[{}]),t.encodings[0].maxBitrate=1e3*r.maxVideoBW,t.encodings[0].minBitrate=1e3*r.minVideoBW,e.setParameters(t)}}))}}}};var w=function(){if(r.player&&r.stream){var e,t=r.player.video,n=document.defaultView.getComputedStyle(t),a=parseInt(n.getPropertyValue("width"),10),o=parseInt(n.getPropertyValue("height"),10),s=parseInt(n.getPropertyValue("left"),10),c=parseInt(n.getPropertyValue("top"),10);e="object"===i(r.elementId)&&"function"==typeof r.elementId.appendChild?r.elementId:document.getElementById(r.elementId);var d=document.defaultView.getComputedStyle(e),u=parseInt(d.getPropertyValue("width"),10),l=parseInt(d.getPropertyValue("height"),10),p=document.createElement("canvas");return p.id="testing",p.width=u,p.height=l,p.setAttribute("style","display: none"),p.getContext("2d").drawImage(t,s,c,a,o),p}return null};r.getVideoFrameURL=function(e){var t=w();return null!==t?e?t.toDataURL(e):t.toDataURL():null},r.getVideoFrame=function(){var e=w();return null!==e?e.getContext("2d").getImageData(0,0,e.width,e.height):null},r.checkOptions=function(e,t){var n=e;!0===t?(n.audio||n.screen)&&(et.warning("Cannot update type of subscription"),n.audio=void 0,n.screen=void 0):!1===r.local&&(!0===n.video&&!1===r.hasVideo()&&(et.warning("Trying to subscribe to video when there is no video, won't subscribe to video"),n.video=!1),!0===n.audio&&!1===r.hasAudio()&&(et.warning("Trying to subscribe to audio when there is no audio, won't subscribe to audio"),n.audio=!1)),!1===r.local&&(r.hasVideo()||!0!==n.slideShowMode||(et.warning("Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),n.slideShowMode=!1))};var k=function(e){return!!r.stream&&("audio"===e&&r.stream.getAudioTracks().length>0?(r.stream.getAudioTracks().forEach((function(e){return e.enabled=!r.audioMuted})),!0):"video"===e&&r.stream.getVideoTracks().length>0&&(r.stream.getVideoTracks().forEach((function(e){return e.enabled=!r.videoMuted})),!0))};return r.enableAudio=function(){r.audioMuted=!1;var e=k("audio");return r.local&&r.setAttributes({audiostream:!r.audioMuted}),e},r.disableAudio=function(){r.audioMuted=!0;var e=k("audio");return r.local&&r.setAttributes({audiostream:!r.audioMuted}),e},r.enableVideo=function(){r.videoMuted=!1;var e=k("video");return r.local&&r.setAttributes({videostream:!r.videoMuted}),e},r.disableVideo=function(){r.videoMuted=!0;var e=k("video");return r.local&&r.setAttributes({videostream:!r.videoMuted}),e},r.unmuteAudio=r.enableAudio,r.unmuteVideo=r.enableVideo,r.muteAudio=r.disableAudio,r.muteVideo=r.disableVideo,r.isAudioPlaying=function(){return r.player&&r.player.isAudioPlaying()},r.playAudio=function(){return r.player&&r.player.playAudio()},r.saveOffer=function(e){r.offer=e},r._setStaticQualityLayer=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i={qualityLayer:{spatialLayer:e,temporalLayer:t}};r.qualityLayer=i.qualityLayer,r.pc?(r.checkOptions(i,!0),r.room.updateSpec(r.getServerId(),{type:"updatestream",config:i},!r.local)):n("This stream has no peerConnection attached, ignoring")},r._setDynamicQualityLayer=function(e){var t={qualityLayer:{spatialLayer:-1,temporalLayer:-1}};r.checkOptions(t,!0),r.pc?(r.checkOptions(t,!0),r.room.updateSpec(r.getServerId(),{type:"updatestream",config:t},!r.local)):e("This stream has no peerConnection attached, ignoring")},r.updateConfiguration=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(e)if(r.local)if(r.stream){var n=r.stream.getVideoTracks()[0];n?n.applyConstraints(e).then((function(){t()})).catch((function(e){t(e)})):t(new Error("no videoTrack"))}else t(new Error("no mediaStream"));else t(new Error("not local stream"));else t(new Error("no config"))},r.setStateFailed=function(e){return r.getState()!==Ta.IDLE&&r.getState()!==Ta.FAILED&&r.getState()!==Ta.CLOSED&&(et.error("setStateFailed",e.message,r.getId()),r.setState(Ta.FAILED),!0)},r.setMediaStream=function(e){if(r.stream=e,e.getAudioTracks().length>0){var t=e.getAudioTracks()[0];r.audio=!0,r.audioMuted=t.muted}if(e.getVideoTracks().length>0){r.video=!0;var n=e.getVideoTracks()[0],i={width:0,height:0,frameRate:0};"function"==typeof n.getSettings&&(i=n.getSettings()),r.videoSize=[120,120,i.width,i.height];var a=i.frameRate;r.videoFrameRate=[a>15?15:10,a],r.videoMuted=n.muted}},r.createOffer=function(e,t){return r.pc.createOffer(e,r.stream,r.getServerId(),t)},r.getMessageStatisticsAndClear=function(){var e={dc_send_total:s,dc_send_ack:c,dc_cost_time:d};return s=0,c=0,d=0,e},r.isIceConnected=function(){return r.pc&&("connected"===r.pc.peerConnection.iceConnectionState||"completed"===r.pc.peerConnection.iceConnectionState)},r.getTracksId=function(){return r.stream?r.stream.getTracks().map((function(e){return e.id})):[]},r},is=function(){var e={},t={};return e.add=function(e,r){t[e]=r},e.get=function(e){return t[e]},e.has=function(e){return void 0!==t[e]},e.forEach=function(e){for(var r=Object.keys(t),n=0;n<r.length;n+=1){var i=r[n];e(t[i],i)}},e.keys=function(){return Object.keys(t)},e.values=function(){return Object.values(t)},e.remove=function(e){delete t[e]},e},as=0,os=0;var ss=function(e,t,r){var n=t&&r||0,i=t||[],a=(e=e||{}).node||ts,o=void 0!==e.clockseq?e.clockseq:rs;if(null==a||null==o){var s=nr();null==a&&(a=ts=[1|s[0],s[1],s[2],s[3],s[4],s[5]]),null==o&&(o=rs=16383&(s[6]<<8|s[7]))}var c=void 0!==e.msecs?e.msecs:(new Date).getTime(),d=void 0!==e.nsecs?e.nsecs:os+1,u=c-as+(d-os)/1e4;if(u<0&&void 0===e.clockseq&&(o=o+1&16383),(u<0||c>as)&&void 0===e.nsecs&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");as=c,os=d,rs=o;var l=(1e4*(268435455&(c+=122192928e5))+d)%4294967296;i[n++]=l>>>24&255,i[n++]=l>>>16&255,i[n++]=l>>>8&255,i[n++]=255&l;var p=c/4294967296*1e4&268435455;i[n++]=p>>>8&255,i[n++]=255&p,i[n++]=p>>>24&15|16,i[n++]=p>>>16&255,i[n++]=o>>>8|128,i[n++]=255&o;for(var f=0;f<6;++f)i[n+f]=a[f];return t||or(i)},cs=sr;cs.v1=ss,cs.v4=sr;var ds=cs;function us(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ls(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?us(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):us(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ps=null,fs=null,hs=null,ms=null,vs=null,gs=!1,ys=null,bs=!1,_s=!1;function Ss(e){return e.streams.map((function(e){return{streamId:e.streamId,userId:e.clientId,has_audio:e.audio,has_video:e.video,is_screen:e.screen,profile_count:e.attributes.videoDescriptions.length,profiles:e.attributes.videoDescriptions.map((function(e){return{width:e.width,height:e.height,fps:e.framerate,maxSendKbps:e.maxkbps}}))}}))}var ws={Room:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e,r=aa();window.room=r,r.monitor=e.monitor,r.client=e.client,r.localStreams=is(),r.remoteStreams=is(),r.remoteUsers=is(),r.iceReusePcIdUpdate=function(){r.iceReusePcId=ds()},r.iceReusePcIdUpdate(),r.iceReuseIP="",r.bannedMsIp="",r._messageId=0,r._iceState="new",r.connectionManager=new Ra.ConnectionManager,r.dataChannel=null;var n=xr();function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";r.state!==e&&(r.monitor.eventLog("rtc_room_".concat(e),{message:t,log_type:qa}),r.dispatchEvent(sa({type:"connection-state-change",prevState:r.state,curState:e})),r.state=e)}function a(e,t){return!!(t&&e&&e.pc&&e.pc.pc_session_id===t.eventSessionId)||(et.warning("信令消息已过期",t,e&&e.getId()),r.monitor.eventLog("rtc_ignore_signaling_expired",ra(e),new Error(JSON.stringify(t))),!1)}function o(e){if(e&&(r.localStreams.forEach(i),r.remoteStreams.forEach(i)),r.dataChannel&&"open"===r.dataChannel.readyState){var t=!1;r.localStreams.forEach((function(e){n(e)&&(r.publish(e,e.getLocalOptions(),!0),t=!0)})),r.remoteStreams.forEach((function(e){return n(e)&&r.subscribe(e,e.getRemoteOptions(),!0)})),r.remoteStreams.forEach((function(e){(function(e){if(e.getState()!==Ta.SUCCESS)return!1;if(e.isAllActionsFinished())return!1;if(e._updateSubscribeStarttime&&a(e._updateSubscribeStarttime,2e3))return!1;return!0})(e)&&r.updateSubscribe(e,e.getEnableMediaType())})),t&&r.dispatchEvent(sa({type:"republish-stream"}))}function n(e){return e.getState()===Ta.FAILED}function i(e){e.getState()!==Ta.IDLE&&e.getState()!==Ta.SUCCESS&&e.getState()!==Ta.CLOSED&&(e.isIceConnected()||a(e._pubOrSubStarttime,5e3)||(e.remoteMSIp&&e.pc&&"failed"===e.pc.currentStatus&&"checking"===e.pc.lastStatus&&(r.bannedMsIp=e.remoteMSIp),e.setStateFailed(new Error("".concat(e.local?"publish":"subscribe"," stream failed because timeout not success")))))}function a(e,t){return new Date-e<t}}r.unifiedPeer=null,r.dataChannelSignaling=null,r.timer={},bs=!1,_s=!1,r.state=Ia.DISCONNECTED,r.Connection=Ra;var s=function(e,t){var n=e;if(et.debug("peerConnection.onaddstream Stream subscribed stream",n),n.setState(Ta.SUCCESS),n.player)et.warning("重置播放器中的音/视频流..."),n.player.updateSrcObject();else{var i=ca({type:"stream-subscribed",stream:n});r.dispatchEvent(i)}n&&t.stream&&(n.audioMuted?n.disableAudio():n.enableAudio(),n.videoMuted?n.disableVideo():n.enableVideo())};r.updateSpec=function(e,t,n){t&&L({roomId:r.monitor.getRoomId(),streamList:[e],config:t.config},"updateSubscribe",(function(){}))};var c=function(e,t){et.warning("createRemoteStreamConnection","streamId",e.getId());var n=e;return n.addPC(r.unifiedPeer),n.createOffer(!0,t)},d=function(e,t){var n=e;return n.addPC(r.unifiedPeer),n.createOffer(!1,t)};function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.streamId,n=r.remoteStreams.get(t);return et.debug("createRemoteStream 执行 是否已经存在： ".concat(!!n," 参数:  "),e),n||(et.debug("createRemoteStream创建了一次stream",t),(n=ns({streamId:t,initStreamId:e.initStreamId,uid:e.clientId,local:!1,audio:!!gs||e.audio,video:e.video,data:e.data,screen:e.screen,attributes:e.attributes,customData:e.customData})).on("added",s.bind(null,n)),r.remoteStreams.add(n.getId(),n),n.room=r,n.addPC(r.unifiedPeer)),n}var l=function(e){if(e.isReady)if(r.remoteStreams.has(e.streamId))et.warning("this remote stream has in remoteStreams",e.streamId);else{var t;if(r.client.id!==e.clientId){t=u(e),gs&&!t.fixedAudio&&(t.audio=!1);var n=ca({type:"stream-added",stream:t});r.dispatchEvent(n)}else{if(!(t=r.localStreams.values().find((function(t){return e.streamId===t.getServerId()}))))return void et.warning("delayed stream-add event",e.streamId);if(t.isManualPublished){var i=ca({type:"stream-added",stream:t});r.dispatchEvent(i),t.isManualPublished=!1}}E(!t.hasDisableAudio(),t),R(!t.hasDisableVideo(),t)}},p=function(e){var t=sa({type:"custom-message",message:e});r.dispatchEvent(t)};function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=r.remoteUsers.keys(),n=e.map((function(e){return e.clientId}));n.forEach((function(n){if(!t.includes(n)){var i=e.find((function(e){return e.clientId===n}));r.remoteUsers.add(i.clientId,i);var a=sa({type:"userConnection",message:i});r.emit(a)}})),t.forEach((function(e){if(!n.includes(e)){var t=r.remoteUsers.get(e);r.remoteUsers.remove(e);var i=sa({type:"userDisconnection",message:t});setTimeout((function(){return r.emit(i)}),0)}}))}var h=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null!=t&&null!==(e=t.roomAttributes)&&void 0!==e&&e.multiChatMode&&(gs=!0,et.debug("已切换至multiChatMode模式 from updateRoomAttributes"))},m=function(){var e=ve(ge.mark((function e(){var t,r,n,i=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=i.length>0&&void 0!==i[0]?i[0]:{}).streamId,r=t.message,(n=u(t)).hasBeenPusbTrack=!0,n.audio=!0,n.fixedAudio=!0,r.direction="onpushtrack",v(r,!0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function v(){return g.apply(this,arguments)}function g(){return(g=ve(ge.mark((function e(){var t,n,i=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]?i[0]:{},n=i.length>1?i[1]:void 0,ys||Promise.resolve().then(y),(!ys||!ys.sequenceId<t.sequenceId)&&(n&&r.unifiedPeer.negotiationing?et.warning("被丢弃"):ys=t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return b.apply(this,arguments)}function b(){return(b=ve(ge.mark((function e(){var t,n;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=ys){e.next=3;break}return e.abrupt("return");case 3:return et.warning("tounified-plan参数",t),e.next=6,r.unifiedPeer.toUnifiedPlan(t);case 6:return n=e.sent,e.next=9,r.unifiedPeer.resetRemoteDesc(n,t.sequenceId);case 9:return e.next=11,new Promise((function(e){return setTimeout(e,100)}));case 11:if(!(t.sequenceId>=ys.sequenceId)){e.next=15;break}ys=null,e.next=17;break;case 15:return e.next=17,y();case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.streamId,n=(e.message,r.remoteStreams.get(e.streamId));n&&(n.audio=!1,n.fixedAudio=!1,n.hasBeenPusbTrack=!1,r.unifiedPeer&&r.unifiedPeer.stopTransceiver(n),n.hasBeenSubscribed||I(t))},S=function(e){e.attributes=e.attributes||{},r.remoteUsers.add(e.clientId,e);var t=sa({type:"userConnection",message:e});r.dispatchEvent(t)},w=function(e){r.remoteUsers.remove(e.clientId);var t=sa({type:"userDisconnection",message:e});r.dispatchEvent(t)},k=function(e,t,n){if("answer"===t.relayMessage.type){var i,o=t.streamId;if(o||(o=n.streamId),(i=r.remoteStreams.get(o))||(i=r.localStreams.values().find((function(e){return o===e.getServerId()}))),a(i,t)){r.monitor.eventLog("rtc_recv_answer",{direction:i.local?"up":"down",stream_id:i.getId(),stream_user_id:i.uid,pc_session_id:i.pc.pc_session_id,message:t.relayMessage}),i.local||mr(i.getId()),t.relayMessage.direction=e,v(t.relayMessage,!1);try{i._promiseCallback.resolve()}catch(e){}i.local&&i.isIceConnected()&&i.setState(Ta.SUCCESS),i.local||vr(i.getId())}}},C=function(e){var t=r.remoteStreams.get(e.streamId);t?(t.updateAttributesByServerEnd(e.attributes),!1===e.attributes.audiostream||!1===e.attributes.localaudio?E(!1,t):!0!==e.attributes.audiostream&&!0!==e.attributes.localaudio||E(!0,t),!1===e.attributes.videostream||!1===e.attributes.localvideo?R(!1,t):!0!==e.attributes.videostream&&!0!==e.attributes.localvideo||R(!0,t)):et.warning("此远端流尚未推送到本客户端",e.streamId)},A=function(e){var t=r.remoteUsers.get(e.clientId);t?(Object.assign(t.attributes,e.attributes),et.warning("socketOnUpdateUserAttributes",e,t.attributes)):(S(e),et.error("socketOnUpdateUserAttributes not found user, so add user",e)),r.remoteStreams.forEach((function(t){t.uid===e.clientId&&("boolean"==typeof e.attributes.enableaudio&&E(e.attributes.enableaudio,t),"boolean"==typeof e.attributes.enablevideo&&R(e.attributes.enablevideo,t))}))};function E(e,t){r.dispatchEvent(sa({type:"audio-enable",enable:e,stream:t}))}function R(e,t){t&&t.player&&t.player.video&&(et.debug("emitVideoEnable updateSrcObject"),t.player.updateSrcObject()),r.dispatchEvent(sa({type:"video-enable",enable:e,stream:t}))}var T=function(e){var t;if(et.warning("socketOnRemoveStream",e.streamId),r.client.id===e.clientId){if(!(t=r.localStreams.values().find((function(t){return e.streamId===t.getServerId()}))))return void et.warning("delayed stream-removed event",e.streamId);t.getState()===Ta.CONNECTING?et.warning("推流未成功就失败，或者停止推流未成功就开始再次推流"):t.getState()!==Ta.CLOSED&&t.setStateFailed(new Error("local stream removed by server"))}else I(e.streamId)},I=function(e){var t=r.remoteStreams.get(e);if(t){r.remoteStreams.remove(e),t.removeLivingStream();var n=ca({type:"stream-removed",stream:t});r.dispatchEvent(n)}},x=function(e){var t;if(e.streamId&&(et.error("[signal on] streamFailed",e.streamId,e.type,r.state.toString(),JSON.stringify(e.message)),a(t="publish"===e.type?r.localStreams.values().find((function(t){return e.streamId===t.getServerId()})):r.remoteStreams.get(e.streamId),e)))if(e.message&&400<=e.message.code&&e.message.code<500){var n=new Error(e.message.message);n.code=e.message.code,r.monitor.eventLog("rtc_signaling_failed",ra(t),n),t.setState(Ta.CLOSED),t._promiseCallback.reject(n)}else t.setStateFailed(new Error(JSON.stringify(e.message)))},P=function(e,t,r){return{state:e,audio:t.hasAudio(),video:t.hasVideo(),screen:t.hasScreen(),attributes:t.getAttributes(),metadata:r.metadata,createOffer:r.createOffer,muteStream:r.muteStream,customData:r.customData,transportType:r.transportType||void 0}},O=function(e,t){var n=t,i=e.streamId;return i?(et.debug("Stream published",e),n.setId(i),n.room=r,!0):(et.error("Error when publishing the stream",e,n&&n.getId()),!1)},D=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=e,o=P("relay",i,t),s=new Date;o.initStreamId=i.getId(),o.minVideoBW=t.minVideoBW,o.scheme=t.scheme,r.monitor.eventLog("rtc_begin_create_offer",{direction:"up",stream_id:i.getId(),event_starttime:s,stream_user_id:i.uid}),d(i,t).then(function(){var e=ve(ge.mark((function e(t){var c,d,u;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=function(e){var t=e.sdp.split("\r\n");t.splice(4,0,"a=pli-relay");var r=t.join("\r\n");return new RTCSessionDescription({sdp:r,type:e.type})},i.saveOffer(t),c=u(t),e.next=5,r.unifiedPeer.toPlanB(c);case 5:d=e.sent,o.sdpInfo=d,o.sdpInfo.msid=i.stream.id,o.streamId=i.getId()===i.getServerId()?void 0:i.getServerId(),o.currentStreamId=i.getServerId(),r.monitor.eventLog("rtc_create_offer",{direction:"up",stream_id:i.getId(),stream_user_id:i.uid,pc_session_id:i.pc.pc_session_id,event_starttime:s,message:d}),i.pc.isSinglePC()?(o.peerConnectionId=r.iceReusePcId,o.expectedMSAddr=r.iceReuseIP):r.bannedMsIp&&(o.feedbackInfo=M()),i.pc&&(o.eventSessionId=i.pc.pc_session_id,o.pc_session_id=i.pc.pc_session_id),L(o,"publish",(function(e,t){e?n(e):a(i,t)&&(O(t,i)?(n(null,t),k("publish",t)):n(t))}));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n)};function M(){return et.warning("msip: ".concat(r.bannedMsIp)),r.monitor.eventLog("force_update_media_server_ip",{message:"banned Ip: ".concat(r.bannedMsIp," reason: ICE_FAILED")}),{msIP:r.bannedMsIp,message:"ICE_FAILED"}}var B=function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},o=e,s=n,d=new Date;s.maxVideoBW=s.maxVideoBW||t.defaultVideoBW,s.maxVideoBW>t.maxVideoBW&&(s.maxVideoBW=t.maxVideoBW),s.video="boolean"==typeof s.video?s.video:o.hasVideo(),s.data=void 0===s.data||s.data,o.checkOptions(s);var u={streamId:o.getServerId(),audio:!0,video:!0,data:!0,browser:pa(),createOffer:s.createOffer,metadata:s.metadata,muteStream:s.muteStream,slideShowMode:s.slideShowMode,transportType:s.transportType||void 0,config:{enableMediaType:o.getEnableMediaType(),qualityLayer:s.qualityLayer}};fr(o.getId()),r.monitor.eventLog("rtc_begin_create_offer",{direction:"down",stream_id:o.getId(),event_starttime:d,stream_user_id:o.uid}),c(o,s).then(function(){var e=ve(ge.mark((function e(t){var n;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.saveOffer(t),e.next=3,r.unifiedPeer.toPlanB(t);case 3:n=e.sent,u.sdpInfo=n,u.eventSessionId=o.pc.pc_session_id,u.pc_session_id=o.pc.pc_session_id,r.monitor.eventLog("rtc_create_offer",{direction:"down",stream_id:o.getId(),stream_user_id:o.uid,pc_session_id:o.pc.pc_session_id,event_starttime:d,message:n}),o.pc.isSinglePC()?(u.peerConnectionId=r.iceReusePcId,u.expectedMSAddr=r.iceReuseIP):r.bannedMsIp&&(u.feedbackInfo=M()),ia(o.uid,"stream ".concat(o.getId()," has no uid")),o.uid&&(u.streamUserId=o.uid),hr(o.getId()),L(u,"subscribe",(function(e,t,r){(e||a(o,t))&&(i(e,t),k("subscribe",t,r))}));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i)};function L(e,t,n){"open"===r.dataChannel.readyState&&r.dataChannelSignaling.sendSignaling(t,e).then((function(t){n(null,t,e)})).catch((function(e){n(e)}))}function N(){r.unifiedPeer.on("ice-state-change",(function(e){var t=e.state;switch(t){case"failed":case"closed":if("connected"===r._iceState||"completed"===r._iceState||hs){if(r.state!==Ia.DISCONNECTED){r._pcReconnectedCount++,n=xr(),r.dataChannelSignaling.destroy(),r.unifiedPeer.peerConnection.close(),_s=!0;var i="function"==typeof ps?ps:function(e){e&&setTimeout((function(){r.monitor.eventLog("rtc_reconnect",{error_code:0,message:e.message||"重新连接"}),r.unifiedPeer.emit({type:"ice-state-change",state:"failed"})}),3e3)};r.join(fs,i,!0)}}else"function"==typeof ps&&(ps(new tr("ice连接失败",tr.JOIN_ROOM_ERROR)),ps=null);break;case"connected":case"completed":r._iceState=t}r.emit(sa({type:"ice-state-change",state:t}))}))}function j(){return new Promise((function(e,t){r.dataChannel.onopen=function(){r.dataChannelSignaling=new Po(r.dataChannel,r.monitor),F(),e()};var n=function(){"connected"!==r._iceState&&"completed"!==r._iceState||r.unifiedPeer.emit({type:"ice-state-change",state:"failed"})};r.dataChannel.onerror=n,r.dataChannel.onclose=n}))}function F(){r.dataChannelSignaling&&(r.dataChannelSignaling.on("onUpdateRoomAttributes",h),r.dataChannelSignaling.on("onPushTrack",m),r.dataChannelSignaling.on("onRemoveTrack",_),r.dataChannelSignaling.on("userConnection",S),r.dataChannelSignaling.on("userDisconnection",w),r.dataChannelSignaling.on("onAddStream",l),r.dataChannelSignaling.on("onRemoveStream",T),r.dataChannelSignaling.on("streamFailed",x),r.dataChannelSignaling.on("onUpdateStreamAttributes",C),r.dataChannelSignaling.on("onUpdateUserAttributes",A),r.dataChannelSignaling.on("onCustomMessage",p),r.dataChannelSignaling.on("tokenFailed",G),r.dataChannelSignaling.on("signalServerFailed",W),r.dataChannelSignaling.on("disconnect",H),r.dataChannelSignaling.on("reconnected",q),r.dataChannelSignaling.on("socketConnecting",Z),["user-message-received","p2p-message-send-success","p2p-message-send-failed"].forEach((function(e){r.dataChannelSignaling.on(e,(function(t){var n=sa({type:e,message:t});r.dispatchEvent(n)}))})),r.dataChannelSignaling.on("nodeChange",(function(e){var t=e.nodes,n=e.reason;bs=!0,r.monitor.eventLog("rtc_node_change",{error_code:0,reason:JSON.stringify(n),message:JSON.stringify(t)}),Array.isArray(t)&&t.length?hs=t[0]:ms=n,r.unifiedPeer.emit({type:"ice-state-change",state:"failed"})})))}function U(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return function(a,o){if(a)return et.error("process token response error in room",a&&a.message),void n(a);i(Ia.CONNECTED),o.msIP&&(r.iceReuseIP=o.msIP),o.iceServers&&o.iceServers[0]&&o.iceServers[0].url?r.iceServers=[]:r.iceServers=o.iceServers,t.defaultVideoBW=o.defaultVideoBW,t.maxVideoBW=o.maxVideoBW,r.remoteStreams.values().forEach((function(e){return e.addPC(r.unifiedPeer)})),e?q(o):(r.emit(sa({type:"login-completion",streams:Ss(o)})),f(o.clientsDetail),setTimeout((function(){return o.streams.forEach((function(e){return l(e)}))}),0)),n(null,o)}}function V(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=e,o=n;if(a.uid=r.client.id,o.maxVideoBW=o.maxVideoBW||t.defaultVideoBW,o.maxVideoBW>t.maxVideoBW&&(o.maxVideoBW=t.maxVideoBW),void 0===o.minVideoBW&&(o.minVideoBW=0),o.minVideoBW>t.defaultVideoBW&&(o.minVideoBW=t.defaultVideoBW),a.forceTurn=o.forceTurn,o.simulcast=o.simulcast||!1,a&&a.local)D(a,o,i);else{var s="cannot publish";a?a.local||(s="trying to publish no local stream:"+a.getId()):s="trying to publish null stream",et.error(s),i(new Error(s))}}function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=e,i=t;if(n&&!n.local){if(!n.hasMedia())return et.warning("There's nothing to subscribe to",n&&n.getId()),void r(new Error("Nothing to subscribe to"));n.hasVideo()||n.hasScreen()||(i.video=!1),n.hasAudio()||(i.audio=!1),n.forceTurn=i.forceTurn,B(n,i,r),et.info("Subscribing to: ".concat(n.getId()))}else{var a="Error on subscribe";n?n.local&&(a="Cannot subscribe to local stream, you should subscribe to the remote version of your local stream:"+n.getId()):a="Cannot subscribe to invalid stream",et.error(a),r(new Error(a))}}r.join=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];i(Ia.CONNECTING),ps=t,fs=e,r.unifiedPeer=r.connectionManager.getOrCreateConnection({room:r},n),r.dataChannel=r.unifiedPeer.peerConnection.createDataChannel("sigling",{negotiated:!1});var s=null;if(ms&&vs)try{s=[{feedbackIP:vs.publicIPs[0].ip,feedbackReason:{type:"NodeChanged",reason:ms}}]}catch(e){}var c=new _o(r.unifiedPeer.peerConnection,ls(ls({},e.params),{},{role:e.role,expectedAddr:e._mediaServerAddr}),r.monitor,hs,s);c.connect().then((function(){r.unifiedPeer.iceOptions=c.offerAndAnswerICEOptions,clearInterval(r.streamCheckInterval),r.streamCheckInterval=setInterval((function(){return o(!0)}),1e3),vs=c.iceConfig,hs=null,ms=null})).catch((function(e){return t(e)})),N(),j().then(ve(ge.mark((function n(){return ge.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.unifiedPeer.getDefaultSDP();case 2:e.sdpInfo=n.sent,e.options?e.options.enableUnBundleMode=!0:e.options={enableUnBundleMode:!0},L(e,bs||_s?"reconnected":"joinRoom",U(a,(function(e,r){var n;ps=null,null!=r&&null!==(n=r.roomAttributes)&&void 0!==n&&n.multiChatMode&&(gs=!0,et.debug("已切换至multiChatMode模式")),t(e,r)})));case 6:case"end":return n.stop()}}),n)}))))},r.sendP2PMessage=function(e,t){if("open"!==r.dataChannel.readyState)return Promise.reject(new tr("未在房间中",tr.GET_ROOM_INVALID_RESPONSE));"string"!=typeof t&&(t=JSON.stringify(t));var n={ver:1,id:r._messageId++,time:Date.now(),dir:wo.MESSAGE_DIRECTION_SEND,type:ko,err:Co,app:r.monitor.getAppId(),room:r.monitor.getRoomId(),from:r.monitor.getUserId(),to:e,msg:t};return r.dataChannelSignaling.sendP2PMessage(n)},r.registerAckCallbackAndSendSignaling=L,r.renewToken=function(e,t){L(e,"reconnected",U(!0,t))},r.renewSchedule=function(e,t){},r.reset=function(){clearInterval(r.streamCheckInterval),r.localStreams.forEach((function(e){return r.unpublish(e)})),r.localStreams=is(),r.remoteStreams.forEach((function(e){e&&(e.close(),r.dispatchEvent(ca({type:"stream-removed",stream:e})))})),r.remoteStreams=is(),r.remoteUsers=is(),r.connectionManager.reset(),r.connectionManager=null,r.dataChannel=null,r.unifiedPeer=null,r.dataChannelSignaling=null,r.timer=null},r.leaveRoom=function(e,t){return new Promise((function(n,a){L(e,"leaveRoom",(function(e,o){if(e)return et.error("leaveRoom error",e&&e.message),void a(e);et.debug("disconnect room"),i(Ia.DISCONNECTED,t);try{r.dataChannel&&"open"===r.dataChannel.readyState&&r.dataChannel.close(),r.unifiedPeer.peerConnection&&"completed"===r.unifiedPeer.peerConnection.iceConnectionState&&r.unifiedPeer.peerConnection.close()}catch(e){et.error("datachannel close error",e&&e.message)}r.reset(),n(o)}))}))},r.publish=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,a=e;return et.debug("[API INNER] call publish..."),a.setLocalOptions(n),i||r.localStreams.has(e.getId())||(r.localStreams.add(e.getId(),e),e.isManualPublished=!0),e.setState(Ta.CONNECTING),e.__logSignaling.event_starttime||(e.__logSignaling={event_starttime:new Date}),e._pubOrSubStarttime=new Date,t=i&&e._promiseCallback?Promise.resolve():new Promise((function(t,r){e._promiseCallback={resolve:t,reject:r}})),V(e,n,(function(t){t&&(et.error("[inner publish error]",t&&t.message),ia("open"===r.dataChannel.readyState,"publish finished with err: ".concat(t.message,", but signaling state is not Connected.")),"open"===r.dataChannel.readyState&&414===t.code?400<=t.code&&t.code<500&&(e.setState(Ta.CLOSED),e.pc.close(),e._promiseCallback.reject(t)):(e.setStateFailed(t),et.error("stream failed because publish error",t&&t.message,e.getId())))})),t},r.unpublish=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=e;if(n){n.local||t(new Error("Cannot unpublish, stream does not exist or is not local")),r.unifiedPeer&&r.unifiedPeer.stopTransceiver(n);var i=n.getServerId();if(et.debug("unpublish",i),n.removeLivingStream(),n.removePC(),r.localStreams.has(n.getId())){r.localStreams.remove(n.getId());var a=ca({type:"stream-removed",stream:n});r.dispatchEvent(a),L({streamId:i},"unpublish",t)}else t(null)}else t(new Error("can not unpublish null stream"))},r.subscribe=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,a=e;return a.hasBeenSubscribed=!0,a.local||pr(a.getId()),a.setRemoteOptions(n),et.debug("[API INNER] call subscribe..."),e.setState(Ta.CONNECTING),e.__logSignaling.event_starttime||(e.__logSignaling={event_starttime:new Date}),e._pubOrSubStarttime=new Date,t=i&&e._promiseCallback?Promise.resolve():new Promise((function(t,r){e._promiseCallback={resolve:t,reject:r}})),z(e,n,(function(t){t&&(et.error("[inner subscribe error]",t&&t.message),ia("open"===r.dataChannel.readyState,"subscribe finished with err: ".concat(t.message,", but signaling state is not Connected.")),"open"===r.dataChannel.readyState?400<=t.code&&t.code<500&&(e.setState(Ta.CLOSED),e.pc&&e.pc.close(),e._promiseCallback.reject(t)):(e.setStateFailed(t),et.error("stream failed because subscribe error",t&&t.message,e&&e.getId())))})),t},r.unsubscribe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=e;if(r.hasBeenSubscribed=!1,r){r.local&&t(new Error("Cannot unsubscribe, stream does not exist or is local"));var n=r.getServerId();et.debug("unsubscribe",r.getId());var i={audio:!0,video:!0};gs?(i.audio=!1,r.hasBeenPusbTrack||r.removeLivingStream()):r.removeLivingStream(),L(ls({streamId:n},i),"unsubscribe",t)}else t(new Error("can not unsubscribe null stream"))},r.updateSubscribe=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=e;n.setEnableMediaType(t),n._updateSubscribeStarttime=new Date,et.debug("[API INNER] call updateSubscribe...");var i={streamList:[n.getServerId()],config:{enableMediaType:{video:t.video,audio:t.audio}}};n.actions.updateSubscribeState=xa.COMMITING,L(i,"updateSubscribe",(function(e,t){e||(n.actions.updateSubscribeState=xa.FINISHED),r(e,t)}))},r.getStreamsByAttribute=function(e,t){var n=[];return r.remoteStreams.forEach((function(r){void 0!==r.getAttributes()&&r.getAttributes()[e]===t&&n.push(r)})),n},r.getLocalAudioStats=function(){var e={};return r.localStreams.forEach((function(t){t.getState()===Ta.SUCCESS&&(e[t.uid]=t.getAudioStats())})),e},r.getLocalVideoStats=function(){var e={};return r.localStreams.forEach((function(t){t.getState()===Ta.SUCCESS&&(e[t.uid]=t.getVideoStats())})),e},r.getRemoteAudioStats=function(){var e={};return r.remoteStreams.forEach((function(t){t.getState()===Ta.SUCCESS&&(e[t.uid]=t.getAudioStats())})),e},r.getRemoteVideoStats=function(){var e={};return r.remoteStreams.forEach((function(t){t.getState()===Ta.SUCCESS&&(e[t.uid]=t.getVideoStats())})),e};var G=function(e){r.dispatchEvent(sa({type:"tokenFailed",message:e.message,code:e.code}))},W=function(e){r.dispatchEvent(sa({type:"signalServerFailed",message:e.message,code:e.code}))},H=function(e){i(Ia.DISCONNECTED,e),r.dispatchEvent(sa({type:"warning",message:"bad network, reconnecting",code:tr.ROOM_RECONNECTING}))},q=function(e){et.warning("socketOnReconnected response",e,"that.remoteStreams.keys():",r.remoteStreams.keys(),"that.localStreams.keys():",r.localStreams.keys()),f(e.clientsDetail),i(Ia.CONNECTED),!1===e.clientExist&&J();var t=e.streams.filter((function(e){return e.clientId!==r.client.id})),n=t.filter((function(e){return!r.remoteStreams.has(e.streamId)}));et.debug("【需要onAddStream】newRemoteStreams",n);var a=r.remoteStreams.keys().filter((function(e){return!t.find((function(t){return t.streamId===e}))}));et.debug("【需要unsubscribe】oldRemoteStreamIds",a),a.forEach((function(e){return I(e)})),n.forEach((function(e){return l(e)}));var o=e.streams.filter((function(e){return e.clientId===r.client.id})),s=r.localStreams.keys().filter((function(e){return!o.find((function(t){return t.initStreamId===e}))}));et.debug("【需要重新publish】republishStreamIds",s);var c=o.filter((function(e){return!r.localStreams.has(e.initStreamId)}));et.debug("【需要unpublish】removedPublishStreams",c),c.forEach((function(e){return L({streamId:e.streamId},"unpublish",(function(){}))})),s.forEach((function(e){r.localStreams.get(e).setStateFailed(new Error("room not has this publish stream after rejoinroom"))}))},J=function(){var e=new Error("client not exist");r.localStreams.values().forEach((function(t){return t.setStateFailed(e)})),r.remoteStreams.values().forEach((function(t){return t.setStateFailed(e)}))},Z=function(){i(Ia.CONNECTING)};return r},LicodeEvent:oa,RoomEvent:sa,StreamEvent:ca,Stream:ns,Logger:et,Player:Bo,Events:la,constants:Pa},ks=function(){for(var e,t,r=-1,n=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],i=[],a=0;a<n.length;a+=1)i[n[a]]=a;var o=function(r){e=r,t=0},s=function(){if(!e)return r;if(t>=e.length)return r;var n=255&e.charCodeAt(t);return t+=1,n},c=function(){if(!e)return r;for(;;){if(t>=e.length)return r;var n=e.charAt(t);if(t+=1,i[n])return i[n];if("A"===n)return 0}},d=function(e){var t=e.toString(16);return 1===t.length&&(t="0".concat(t)),t="%".concat(t),unescape(t)};return{encodeBase64:function(e){var t,i,a;o(e),t="";var c=new Array(3);for(i=0,a=!1;!a&&(c[0]=s())!==r;)c[1]=s(),c[2]=s(),t+=n[c[0]>>2],c[1]!==r?(t+=n[c[0]<<4&48|c[1]>>4],c[2]!==r?(t+=n[c[1]<<2&60|c[2]>>6],t+=n[63&c[2]]):(t+=n[c[1]<<2&60],t="".concat(t,"="),a=!0)):(t+=n[c[0]<<4&48],t="".concat(t,"="),t="".concat(t,"="),a=!0),(i+=4)>=76&&(t="".concat(t,"\n"),i=0);return t},decodeBase64:function(e){var t,n;o(e),t="";var i=new Array(4);for(n=!1;!n&&(i[0]=c())!==r&&(i[1]=c())!==r;)i[2]=c(),i[3]=c(),t+=d(i[0]<<2&255|i[1]>>4),i[2]!==r?(t+=d(i[1]<<4&255|i[2]>>2),i[3]!==r?t+=d(i[2]<<6&255|i[3]):n=!0):n=!0;return t}}}();function Cs(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function As(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?Cs(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Cs(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Es(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rtc",n=!1,i=e.reduce((function(e,i){var a=sr(),o=Ir(i),s=As(As({},t),{},{configID:a}),c=Date.now();Ki(r+"_get_config",{type:"request",error_code:0,message:s,host:o,config_id:a,event_starttime:c});var d=Rr(i),u=null;return d?(u=Promise.resolve(d),Ki(r+"_get_config",{type:"cache",error_code:0,message:d,host:o,config_id:d.config_id,event_starttime:c})):u=br(i,s).then((function(e){if(Ki(r+"_get_config",{type:"server",error_code:0,message:e,host:o,config_id:a,event_starttime:c}),!n)return Ar(i,Object.assign(e,{config_id:a})),Qi(o),n=!0,e}),(function(e){return Ki(r+"_get_config",{type:"server",error_code:9992,message:e,host:o,config_id:a,event_starttime:c}),new Promise((function(t,r){return r(e)}))})),e.push(u),e}),[]);return dr(i)}function Rs(){return(Rs=ve(ge.mark((function e(t){var r,n,i=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},n={deviceType:"web",deviceID:Yi(),appID:r.appId,businessID:r.businessId,roomID:r.roomId,userID:r.userId,ip:r._userAgentIP||void 0,labelSelector:"sdkVersion=".concat(Oa.version),keys:t},e.prev=2,e.next=5,Es(Oa.configServerUrls,n,"rtc");case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),e.next=12,Es(Oa.configServerUrls,n,"rtc");case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function Ts(){return(Ts=ve(ge.mark((function e(t){var r,n,i=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},n={deviceType:"web",deviceID:Yi(),appID:r.appId,businessID:r.businessId,roomID:r.roomId,userID:r.userId,ip:r._userAgentIP||void 0,labelSelector:"sdkVersion=".concat(Oa.version),keys:t},e.prev=2,e.next=5,Es(Oa.onerConfigServerUrls,n,"oner");case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),e.next=12,Es(Oa.onerConfigServerUrls,n,"oner");case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function Is(e,t,r,n){return e?"Bearer "+e:"Basic "+function(e,t,r){return ks.encodeBase64([e,t,r].join(":"))}(t,r,n)}var xs=Object.freeze({__proto__:null,getServerConfig:function(e){return Rs.apply(this,arguments)},getOnerServerConfig:function(e){return Ts.apply(this,arguments)},tokenToAuthorization:Is});function Ps(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then((function(t){var r=t.filter((function(e){return""!==e.label}));e(r)}),t):t(new Error("Please make sure your website enables 'https' protocol. If there is still a problem, maybe your browser does not support webrtc"))}function Os(){var e,t={},r=function(){return n().os},n=(e=function(){var e,t=navigator.userAgent,r=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(r[1]))return{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""};"Chrome"===r[1]&&null!=(e=t.match(/(OPR(?=\/))\/?(\d+)/i))&&(r=e),"Chrome"===r[1]&&null!=(e=t.match(/(mqqbrowser(?=\/))\/?(\d+)/i))&&(r=e),"Chrome"===r[1]&&null!=(e=t.match(/(micromessenger(?=\/))\/?(\d+)/i))&&(r=e),"Safari"===r[1]&&null!=(e=t.match(/version\/(\d+)/i))&&(r[2]=e[1]);var n=void 0,i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var a in i){var o=i[a];if(o.r.test(navigator.userAgent)){n=o.s;break}}return{name:r[1],version:r[2],os:n}}(),function(){return e});return t.getBrowserInfo=n,t.getBrowserVersion=function(){return n().version},t.getBrowserOS=r,t.isChrome=function(){var e=n();return e.name&&"Chrome"===e.name},t.isSafari=function(){var e=n();return e.name&&"Safari"===e.name},t.isFireFox=function(){var e=n();return e.name&&"Firefox"===e.name},t.isOpera=function(){var e=n();return e.name&&"OPR"===e.name},t.isQQBrowser=function(){var e=n();return e.name&&"MQQBrowser"===e.name},t.isWeChatBrowser=function(){var e=n();return e.name&&"MicroMessenger"===e.name},t.isSupportedPC=function(){var e=r();return"Linux"===e||"Mac OS X"===e||"Mac OS"===e||-1!==e.indexOf("Windows")},t.isSupportedMobile=function(){var e=r();return"Android"===e||"iOS"===e},t}var Ds=window.AudioContext||window.webkitAudioContext,Ms=null,Bs=null,Ls=null,Ns=function(){function e(){if(Ce(this,e),Ms)return Ms;Ms=this}var t,r;return Ee(e,[{key:"mixMediaStream",value:function(e){this._localSource&&this._localSource.disconnect(this.localGainNode),this._localSource=this.sharedAudioContext.createMediaStreamSource(e),this._localSource.connect(this.localGainNode).connect(this.audioDestionation)}},{key:"mixMp3File",value:(r=ve(ge.mark((function e(t){var r,n,i,a,o,s,c,d,u=this;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.filePath,t.cacheResource,n=t.cycle,i=t.loop,a=t.playTime,o=void 0===a?0:a,s=t.muted,c=void 0!==s&&s,d=t.replace,this._mp3Audio&&(this._mp3Audio.pause(),this._mp3Audio=null),this._mp3Source&&this._mp3Source.disconnect(this.mp3GainNode),this._mp3Audio=new Audio(r),i?this._mp3Audio.loop=!0:n>0&&(this._mp3Audio.cycle=parseInt(n),this._mp3Audio.onended=function(){u._mp3Audio.cycle-- >0&&u._mp3Audio.play()}),o&&(this._mp3Audio.currentTime=o/1e3),d&&(this.localGainNode.value=0),e.next=9,this._mp3Audio.play();case 9:this._mp3Source=this.sharedAudioContext.createMediaElementSource(this._mp3Audio),this._mp3Source.connect(this.mp3GainNode).connect(this.audioDestionation),c?(this.mp3GainNode.lastConnectToDestination&&this.mp3GainNode.disconnect(Bs.destination),this.mp3GainNode.lastConnectToDestination=!1):(this.mp3GainNode.connect(Bs.destination),this.mp3GainNode.lastConnectToDestination=!0);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"stopMix",value:function(){this._mp3Audio.pause(),this._mp3Source.disconnect(this.mp3GainNode),this._localSource.disconnect(this.localGainNode),this.mp3GainNode.disconnect(this.audioDestionation),this.localGainNode.disconnect(this.audioDestionation),this.mp3GainNode.lastConnectToDestination&&this.mp3GainNode.disconnect(Bs.destination)}},{key:"getAudioMixingDuration",value:function(){return 1e3*this._mp3Audio.duration}},{key:"getAudioMixingCurrentPosition",value:function(){return 1e3*this._mp3Audio.currentTime}},{key:"setAudioMixingPosition",value:(t=ve(ge.mark((function e(t){var r,n=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:function(){},e.prev=1,this._mp3Audio.currentTime=t/1e3,e.next=5,this._mp3Audio.play();case 5:r(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),r("play failed");case 11:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e){return t.apply(this,arguments)})},{key:"getAudioMixingVolume",value:function(){return this._mp3GainNode.gain.value}},{key:"adjustAudioMixingVolume",value:function(e){this._mp3GainNode.gain.value=Number(e)/100}},{key:"isSupport",value:function(){return!!Ds}},{key:"pauseMp3",value:function(){this._mp3Audio.pause()}},{key:"resumeMp3",value:function(){return this._mp3Audio.play()}},{key:"mixTrack",get:function(){return this.audioDestionation.stream.getAudioTracks()[0]}},{key:"sharedAudioContext",get:function(){return Bs||(Bs=Ds?new Ds:null,ia(Bs,"not support sharedAudioContext"),Bs&&ia("suspended"!==Bs.state,"AudioContext is suspending")),Bs}},{key:"audioDestionation",get:function(){return Ls||(Ls=Bs.createMediaStreamDestination()),Ls}},{key:"mp3GainNode",get:function(){return this._mp3GainNode||(this._mp3GainNode=Bs.createGain(),this._mp3GainNode.gain.value=1),this._mp3GainNode}},{key:"localGainNode",get:function(){return this._localGainNode||(this._localGainNode=Bs.createGain(),this._localGainNode.gain.value=1),this._localGainNode}}]),e}(),js=ws.constants,Fs=(js.DC_MESSAGE_CODE,js.DC_MESSAGE_DIRECTION,js.DC_MESSAGE_FUNCTION_TYPE,new Map),Us=function(e){var t=e,r=new Ns,n=null,i=Fs.get(t.stream);if(i)return i;var a,o,s,c,d=zs();function u(e,t,r){d.stream.stream&&d.stream.stream.getTracks().forEach((function(n){h("rtc_permission",{permission_type:n.kind,authorization_status:!0,message:"permission_authored"}),h("rtc_create_media",Object.assign({media_type:n.kind},e),t,r)}))}function l(){return d.stream&&d.stream.pc&&d.stream.pc.peerConnection&&d.stream.pc.peerConnection}function p(e){return f.apply(this,arguments)}function f(){return(f=ve(ge.mark((function e(t){var r,n,i,a,o,s=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=s.length>1&&void 0!==s[1]?s[1]:function(){},n=s.length>2&&void 0!==s[2]?s[2]:function(){},i=Vs(So,n),d.stream.local){e.next=6;break}return i("Only work for local steam"),e.abrupt("return");case 6:if(t instanceof MediaStreamTrack){e.next=9;break}return i("Invalid track."),e.abrupt("return");case 9:if(a=l()){e.next=13;break}return i("peerconnection not prepared"),e.abrupt("return");case 13:if(e.prev=13,o=a.getSenders().find((function(e){return e.track.kind===t.kind})),o.track===t){e.next=19;break}return e.next=19,o.replaceTrack(t);case 19:r(),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(13),i("error happens in replacing track."),ia(!1,"replaceTrack: ".concat(e.t0.message));case 26:case"end":return e.stop()}}),e,null,[[13,22]])})))).apply(this,arguments)}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;Ki(e,Object.assign(ra(d.stream),t),r,n)}function m(e){var t=e&&Za[e];return t?{sampleRate:t[0],stereo:t[1],bitrate:t[2]}:{}}return d.class="VStream",d.videoParam={},d.client=null,window.navigator.userAgent.match(/firefox/i)||(d.videoParam={videoSize:[120,120,640,480],videoFrameRate:[10,15],minVideoBW:parseInt(500/3),maxVideoBW:500}),d._audioProfile="music_standard",d.audioParam=m(d._audioProfile),Fs.set(t.stream,d),t.stream?(Object.defineProperty(d,"stream",{value:t.stream,enumerable:!1}),d.stream.on("track-ended",(function(e){d.emit({type:"track-ended",message:"".concat(e.stream.kind," track ended"),code:tr.TRACK_ENDED}),d.stream.room?d.getMediaStream().getTracks().every((function(e){return"ended"===e.readyState}))&&d.stream.room.unpublish(e.stream,(function(e,t){e?et.error("stream-ended unpublish error",e):et.debug("stream-ended unpublish result",t)})):et.error("track-ended that.stream.room null",d.stream.room)})),d.stream.on("bandwidth-alert",(function(e){d.dispatchEvent({type:e.type,message:e.message,bandwidth:e.bandwidth})})),d.stream.on("data-channel-open",(function(e){})),d.stream.on("data-channel-close",(function(e){})),d.stream.on("message-received",(function(e){})),d.stream.on("send-message-failed",(function(e){})),d.stream.on("decoder-error",(function(e){d.emit({type:e.type,message:e.message})})),d.stream.local?(d.stream.on("first-local-audio-render",lr((function(e){d.stream.room&&d.stream.room.emit({type:e.type,stream:d})}))),d.stream.on("first-local-video-render",lr((function(e){d.stream.room&&d.stream.room.emit({type:e.type,stream:d})})))):(d.stream.on("first-remote-audio-render",lr((function(e){d.stream.room&&d.stream.room.emit({type:e.type,stream:d})}))),d.stream.on("first-remote-video-render",lr((function(e){d.stream.room&&d.stream.room.emit({type:e.type,stream:d})}))))):et.error(new Error("new VStream error"),t),["enableAudio","disableAudio","enableVideo","disableVideo","unmuteAudio","muteAudio","unmuteVideo","muteVideo","play","stop","mirror","isAudioPlaying","playAudio","getId","hasAudio","hasVideo","getCustomData","_setStaticQualityLayer","getRttMean"].forEach((function(e,t){d[e]=function(){return t<13&&h("rtc_sdk_api_call",{sdk_api_name:e}),d.stream[e].apply(d.stream,arguments)}})),d.init=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};h("rtc_sdk_api_call",{sdk_api_name:"stream.init"});var n={event_starttime:new Date};if(d.stream.setAudioParam(d.audioParam),t.mediaStream)return et.warning("spec.mediaStream",t.mediaStream),d.stream.setMediaStream(t.mediaStream),u(n,null,{stream_source:"mediaStream"}),void e();d.stream.on("access-accepted",function(){var t=ve(ge.mark((function t(r){return ge.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:et.debug("Access to webcam and/or microphone granted",r),d.dispatchEvent(Hs({type:"accessAllowed"})),u(n,null,r),e();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),d.stream.on("access-denied",function(){var e=ve(ge.mark((function e(i){var a;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(et.error("Access to webcam and/or microphone rejected",i),a=tr.VDM_CAMERA_NOT_AUTHORIZED,!t.audio){e.next=15;break}return e.prev=3,e.next=6,navigator.mediaDevices.getUserMedia({audio:t.audio});case 6:e.sent.getAudioTracks().forEach((function(e){return e.stop()})),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(3),a=tr.ADM_NO_PERMISSION,h("rtc_permission",{permission_type:"audio",authorization_status:!1,message:"permission_denied"}),h("rtc_create_media",Object.assign({media_type:"audio"},n),i);case 15:t.video&&a===tr.VDM_CAMERA_NOT_AUTHORIZED&&(h("rtc_permission",{permission_type:"video",authorization_status:!1,message:"permission_denied"}),h("rtc_create_media",Object.assign({media_type:"video"},n),i)),et.error("callback error.code",a),d.dispatchEvent(Hs({type:"accessDenied",message:i.message,code:a})),r(new tr(i.message,a,i));case 19:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}()),et.debug("that.stream.init(videoSize, videoFrameRate)",d.videoParam),d.stream.init(d.videoParam)},d.init=(a=d.init,function(e,t){var r=new Promise((function(e,t){return a(e,t)}));return r.then(e,t),r}),Object.defineProperty(d,"uid",{get:function(){return d.stream.uid}}),d.getAudioLevel=function(){if(!d.getAudioTrack())return 0;var e=d.getCurrentTimeDomainData(),t=0;return e.forEach((function(e){return t=Math.max(t,Math.abs(e-128))})),t/128*255},d.setVideoProfile=function(e){if(h("rtc_sdk_api_call",{sdk_api_name:"setVideoProfile",sdk_api_args:[e]}),et.debug("setVideoProfile",e),!Ka[e.toUpperCase()])throw new Error(e+"不支持");var t=function(e){var t=e&&Ka[e.toUpperCase()];return t?{resolution:{width:parseInt(t[0].split("x")[0]),height:parseInt(t[0].split("x")[1])},frameRate:{min:t[1]>15?15:10,max:t[1]},bitrate:{min:parseInt(t[2]/3),max:t[2]}}:{}}(e);d.setVideoEncoderConfiguration(t)},d.getVideoProfile=function(){return d.videoParam.videoSize[2]+"P"},d.getVideoEncoderConfiguration=function(){return{resolution:{width:d.videoParam.videoSize[2],height:d.videoParam.videoSize[3]},frameRate:{min:d.videoParam.videoFrameRate[0],max:d.videoParam.videoFrameRate[1]},bitrate:{min:d.videoParam.minVideoBW,max:d.videoParam.maxVideoBW}}},d._getVideoParamForConstants=function(){return{width:d.videoParam.videoSize[2],height:d.videoParam.videoSize[3],frameRate:{min:d.videoParam.videoFrameRate[0],max:d.videoParam.videoFrameRate[1],ideal:d.videoParam.videoFrameRate[1]}}},d.setVideoEncoderConfiguration=function(e){if(e){var t=e.resolution,r=t&&(t.width!==d.videoParam.videoSize[2]||t.height!==d.videoParam.videoSize[3]),n=e.frameRate,i=n&&(n.min!==d.videoParam.videoFrameRate[0]||n.max!==d.videoParam.videoFrameRate[1]),a=e.bitrate,o=a&&(a.min!==d.videoParam.minVideoBW||a.max!==d.videoParam.maxVideoBW);t&&t.width&&t.height&&(d.videoParam.videoSize=[120,120,t.width,t.height]),n&&n.min&&n.max&&(d.videoParam.videoFrameRate=[n.min,n.max]),a&&a.min&&a.max&&(d.videoParam.minVideoBW=a.min,d.videoParam.maxVideoBW=a.max),d.stream&&d.stream.stream&&(r||i)&&d.stream.updateConfiguration(d._getVideoParamForConstants(),(function(e){e&&et.error("updateConfiguration error at ".concat(e.message))})),d.stream&&d.stream.room&&d.stream.pc&&o&&(d.stream.setMaxVideoBW(a.max),d.stream.setMinVideoBW(a.min),d.stream.applyBitreate())}},d.setVideoBitRate=function(e){et.warning("setVideoBitRate is deprecated, please use setVideoBitrate"),d.setVideoBitrate(e)},d.setMaxVideoBitrate=function(e){var t=d.getVideoSender();if(t){var r=t.getParameters();r.encodings[0].maxBitrate=1e3*e,t.setParameters(r)}},d.setResolutionScaleDown=function(e){var t=d.getVideoSender();if(t){var r=t.getParameters();r.encodings[0].scaleResolutionDownBy=e,t.setParameters(r)}},d.setEncodingActive=function(e){var t=d.getVideoSender();if(t){var r=t.getParameters();r.encodings[0].active=e,t.setParameters(r)}},d.setMaxFramerate=function(e){var t=d.getVideoSender();if(t){var r=t.getParameters();r.encodings[0].maxFramerate=e,t.setParameters(r)}},d.setVideoBitrate=function(e){if(!Array.isArray(e))throw new Error("parameter for setVideoBitRate is incorrect.");d.videoParam.minVideoBW=e[0],d.videoParam.maxVideoBW=e[1]},d.getVideoBitrate=function(){return[d.videoParam.minVideoBW,d.videoParam.maxVideoBW]},d.getVideoSender=function(){var e=l();if(e&&e.getSenders)return e.getSenders().find((function(e){return"video"===e.track.kind}))},d.getAttributes=function(){var e=d.videoParam,t=e.videoFrameRate,r=e.minVideoBW,n=e.maxVideoBW,i=e.videoSize;return{resolution:{width:i[2],height:i[3]},minFrameRate:t[0],maxFrameRate:t[1],minVideoBW:r,maxVideoBW:n}},d.startAudioMixing=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i=Vs(So,t);h("rtc_sdk_api_call",{sdk_api_name:"startAudioMixing",sdk_api_args:[e]});var a=d.getMediaStream();if(n=d.getAudioTrack(),r.isSupport())if(a)if(n)try{r.mixMediaStream(a),r.mixMp3File(e).then((function(){p(r.mixTrack,(function(){i()}),(function(e){i("startAudioMixing replaceTrack failed"+e)}))})).catch((function(e){i("startAudioMixing mixMp3File failed"+e.message)}))}catch(e){i("startAudioMixing failed "+e.message)}else i("no audio track to mix");else i("not has mediaStream");else i("not support audio mixer")},d.stopAudioMixing=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=Vs(So,e);h("rtc_sdk_api_call",{sdk_api_name:"stopAudioMixing"});try{r.pauseMp3(),p(n,(function(){t()}),(function(e){t("stop audio failed:"+e)}))}catch(e){t("stop audio failed"+e.message)}},d.pauseAudioMixing=ve(ge.mark((function e(){var t,n,i=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]?i[0]:function(){},n=Vs(So,t),h("rtc_sdk_api_call",{sdk_api_name:"pauseAudioMixing"});try{r.pauseMp3(),n()}catch(e){n("pause audio failed")}case 4:case"end":return e.stop()}}),e)}))),d.resumeAudioMixing=ve(ge.mark((function e(){var t,n,i=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:function(){},n=Vs(So,t),h("rtc_sdk_api_call",{sdk_api_name:"resumeAudioMixing"}),e.prev=3,e.next=6,r.resumeMp3();case 6:n(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),n("resume failed");case 12:case"end":return e.stop()}}),e,null,[[3,9]])}))),d.getAudioMixingDuration=function(){return r.getAudioMixingDuration()},d.getAudioMixingCurrentPosition=function(){return r.getAudioMixingCurrentPosition()},d.setAudioMixingPosition=function(){var e=ve(ge.mark((function e(t){var n,i,a=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=a.length>1&&void 0!==a[1]?a[1]:function(){},i=Vs(So,n);try{r.setAudioMixingPosition(t,i),i()}catch(e){i("play failed")}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d.adjustAudioMixingVolume=function(e){r.adjustAudioMixingVolume(e)},d.setAudioEncoderConfiguration=function(e,t,r){d.audioParam={sampleRate:e,stereo:t,bitrate:r}},d.setAudioProfile=function(e){var t=m(e);if(!t)throw new Error(e+"不支持");d._audioProfile=e,d.audioParam=t},d.close=function(){if(h("rtc_sdk_api_call",{sdk_api_name:"closeStream"}),d._clear(),o&&"closed"!==o.state&&"function"==typeof o.close)try{o.close()}catch(e){et.error("audioContext.close() error",e)}d.stream.close()},d._clear=function(){try{d._releaseMediaStreamSource()}catch(e){et.error("byteStream._clear() error",e)}},d.getStats=function(){return d.stream.getStats()},d.getAudioStats=function(){return d.stream.getAudioStats()},d.getVideoStats=function(){return d.stream.getVideoStats()},d.getCurrentTimeDomainData=function(){d._setMediaStreamSource();var e=new Uint8Array(2048);return c&&c.getByteTimeDomainData(e),e},d.getCurrentFrequencyData=function(){d._setMediaStreamSource();var e=new Uint8Array(2048);return c&&c.getByteFrequencyData(e),e},d._setMediaStreamSource=function(){if(!c)if(d.stream.stream){var e=window.AudioContext||window.webkitAudioContext;o=new e,s=o.createMediaStreamSource(d.stream.stream),c=o.createAnalyser(),s.connect(c)}else et.warning("no has stream",d.stream.getId(),d.stream)},d._releaseMediaStreamSource=function(){c&&c.disconnect(),s&&s.disconnect()},d.getMediaStream=function(){return d.stream&&d.stream.stream},d.getVideoTrack=function(){return d.getMediaStream()&&d.getMediaStream().getVideoTracks().length>0?d.getMediaStream().getVideoTracks()[0]:null},d.getAudioTrack=function(){return d.getMediaStream()&&d.getMediaStream().getAudioTracks().length>0?d.getMediaStream().getAudioTracks()[0]:null},d.replaceTrackForLocal=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=d.stream.stream;i||n("no mediaStream"),"audio"===e.kind?t=i.getAudioTracks()[0]:"video"===e.kind&&(t=i.getVideoTracks()[0]),t||n("no track in stream"),i.removeTrack(t),i.addTrack(e),d.stream.player&&d.stream.player.updateSrcObject(),r()},d.replaceTrack=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};return h("rtc_sdk_api_call",{sdk_api_name:"replaceTrack"}),p(e,t,r)},d.getVideoDescriptions=function(){return d.stream?d.stream.videoDescriptions:new tr("no stream")},d.sendMessage=function(){},d.sentMessages=function(){return 0},d.setTransform=function(e,t){d.stream&&(e&&(d.stream.audioTransform=e),t&&(d.stream.videoTransform=t))},d};function Vs(e,t){return function(r){r&&Ki(e,{message:r}),t(r)}}var zs=aa,Gs=oa,Ws=ca,Hs=function(e){var t=Ws(e);return e.stream&&(t.stream=Us({stream:e.stream})),t},qs=function(e){var t=Gs(e);return Object.assign(t,e),t};function Js(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Zs(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?Js(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Js(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ks=ws.constants,Qs=Ks.STREAM_STATE,Ys=Ks.ROOM_STATE;function Xs(e){return Object.prototype.toString.call(e).slice(8,-1)}var $s=function e(t){if(null!=t){var r=Xs(t);if("Date"===r){var n=new Date;return n.setTime(t.getTime()),n}if("Object"===r){if(!0===function(e){var t=[];return function e(r){if(r&&"Object"===Xs(r)){if(-1!==t.indexOf(r))return!0;for(var n in t.push(r),r)if(!0===r.hasOwnProperty(n)&&e(r[n]))return!0}return!1}(e)}(t))return t;var i={};for(var a in t)i[a]=e(t[a]);return i}if("Array"===r){for(var o=[],s=0;s<t.length;s++)o.push(e(t[s]));return o}return t}};function ec(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function tc(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?ec(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ec(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var rc={get:function(e,t){var r=e[t];if("string"!=typeof t||"function"!=typeof r)return r;r=r.bind(e);var n=e.getId(),i=e.uid;switch(t){case"getId":case"getUserId":case"isPlaying":case"hasAudio":case"hasVideo":case"hasScreen":case"isAudioOn":case"isVideoOn":case"_isAudioMuted":case"_isVideoMuted":case"_hasVideoTracks":case"getAudioLevel":case"getStats":case"play":case"init":return r;case"on":return function(e,t){return r(e,(function(r){switch(e){case"accessAllowed":case"accessDenied":break;default:Ki("rtc_sdk_api_event",{sdk_api_event:e,message:na(r)})}t(r)}))};default:return function(){var a=r.apply(e,arguments);return dc(Ki,"rtc_sdk_api_call",sc(t),arguments,n,i),a}}}},nc=new Map,ic={get:function(e,t){var r=e[t],n=e.eventLog;if("string"!=typeof t||"function"!=typeof r)return r;switch(r=r.bind(e),t){case"getLocalAudioStats":return function(e){return r((function(t){var r=$s(t);for(var n in r){var i=r[n];"string"==typeof i.MuteState&&(i.MuteState=parseInt(i.MuteState)),i.MuteState=!!i.MuteState&&!!i.MuteState,i.RecordingLevel=i.RecordingLevel?parseInt(i.RecordingLevel):0,i.SendBitrate=i.SendBitrate?parseInt(i.SendBitrate):0,i.SendLevel=i.SendLevel?parseInt(i.SendLevel):void 0,i.SamplingRate=i.SamplingRate?parseInt(i.SamplingRate):void 0,i.audioSendPacketsLost&&(i.PacketLossRate=i.audioSendPacketsLost,delete i.audioSendPacketsLost),i.PacketLossRate=i.PacketLossRate?parseInt(i.PacketLossRate):0}e(r)}))};case"getLocalVideoStats":return function(e){return r((function(t){var r=$s(t);for(var n in r){var i=r[n];"string"==typeof i.MuteState&&(i.MuteState=parseInt(i.MuteState)),i.MuteState=!!i.MuteState&&!!i.MuteState,i.CaptureFrameRate=i.CaptureFrameRate?parseInt(i.CaptureFrameRate):0,i.CaptureResolutionHeight=i.CaptureResolutionHeight?parseInt(i.CaptureResolutionHeight):0,i.CaptureResolutionWidth=i.CaptureResolutionWidth?parseInt(i.CaptureResolutionWidth):0,i.EncodeDelay=i.EncodeDelay?parseInt(i.EncodeDelay):0,i.SendFrameRate=i.SendFrameRate?parseInt(i.SendFrameRate):0,i.SendBitrate=i.SendBitrate?parseInt(i.SendBitrate):0,i.SendResolutionHeight=i.SendResolutionHeight?parseInt(i.SendResolutionHeight):0,i.SendResolutionWidth=i.SendResolutionWidth?parseInt(i.SendResolutionWidth):0,i.TargetSendBitrate=i.TargetSendBitrate?parseInt(i.TargetSendBitrate):0,i.TotalDuration=i.TotalDuration?parseInt(i.TotalDuration):0,i.TotalFreezeTime=i.TotalFreezeTime?parseInt(i.TotalFreezeTime):0,i.videoSendPacketsLost&&(i.PacketLossRate=i.videoSendPacketsLost,delete i.videoSendPacketsLost),i.PacketLossRate=i.PacketLossRate?parseInt(i.PacketLossRate):0}e(r)}))};case"getRemoteAudioStats":return function(e){return r((function(t){var r=$s(t);for(var n in r){var i=r[n];"string"==typeof i.MuteState&&(i.MuteState=parseInt(i.MuteState)),i.MuteState=!!i.MuteState&&!!i.MuteState,i.TransportDelay=i.TransportDelay?parseInt(i.TransportDelay):0,i.End2EndDelay=i.End2EndDelay?parseInt(i.End2EndDelay):0,i.RecvLevel=i.RecvLevel?parseInt(i.RecvLevel):0,i.RecvBitrate=i.RecvBitrate?parseInt(i.RecvBitrate):0,i.TotalFreezeTime=i.TotalFreezeTime?parseInt(i.TotalFreezeTime):0,i.TotalPlayDuration=i.TotalPlayDuration?parseInt(i.TotalPlayDuration):0,i.PacketLossRate=i.PacketLossRate?parseInt(i.PacketLossRate):0}e(r)}))};case"getRemoteVideoStats":return function(e){return r((function(t){var r=$s(t);for(var n in r){var i=r[n];"string"==typeof i.MuteState&&(i.MuteState=parseInt(i.MuteState)),i.MuteState=!!i.MuteState&&!!i.MuteState,i.End2EndDelay=i.End2EndDelay?parseInt(i.End2EndDelay):0,i.TransportDelay=i.TransportDelay?parseInt(i.TransportDelay):0,i.RecvBitrate=i.RecvBitrate?parseInt(i.RecvBitrate):0,i.RecvResolutionWidth=i.RecvResolutionWidth?parseInt(i.RecvResolutionWidth):0,i.RecvResolutionHeight=i.RecvResolutionHeight?parseInt(i.RecvResolutionHeight):0,i.RenderResolutionWidth=i.RenderResolutionWidth?parseInt(i.RenderResolutionWidth):0,i.RenderResolutionHeight=i.RenderResolutionHeight?parseInt(i.RenderResolutionHeight):0,i.RenderFrameRate=i.RenderFrameRate?parseInt(i.RenderFrameRate):0,i.TotalFreezeTime=i.TotalFreezeTime?parseInt(i.TotalFreezeTime):0,i.TotalPlayDuration=i.TotalPlayDuration?parseInt(i.TotalPlayDuration):0,i.PacketLossRate=i.PacketLossRate?parseInt(i.PacketLossRate):0}e(r)}))};case"join":return function(e,i,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){},c={event_starttime:new Date};return dc(n,"rtc_sdk_api_call",cc(t),[e,i,a]),r(e,i,a,(function(t){o(t),n("rtc_sdk_api_callback",tc(tc({sdk_callback_name:"onJoinChannelSuccess",message:{token:e,roomId:i,userId:a}},c),{},{error_code:0}))}),(function(e){s(e),n("rtc_error",e?{from:t,message:JSON.stringify(e)}:{from:t,message:"no error"})}))};case"subscribe":case"publish":return function(i,a){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},s=null;"function"==typeof a?(o=a,s=r(i,(function(e){o(e),e?n("rtc_error",{from:t,message:JSON.stringify(e)}):n("rtc_sdk_api_callback",{sdk_callback_name:t})}))):s=r(i,a,(function(e){o(e),e?n("rtc_error",{from:t,message:JSON.stringify(e)}):n("rtc_sdk_api_callback",{sdk_api_name:t,message:a})}));var c="publish"===t?e.id:i.uid,d=i.getId();return dc(n,"rtc_sdk_api_call",cc(t),arguments,d,c),s};case"unpublish":case"unsubscribe":return function(e,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};return"function"==typeof i&&(a=i,i={}),dc(n,"rtc_sdk_api_call",cc(t),arguments),r(e,(function(e){a(e),e?n("rtc_error",{from:t,message:JSON.stringify(e)}):n("rtc_sdk_api_callback",{sdk_callback_name:t})}))};case"on":return function(e,t){var i=function(r){var i=r.stream&&(r.stream.uid||r.stream.getId()),a=r.stream&&r.stream.getId();switch(r.uid=r.uid||i,r.stream&&(r.streamId=r.stream.getId()),e){case"network-quality":case"network-type-changed":case"peer-online":case"stream-added":case"stream-subscribed":case"stream-published":case"connection-state-change":break;default:n("rtc_sdk_api_event",{sdk_api_event:e,stream_user_id:r.uid,stream_id:a,message:na(r)})}t(r)};try{nc.set(t,i)}catch(e){}return r(e,i)};case"off":return function(e,t){var n=t;try{n=nc.get(t)}catch(e){}return r(e,n)};default:return function(){var i=r.apply(e,arguments);return dc(n,"rtc_sdk_api_call",cc(t),arguments),i}}}},ac={on:"stream.on",init:"stream.init",close:"closeStream"},oc={on:"client.on",init:"client.init",join:"joinRoom",leave:"leaveRoom"};function sc(e){return ac[e]||e}function cc(e){return oc[e]||e}function dc(e,t,r,n,i,a){e(t,{sdk_api_name:r,message:na(n=Array.prototype.slice.call(n)),stream_id:i,stream_user_id:a})}var uc={VERSION:Oa.version,checkSystemRequirements:function(){if(window.navigator.userAgent.match(/ edge\//i))return!1;var e=Os(),t=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,r=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,n=window.WebSocket,i=!!t&&!!r&&!!n,a=!1;return et.warning(e.getBrowserInfo(),"isAPISupport:"+i),e.isChrome()&&e.getBrowserVersion()>=58&&"iOS"!==e.getBrowserOS()&&(a=!0),e.isFireFox()&&e.getBrowserVersion()>=56&&(a=!0),e.isOpera()&&e.getBrowserVersion()>=45&&(a=!0),e.isSafari()&&e.getBrowserVersion()>=11&&(a=!0),e.isSupportedPC()||e.isSupportedMobile()||(a=!1),i&&a},getDevices:Ps,checkVideoPermission:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};navigator.getUserMedia?navigator.getUserMedia({audio:!1,video:!0},e,t):t(new Error("getUserMedia not suppurted"))},checkAudioPermission:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};navigator.getUserMedia?navigator.getUserMedia({audio:!0,video:!1},e,t):t(new Error("getUserMedia not suppurted"))},setAid:function(e){ea(e)},setReportEntry:function(e,t){return ta(e,t)},createClient:function(e){return Ki("rtc_create_client",{message:JSON.stringify(e)}),new Proxy(function(e){var t=e||{},r=zs();r.monitor=Zi.create();var n=r.monitor.eventLog.bind(r.monitor);r.eventLog=n,r.class="VClient",et.debug("[VRTC] engineId: ".concat(r.monitor.getEngineId())),t.configServerHost&&(Oa.configServerHost=t.configServerHost),t.configServer&&(Oa.configServerHost=t.configServer.split("/")[2]),r.appId="",r.businessId="",r.encodedInsertableStreams=e.encodedInsertableStreams;var a={},o=null,s=!1;void 0!==t.compressReport&&(Oa.global.compressReport=!!t.compressReport),t.logUrlHost&&(Oa.logServerHost=t.logUrlHost);var c=navigator.connection||navigator.mozConnection||navigator.webkitConnection;function d(){r.networkType=c.effectiveType,r.emit({type:"network-type-changed",networkType:r.networkType}),n("network_type_changed",{message:r.networkType})}c&&(r.networkType=c.effectiveType,c.addEventListener("change",d),setTimeout((function(){r.emit({type:"network-type-changed",networkType:r.networkType}),n("network_type_changed",{message:r.networkType})}),300));var u={controlMessage:g("started"),userAttributes:{enableaudio:!0,enablevideo:!0},params:{deviceType:"web",userAgent:window.navigator.userAgent,sdkVersion:Oa.version,deviceId:r.monitor.getDeviceId()}};switch(t.mode){case Wa:et.warning("直播"),u.userAttributes.role="silentUser";break;case Ha:et.warning("云游戏模式");break;default:et.warning("RTC模式")}function l(e){function t(e){n("rtc_sdk_api_event",Object.assign({sdk_api_event:e.type,sdk_api_args:na(e),stream_user_id:e.uid,message:e.message,error_code:e.code},ra(e.stream&&e.stream.stream)))}r.room=ws.Room({monitor:r.monitor,client:r}),r.room.on("stream-added",(function(e){ia(e.stream.uid,"stream-added: not found uid ".concat(e.stream));var n=e.stream.uid===r.id?"stream-published":e.type,i=Hs({type:n,stream:e.stream});e.stream.client=r,t(i),r.dispatchEvent(i)})),r.room.on("stream-subscribed",(function(e){ia(e.stream.uid,"stream-subscribed: not found uid ".concat(e.stream));var n=Hs({type:e.type,stream:e.stream});t(n),r.dispatchEvent(n)})),r.room.on("stream-removed",(function(e){var n=Hs({type:e.type,stream:e.stream});if(e.stream.client=null,t(n),r.dispatchEvent(n),r.id===e.stream.uid){var i=Hs({type:"stream-unpublished",stream:e.stream});t(i),r.dispatchEvent(i)}})),r.room.on("custom-message",(function(e){var n=qs({type:e.type,message:e.message});t(n),r.dispatchEvent(n)})),r.room.on("audio-enable",(function(e){var n=e.enable?"unmute-audio":"mute-audio",i=Hs({type:n,stream:e.stream});t(i),r.dispatchEvent(qs({type:n,stream:i.stream,uid:e.stream.uid}))})),r.room.on("video-enable",(function(e){var n=e.enable?"unmute-video":"mute-video",i=Hs({type:n,stream:e.stream});t(i),r.dispatchEvent(qs({type:n,stream:i.stream,uid:e.stream.uid}))})),r.room.on("client-banned",(function(e){var n=e.type,i=e.message,a=e.code,o=qs({uid:r.id,type:n,message:i,code:a});t(o),r.dispatchEvent(o)})),r.room.on("userConnection",(function(e){var n,i={uid:e.message.clientId};t(n=qs(Object.assign(i,{type:"peer-online"}))),r.dispatchEvent(n)})),r.room.on("room-disconnected",(function(){var e=qs({type:"room-disconnected"});t(e),r.dispatchEvent(e)})),r.room.on("user-message-received",(function(e){var n;if("__web__rtc__rtt__"!==(null==e||null===(n=e.message)||void 0===n?void 0:n.msg)){var i=qs(Zs({type:"user-message-received"},e));t(i),r.dispatchEvent(i)}})),r.room.on("userDisconnection",(function(e){var n,i={uid:e.message.clientId,reason:e.message.tag};"userDuplicateLogin"===e.message.tag?(e.message.clientId===r.id&&r.leave(),n=qs(Object.assign(i,{type:"client-banned",code:tr.DUPLICATE_LOGIN}))):n=qs(Object.assign(i,{type:"peer-leave"})),t(n),r.dispatchEvent(n)})),r.room.on("tokenFailed",(function(e){var n=qs({type:"token-request",message:e.message,code:tr.INVALID_TOKEN});t(n),r.dispatchEvent(n)})),r.room.on("signalServerFailed",function(){var e=ve(ge.mark((function e(t){var r;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={event_starttime:new Date,reconnect_id:sr(),reconnect_type:"signalServerFailed"},n("rtc_reconnect",r,{code:t.code||1004,message:t.message||"retry getroom"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r.room.on("connection-state-change",(function(e){var i=e.type,a=e.prevState,o=e.curState,s=qs({type:i,prevState:a,curState:o});n("connection-state-change",{message:o}),t(s),r.dispatchEvent(s)})),r.room.on("first-local-audio-render",(function(e){n("first_local_audio_render",ra(e.stream.stream)),r.emit({type:"first-local-audio-render"})})),r.room.on("first-local-video-render",(function(e){n("first_local_video_render",ra(e.stream.stream)),r.emit({type:"first-local-video-render"})})),r.room.on("first-remote-audio-render",(function(e){n("first_remote_audio_render",ra(e.stream.stream)),r.emit({type:"first-remote-audio-render",uid:e.stream.stream.uid})})),r.room.on("first-remote-video-render",(function(e){n("first_remote_video_render",ra(e.stream.stream)),r.emit({type:"first-remote-video-render",uid:e.stream.stream.uid})})),r.room.on("login-completion",(function(e){n("login-completion",{message:{errorCode:0,listStreams:e.streams}}),r.emit({type:"login-completion",message:{errorCode:0,listStreams:e.streams}})})),r.room.on("republish-stream",(function(){s&&r.startLiveStreaming()})),r.room.on("error",(function(e){n("error",{message:e}),r.emit({type:"error",message:e.message,code:e.code})})),r.room.on("ice-state-change",(function(e){r.emit({type:"ice-state-change",state:e.state})}))}function p(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){};return f("normalUser"),h(e,t,r,n,i)}function f(e){return u.userAttributes.role&&u.userAttributes.role!==e?new Promise((function(t,n){return h(!1,"updateUserAttributes",{sessionId:r.sessionId,attributes:{role:e}},(function(r){u.userAttributes.role=e,t(r)}),n)})):Promise.resolve()}function h(e,t,n){var a,o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){};if(r.room&&"open"===(null===(a=r.room)||void 0===a||null===(o=a.dataChannel)||void 0===o?void 0:o.readyState)){if(!n)return c({msg:"消息不能为空",code:-1200});try{var d=new TextEncoder,u=n;if("object"===i(u)&&(u=JSON.stringify(u)),d.encode(u).byteLength>64e3)return c({msg:"消息长度大于64k",code:-1200})}catch(e){}var l=function(e,t){return e?c(e):s(t)};r.room.registerAckCallbackAndSendSignaling(n,t,l)}else c(new Error("尚未连进入房间"))}function m(){return u.controlMessage.transcodeMeta&&u.controlMessage.transcodeMeta.transcode&&u.controlMessage.transcodeMeta.transcode.url}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};r.room&&r.room.state!==Ys.DISCONNECTED?r._sendControlMessage(g(e),t,n):n(new tr("It seems you have not joined in a room.",tr.INVALID_INVOKE_SEQUENCE))}function g(e){return{type:"transcode",action:e,transcodeMeta:u&&u.controlMessage&&u.controlMessage.transcodeMeta}}function y(){var e=!y.notFirstCall;y.notFirstCall=!0;var t=Date.now();function i(e){switch(e.device.kind){case"audioinput":r.emit(Zs({type:"recording-device-changed"},e)),n("recording-device-changed",{state:e.state,message:na(e.device)});break;case"audiooutput":r.emit(Zs({type:"playout-device-changed"},e)),n("playout-device-changed",{state:e.state,message:na(e.device)});break;case"videoinput":r.emit(Zs({type:"camera-changed"},e)),n("camera-changed",{state:e.state,message:na(e.device)})}r.emit(Zs({type:"device-changed"},e))}Ps((function(r){r.forEach((function(r){a[r.deviceId]?("INACTIVE"===a[r.deviceId].state&&(a[r.deviceId].state="ACTIVE",i(a[r.deviceId])),a[r.deviceId].lastReloadAt=t):(a[r.deviceId]={device:r,initAt:t,lastReloadAt:t,state:"ACTIVE"},!e&&i(a[r.deviceId]))})),Object.entries(a).forEach((function(e){var r=e[1];"ACTIVE"===r.state&&r.lastReloadAt!==t&&(r.state="INACTIVE",i(r))}))}))}function b(e,t){return _.apply(this,arguments)}function _(){return(_=ve(ge.mark((function e(t,n){var i,a,o,s,c=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.length>2&&void 0!==c[2]?c[2]:function(){},e.prev=1,a=t.stream,n.qualityLayer=a.qualityLayer,e.next=6,r.room.subscribe(t.stream,n);case 6:e.next=26;break;case 8:if(e.prev=8,e.t0=e.catch(1),!t||!t.stream||t.stream.getState()!==Qs.FAILED){e.next=14;break}et.error("[subscribe error skip]",e.t0),e.next=26;break;case 14:e.t1=e.t0.code,e.next=403===e.t1?17:406===e.t1?19:21;break;case 17:return o=tr.NO_SUBSCRIBE_PERMISSION,e.abrupt("break",23);case 19:return o=tr.NOT_ACCEPTABLE,e.abrupt("break",23);case 21:return o=e.t0.code,e.abrupt("break",23);case 23:throw s=new tr(e.t0.message,o,e.t0),i(s),s;case 26:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function S(e){return w.apply(this,arguments)}function w(){return(w=ve(ge.mark((function e(t){var n,i,a,o=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},i=o.length>2&&void 0!==o[2]?o[2]:function(){},a="updateSubscribe",e.prev=3,e.next=6,new Promise((function(e,i){return r.room.updateSubscribe(t.stream,n,k(e,i,a,t))}));case 6:e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(3),i(e.t0),e.t0;case 12:case"end":return e.stop()}}),e,null,[[3,8]])})))).apply(this,arguments)}return r.init=function(){var e=ve(ge.mark((function e(t){var n,i,a,o=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:function(){},i=o.length>2&&void 0!==o[2]?o[2]:function(){},r.appId=t,r.monitor.setAppId(t),(a=r._init(null,{})).then(n,i),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r._init=function(){var e=ve(ge.mark((function e(t,n){return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&(r.appId=t,r.monitor.setAppId(t)),y(),o=o||setInterval(y,5e3),r._serverConfig=n,l(r._serverConfig.domain);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),r.getConnectionState=function(){return r.room?r.room.state:Ys.DISCONNECTED},r.join=function(){var e=ve(ge.mark((function e(i,a,o){var s,c,d,l,p,f,h,m,v,g=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=g.length>3&&void 0!==g[3]?g[3]:function(){},c=g.length>4&&void 0!==g[4]?g[4]:function(){},o=(o||"")+"",ia(""!=(a=(a||"")+"")&&""!==o,"roomId: ".concat(a," or uid: ").concat(o," is none.")),d=(new Date).valueOf(),r.__logJoinRoom={channel_role:"",event_starttime:d,start:d},r.sessionId=r.monitor.getAndSetSessionId(),e.prev=8,r.roomId=a,r.monitor.setRoomId(a),o=o||sr(),r.id=o,r.monitor.setUserId(o),Hi(),a){e.next=19;break}throw(l=new Error("roomId can not empty")).code=1001,l;case 19:if(!r.monitor.getInRoom()){e.next=23;break}throw(p=new Error("already in room")).code=1003,p;case 23:return r.monitor.setInRoom(!0),Object.assign(u,{Authorization:Is(i,r.appId,a,o),sessionId:r.sessionId,role:t.role,timestamp:Date.now(),enableICEMux:t.enableICEMux,_userAgentIP:t._userAgentIP,_mediaServerAddr:t._mediaServerAddr,_idc:t._idc,params:Zs(Zs({},u.params),{},{appId:r.appId,businessId:r.businessId,roomId:a,userId:o,iceUrl:t.iceUrl})}),e.next=27,new Promise((function(e,t){return r.room.join(u,(function(r,n){return r?t(r):e(n)}))}));case 27:return f=e.sent,h=f.clientId,ia(h===o,"uid and token not match. uid:".concat(o," uid(token):").concat(h)),r.id=h,r.monitor.setUserId(h),r.monitor.setCallId(f.callId),n("rtc_join_room",r.__logJoinRoom),s(h),e.abrupt("return",h);case 38:throw e.prev=38,e.t0=e.catch(8),Tr(),et.error("join room error",e.t0),m=e.t0?JSON.stringify(e.t0):"",n("rtc_join_room_fail",Object.assign(r.__logJoinRoom,{message:m})),v=new tr(e.t0.message?e.t0.message:"join room error",tr.JOIN_ROOM_ERROR,e.t0),r.monitor.setInRoom(!1),c(v),v;case 48:case"end":return e.stop()}}),e,null,[[8,38]])})));return function(t,r,n){return e.apply(this,arguments)}}(),r.feedback=function(e,t,i){var a,o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){};if(r.room&&"open"===(null===(a=r.room)||void 0===a||null===(o=a.dataChannel)||void 0===o?void 0:o.readyState))if(e<1||e>5)c(new tr("Invalid grade",tr.INVALID_PARAMETERS));else{var d={network_type:r.networkType,grade:e,type:t,problem_desc:i};n("rtc_rate",d),s()}else c(new tr("Please feedback after you have joined room.",tr.NOT_IN_ROOM))},r.renewToken=function(){var e=ve(ge.mark((function e(t){var n,i,a,o,s,c=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:function(){},i=c.length>2&&void 0!==c[2]?c[2]:function(){},e.prev=2,r.room&&"open"===(null===(a=r.room)||void 0===a||null===(o=a.dataChannel)||void 0===o?void 0:o.readyState)){e.next=5;break}throw new Error("尚未进入房间");case 5:return u.Authorization=Is(t,r.appId,r.roomId,r.id),e.next=8,new Promise((function(e,t){return r.room.renewToken(u,k(e,t))}));case 8:return s=e.sent,n(s),e.abrupt("return",s);case 13:throw e.prev=13,e.t0=e.catch(2),i(e.t0),e.t0;case 17:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(t){return e.apply(this,arguments)}}(),r.renewChannelKey=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};et.warning("renewChannelKey 要废弃，请使用 renewToken 代替！"),r.renewToken(e,t,n)},r.leave=ve(ge.mark((function e(){var t,i,a,o,l,p=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:function(){},i=p.length>1&&void 0!==p[1]?p[1]:function(){},c&&c.removeEventListener("change",d),s&&(a=u.controlMessage.transcodeMeta.transcode.url,r.stopLiveStreaming(a)),e.prev=4,e.next=7,r.room;case 7:if(e.t0=e.sent,!e.t0){e.next=10;break}e.t0=r.room.leaveRoom({sessionId:r.sessionId,Authorization:u.Authorization},"client leave room");case 10:o=e.t0,et.debug("rtc_leave_room success",o),n("rtc_leave_room",r.__logJoinRoom),delete r.__logJoinRoom,r.monitor.setInRoom(!1),t(o),e.next=25;break;case 18:e.prev=18,e.t1=e.catch(4),et.error("rtc_leave_room error",e.t1),l=e.t1?JSON.stringify(e.t1):"",n("rtc_leave_room",Object.assign(r.__logJoinRoom,{message:l})),r.monitor.setInRoom(!1),i(e.t1);case 25:return e.prev=25,r.monitor.setCallId(""),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[4,18,25,28]])}))),r.publish=function(){var e=ve(ge.mark((function e(i){var a,o,s,c,d,u,l,p=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=p.length>1&&void 0!==p[1]?p[1]:{},o=p.length>2&&void 0!==p[2]?p[2]:function(){},et.debug("[API] call publish",i,a),i.client=r,"function"==typeof a&&(o=a,a={}),t.mode===Ha&&(a.data=!0,i.stream.data=!0),a.encodedInsertableStreams=r.encodedInsertableStreams,e.prev=7,f("normalUser"),i.getVideoProfile()&&(s=i.getAttributes(),c=s.minVideoBW,d=s.maxVideoBW,Object.assign(a,{minVideoBW:c,maxVideoBW:d}),et.debug("【设置发布流】实际带宽值：",a)),e.next=12,r.room.publish(i.stream,a);case 12:n("rtc_publish",ra(i&&i.stream)),e.next=34;break;case 15:if(e.prev=15,e.t0=e.catch(7),!i||!i.stream||i.stream.getState()!==Qs.FAILED){e.next=21;break}et.error("[publish error skip]",e.t0),e.next=34;break;case 21:e.t1=e.t0.code,e.next=403===e.t1?24:406===e.t1?26:28;break;case 24:return u=tr.NO_PUBLISH_PERMISSION,e.abrupt("break",30);case 26:return u=tr.NOT_ACCEPTABLE,e.abrupt("break",30);case 28:return u=e.t0.code,e.abrupt("break",30);case 30:throw l=new tr(e.t0.message,u,e.t0),n("rtc_publish_fail",Object.assign({message:JSON.stringify(e.t0)},ra(i&&i.stream))),o(l),l;case 34:case"end":return e.stop()}}),e,null,[[7,15]])})));return function(t){return e.apply(this,arguments)}}(),r.subscribe=function(){var e=ve(ge.mark((function e(i){var a,o,s,c=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=function(e){return e&&e.stream&&e.stream.getState()===Qs.SUCCESS},a=c.length>1&&void 0!==c[1]?c[1]:{},o=c.length>2&&void 0!==c[2]?c[2]:function(){},i.client=r,et.debug("[API] call subscribe[update]",i,a),"function"==typeof a&&(o=a,a={video:!0,audio:!0}),void 0===a.video&&void 0===a.audio&&(a={video:!0,audio:!0}),void 0===a.video&&(a.video=!!a.video),void 0===a.audio&&(a.audio=!!a.audio),a.audio||a.video){e.next=12;break}return o(new tr("video and audio can not be both false",tr.INVALID_PARAMETERS)),e.abrupt("return");case 12:if(a.encodedInsertableStreams=r.encodedInsertableStreams,t.mode===Ha&&(a.data=!0,i.stream.data=!0),e.prev=14,a.forceSubscribe||!s(i)){e.next=20;break}return e.next=18,S(i,a,o);case 18:e.next=22;break;case 20:return e.next=22,b(i,a,o);case 22:n("rtc_subscribe",ra(i&&i.stream)),e.next=30;break;case 25:throw e.prev=25,e.t0=e.catch(14),n("rtc_subscribe_fail",Object.assign({message:JSON.stringify(e.t0)},ra(i&&i.stream))),o(e.t0),e.t0;case 30:case"end":return e.stop()}}),e,null,[[14,25]])})));return function(t){return e.apply(this,arguments)}}(),r.unpublish=function(){var e=ve(ge.mark((function e(t){var n,i,a=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:function(){},i="unpublish",t.client=null,e.prev=3,e.next=6,new Promise((function(e,n){return r.room.unpublish(t.stream,k(e,n,i,t))}));case 6:r.room&&0!==r.room.localStreams.keys().length||f("silentUser"),e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(3),n(e.t0),e.t0;case 13:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t){return e.apply(this,arguments)}}(),r.unsubscribe=function(){var e=ve(ge.mark((function e(t){var n,i,a=arguments;return ge.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:function(){},i="unsubscribe",t.client=null,e.prev=3,t._clear(),e.next=7,new Promise((function(e,n){return r.room.unsubscribe(t.stream,k(e,n,i,t))}));case 7:e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(3),n(e.t0),e.t0;case 13:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t){return e.apply(this,arguments)}}(),r.sendMessageToUser=function(e,t){return new Promise((function(n,i){var a,o;if(!r.room||"open"!==(null===(a=r.room)||void 0===a||null===(o=a.dataChannel)||void 0===o?void 0:o.readyState))return i({msg:"尚未连进入房间",code:-1200});if(!e)return i({msg:"用户id不能为空",code:-1200});if(!t)return i({msg:"消息不能为空",code:-1200});try{if((new TextEncoder).encode(t).byteLength>64e3)return i({msg:"消息长度大于64k",code:-1200})}catch(e){}n(r.room.sendP2PMessage(e,t))}))},r.sendCustomMessage=function(e,t,r){return p(!0,"customMessage",e,t,r)},r._sendControlMessage=function(e,t,r){return p(!1,"controlMessage",e,t,r)},r.setLiveTranscoding=function(e){var t=function(e){var t={video:{codec:"H264",fps:e.videoFramerate||15,gop:e.videoGop||30,lowLatency:!0,bitRate:1e3*e.videoBitrate||4e5,width:e.width||640,height:e.height||360},audio:{codec:"AAC",bitRate:1e3*e.audioBitrate||48e3,sampleRate:e.audioSampleRate||44100,channels:e.audioChannels||1,profile:"LC"},layout:{canvas:{bgnd:e.backgroundColor?"#"+function(e){var t="000000"+e;return t.substr(t.length-6)}(e.backgroundColor.toString(16)):"#000000"},regions:[],app_data:""}};return e.transcodingUsers&&e.transcodingUsers.forEach((function(e){t.layout.regions.push({uid:e.uid,zorder:e.zOrder,alpha:e.alpha,renderMode:e.renderMode||1,screen:e.screen||!1,x:e.x/t.video.width,y:e.y/t.video.height,w:e.width/t.video.width,h:e.height/t.video.height})})),t}(e);u.controlMessage.transcodeMeta?Object.assign(u.controlMessage.transcodeMeta,t):u.controlMessage.transcodeMeta=t,m()&&v("layoutChanged")},r.startLiveStreaming=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};if(u.controlMessage.transcodeMeta){if(!(u.controlMessage.transcodeMeta.transcode&&u.controlMessage.transcodeMeta.transcode.url||""!==e))return et.error("no url"),void r(new Error("no url"));""!==e&&(u.controlMessage.transcodeMeta.transcode={url:e}),s=!0,v("started",t,r)}else r(new Error("please setLiveTranscoding first"))},r.stopLiveStreaming=function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};m()?(u.controlMessage.transcodeMeta=void 0,s=!1,v("stopped",e,t)):(t(new Error("Please startLiveStreaming first.")),et.error("Please startLiveStreaming first."))},r.enableLiveTranscoding=function(e,t,r){u.controlMessage.transcodeMeta=e,s=!0,v("started",t,r)},r.disableLiveTranscoding=function(e,t){u.controlMessage.transcodeMeta=void 0,s=!1,v("stopped",e,t)},r.setVideoCompositingLayout=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};u.controlMessage.transcodeMeta?(u.controlMessage.transcodeMeta.layout=e,v("layoutChanged",t,r)):r(new Error("not enableLiveTranscoding"))},r.setSEI=function(e,t,n){et.debug("发送SEI",e),r._sendControlMessage({action:"setSEI",sei:e},t,n)},r.getBusinessId=function(){return Xi()},r.setBusinessId=function(e,t){if(!r.room)return $i(e),void(r.businessId=e);t(new tr("You should invoke setBusinessId before client.init().",tr.INVALID_INVOKE_SEQUENCE))},r.getLocalVideoStats=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};r.room?e(r.room.getLocalVideoStats()):e({})},r.getLocalAudioStats=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};r.room?e(r.room.getLocalAudioStats()):e({})},r.getRemoteAudioStats=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};r.room?e(r.room.getRemoteAudioStats()):e({})},r.getRemoteVideoStats=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};r.room?e(r.room.getRemoteVideoStats()):e({})},r;function k(e,t,r,i){var a=Object.assign({event_starttime:new Date},ra(i&&i.stream));return function(o,s){et.debug(o,s),r&&n("rtc_"+r,Object.assign(a,ra(i&&i.stream)),o,s),o?t(o):e(s)}}}(e),ic)},createStream:function(e){var t={audio:e.audio,video:e.screen?e.video||!0:e.video,data:e.data,screen:e.screen,extensionId:e.extensionId,desktopStreamId:e.desktopStreamId,screenAudio:e.screenAudio,audioTransform:e.audioTransform,videoTransform:e.videoTransform};e.mediaStream&&(t.audio=e.mediaStream.getAudioTracks().length>0,t.video=e.mediaStream.getVideoTracks().length>0,et.warning("spec.mediaStream",t,e.mediaStream)),e.attributes&&e.attributes.hasOwnProperty("minFrameRate")&&e.attributes.hasOwnProperty("maxFrameRate")&&(t.videoFrameRate=[e.attributes.minFrameRate,e.attributes.maxFrameRate]),t.attributes=t.attributes||{},t.attributes.audiostream=!!t.audio,t.attributes.localaudio=!!t.audio,t.attributes.videostream=!!t.video,t.attributes.localvideo=!!t.video,e.microphoneId&&t.audio&&(t.audio=!0===t.audio?{}:Object.assign({},t.audio),Object.assign(t.audio,{deviceId:{exact:e.microphoneId}})),e.cameraId&&t.video&&(t.video=!0===t.video?{}:Object.assign({},t.video),Object.assign(t.video,{deviceId:{exact:e.cameraId}})),et.debug("createStream options",t);var r=ws.Stream(t);return Ki("rtc_sdk_api_call",{sdk_api_name:"createStream",sdk_api_args:[na(e,1)],stream_id:r.getServerId(),vid:r.getId()}),new Proxy(Us(Object.assign({},e,{stream:r})),rc)},Logger:ws.Logger,FeedbackType:{PROBLEM_NONE:0,PROBLEM_OTHER_MSG:1,PROBLEM_AUDIO_NOT_CLEAR:2,PROBLEM_VIDEO_NOT_CLEAR:4,PROBLEM_SYNC:8,PROBLEM_AUDIO_LAGGING:16,PROBLEM_VIDEO_LAGGING:32,PROBLEM_CONNECT_FAILED:64,PROBLEM_AUDIO_DELAY:128,PROBLEM_VIDEO_DELAY:256,PROBLEM_DISCONNECT:512,PROBLEM_NO_AUDIO:1024,PROBLEM_NO_VIDEO:2048,PROBLEM_AUDIO_STRENGTH:4096,PROBLEM_ECHO:8192},VError:tr,VideoPlayer:ws.Player,_getAllSupportVideoProfiles:function(){return Object.keys(Ka)},_userAgent:Os(),serverConfig:xs};return window.addEventListener("error",(function(e){Ki("rtc_global_exeception",{message:cr(e.error)})})),uc}));
